module.exports=function(e){"use strict";require("time-grunt")(e),require("load-grunt-tasks")(e);var n={app:"app",dist:"dist",distMac32:"dist/macOS",distMac64:"dist/macOS",distLinux32:"dist/Linux32",distLinux64:"dist/Linux64",distWin:"dist/Win",tmp:"buildTmp",resources:"resources"};e.initConfig({config:n,clean:{dist:{files:[{dot:!0,src:["<%= config.dist %>/*","<%= config.tmp %>/*"]}]},distMac32:{files:[{dot:!0,src:["<%= config.distMac32 %>/*","<%= config.tmp %>/*"]}]},distMac64:{files:[{dot:!0,src:["<%= config.distMac64 %>/*","<%= config.tmp %>/*"]}]},distLinux64:{files:[{dot:!0,src:["<%= config.distLinux64 %>/*","<%= config.tmp %>/*"]}]},distLinux32:{files:[{dot:!0,src:["<%= config.distLinux32 %>/*","<%= config.tmp %>/*"]}]},distWin:{files:[{dot:!0,src:["<%= config.distWin %>/*","<%= config.tmp %>/*"]}]}},jshint:{options:{jshintrc:".jshintrc"},files:"<%= config.app %>/js/*.js"},copy:{appLinux:{files:[{expand:!0,cwd:"<%= config.app %>",dest:"<%= config.distLinux64 %>/app.nw",src:"**"}]},appLinux32:{files:[{expand:!0,cwd:"<%= config.app %>",dest:"<%= config.distLinux32 %>/app.nw",src:"**"}]},appMacos32:{files:[{expand:!0,cwd:"<%= config.app %>",dest:"<%= config.distMac32 %>/node-webkit.app/Contents/Resources/app.nw",src:"**"},{expand:!0,cwd:"<%= config.resources %>/mac/",dest:"<%= config.distMac32 %>/node-webkit.app/Contents/",filter:"isFile",src:"*.plist"},{expand:!0,cwd:"<%= config.resources %>/mac/",dest:"<%= config.distMac32 %>/node-webkit.app/Contents/Resources/",filter:"isFile",src:"*.icns"},{expand:!0,cwd:"<%= config.app %>/../node_modules/",dest:"<%= config.distMac32 %>/node-webkit.app/Contents/Resources/app.nw/node_modules/",src:"**"}]},appMacos64:{files:[{expand:!0,cwd:"<%= config.app %>",dest:"<%= config.distMac64 %>/node-webkit.app/Contents/Resources/app.nw",src:"**"},{expand:!0,cwd:"<%= config.resources %>/mac/",dest:"<%= config.distMac64 %>/node-webkit.app/Contents/",filter:"isFile",src:"*.plist"},{expand:!0,cwd:"<%= config.resources %>/mac/",dest:"<%= config.distMac64 %>/node-webkit.app/Contents/Resources/",filter:"isFile",src:"*.icns"},{expand:!0,cwd:"<%= config.app %>/../node_modules/",dest:"<%= config.distMac64 %>/node-webkit.app/Contents/Resources/app.nw/node_modules/",src:"**"}]},webkit32:{files:[{expand:!0,cwd:"<%=config.resources %>/node-webkit/MacOS32",dest:"<%= config.distMac32 %>/",src:"**"}]},webkit64:{files:[{expand:!0,cwd:"<%=config.resources %>/node-webkit/MacOS64",dest:"<%= config.distMac64 %>/",src:"**"}]},copyWinToTmp:{files:[{expand:!0,cwd:"<%= config.resources %>/node-webkit/Windows/",dest:"<%= config.tmp %>/",src:"**"}]}},compress:{appToTmp:{options:{archive:"<%= config.tmp %>/app.zip"},files:[{expand:!0,cwd:"<%= config.app %>",src:["**"]}]},finalWindowsApp:{options:{archive:"<%= config.distWin %>/netCanvas.zip"},files:[{expand:!0,cwd:"<%= config.tmp %>",src:["**"]}]}},rename:{macApp32:{files:[{src:"<%= config.distMac32 %>/node-webkit.app",dest:"<%= config.distMac32 %>/netCanvas.app"}]},macApp64:{files:[{src:"<%= config.distMac64 %>/node-webkit.app",dest:"<%= config.distMac64 %>/netCanvas.app"}]},zipToApp:{files:[{src:"<%= config.tmp %>/app.zip",dest:"<%= config.tmp %>/app.nw"}]}}}),e.registerTask("chmod32","Add lost Permissions.",function(){var e=require("fs"),i=n.distMac32+"/netCanvas.app/Contents/";e.existsSync(i+"Frameworks/node-webkit Helper EH.app/Contents/MacOS/node-webkit Helper EH")?e.chmodSync(i+"Frameworks/node-webkit Helper EH.app/Contents/MacOS/node-webkit Helper EH","555"):e.chmodSync(i+"Frameworks/nwjs Helper EH.app/Contents/MacOS/nwjs Helper EH","555"),e.existsSync(i+"Frameworks/node-webkit Helper NP.app/Contents/MacOS/node-webkit Helper NP")?e.chmodSync(i+"Frameworks/node-webkit Helper NP.app/Contents/MacOS/node-webkit Helper NP","555"):e.chmodSync(i+"Frameworks/nwjs Helper NP.app/Contents/MacOS/nwjs Helper NP","555"),e.existsSync(i+"Frameworks/node-webkit Helper.app/Contents/MacOS/node-webkit Helper")?e.chmodSync(i+"Frameworks/node-webkit Helper.app/Contents/MacOS/node-webkit Helper","555"):e.chmodSync(i+"Frameworks/nwjs Helper.app/Contents/MacOS/nwjs Helper","555"),e.existsSync(i+"MacOS/node-webkit")?e.chmodSync(i+"MacOS/node-webkit","555"):e.chmodSync(i+"MacOS/nwjs","555")}),e.registerTask("chmod64","Add lost Permissions.",function(){var e=require("fs"),i=n.distMac64+"/netCanvas.app/Contents/";e.existsSync(i+"Frameworks/node-webkit Helper EH.app/Contents/MacOS/node-webkit Helper EH")?e.chmodSync(i+"Frameworks/node-webkit Helper EH.app/Contents/MacOS/node-webkit Helper EH","555"):e.chmodSync(i+"Frameworks/nwjs Helper EH.app/Contents/MacOS/nwjs Helper EH","555"),e.existsSync(i+"Frameworks/node-webkit Helper NP.app/Contents/MacOS/node-webkit Helper NP")?e.chmodSync(i+"Frameworks/node-webkit Helper NP.app/Contents/MacOS/node-webkit Helper NP","555"):e.chmodSync(i+"Frameworks/nwjs Helper NP.app/Contents/MacOS/nwjs Helper NP","555"),e.existsSync(i+"Frameworks/node-webkit Helper.app/Contents/MacOS/node-webkit Helper")?e.chmodSync(i+"Frameworks/node-webkit Helper.app/Contents/MacOS/node-webkit Helper","555"):e.chmodSync(i+"Frameworks/nwjs Helper.app/Contents/MacOS/nwjs Helper","555"),e.existsSync(i+"MacOS/node-webkit")?e.chmodSync(i+"MacOS/node-webkit","555"):e.chmodSync(i+"MacOS/nwjs","555")}),e.registerTask("createLinuxApp","Create linux distribution.",function(i){var s=this.async(),t=require("child_process"),o=t.exec,c="./"+("Linux64"===i?n.distLinux64:n.distLinux32);o("mkdir -p "+c+"; cp resources/node-webkit/"+i+"/nw.pak "+c+" && cp resources/node-webkit/"+i+"/nw "+c+"/node-webkit && cp resources/node-webkit/"+i+"/icudtl.dat "+c+"/icudtl.dat",function(n,i,t){var o=!0;i&&e.log.write(i),t&&e.log.write(t),null!==n&&(e.log.error(n),o=!1),s(o)})}),e.registerTask("createWindowsApp","Create windows distribution.",function(){var n=this.async(),i=require("concat-files");i(["buildTmp/nw.exe","buildTmp/app.nw"],"buildTmp/netCanvas.exe",function(){var i=require("fs");i.unlink("buildTmp/app.nw",function(s,t,o){t&&e.log.write(t),o&&e.log.write(o),null!==s?(e.log.error(s),n(!1)):i.unlink("buildTmp/nw.exe",function(i,s,t){var o=!0;s&&e.log.write(s),t&&e.log.write(t),null!==i&&(e.log.error(i),o=!1),n(o)})})})}),e.registerTask("setVersion","Set version to all needed files",function(n){var i=e.config.get(["config"]),s=i.app,t=i.resources,o=e.file.readJSON("package.json"),c=e.file.readJSON(s+"/package.json"),p=e.file.read(t+"/mac/Info.plist.tmp",{encoding:"UTF8"}),a=e.template.process(p,{data:{version:n}});o.version=n,c.version=n,e.file.write("package.json",JSON.stringify(o,null,2),{encoding:"UTF8"}),e.file.write(s+"/package.json",JSON.stringify(c,null,2),{encoding:"UTF8"}),e.file.write(t+"/mac/Info.plist",a,{encoding:"UTF8"})}),e.registerTask("createPlistFile","set node webkit and app relevant information to a new plist file",function(){var i=e.file.readJSON(".yo-rc.json"),s=n.resources,t="nwjs";(0===i.nodeWebkitVersion.indexOf("v0.8.")||0===i.nodeWebkitVersion.indexOf("v0.9.")||0===i.nodeWebkitVersion.indexOf("v0.10.")||0===i.nodeWebkitVersion.indexOf("v0.11."))&&(t="node-webkit");var o=e.file.read(s+"/mac/Info.plist.tmp",{encoding:"UTF8"}),c=e.template.process(o,{data:{nwExecutableName:t}});e.file.write(s+"/mac/Info.plist",c,{encoding:"UTF8"})}),e.registerTask("dist-linux",["clean:distLinux64","copy:appLinux","createLinuxApp:Linux64"]),e.registerTask("dist-linux32",["clean:distLinux32","copy:appLinux32","createLinuxApp:Linux32"]),e.registerTask("dist-win",["clean:distWin","copy:copyWinToTmp","compress:appToTmp","rename:zipToApp","createWindowsApp","compress:finalWindowsApp"]),e.registerTask("dist-mac",["clean:distMac64","createPlistFile","copy:webkit64","copy:appMacos64","rename:macApp64","chmod64"]),e.registerTask("dist-mac32",["clean:distMac32","createPlistFile","copy:webkit32","copy:appMacos32","rename:macApp32","chmod32"]),e.registerTask("check",["jshint"]),e.registerTask("dmg","Create dmg from previously created app folder in dist.",function(){var n=this.async(),i='resources/mac/package.sh "netCanvas"';require("child_process").exec(i,function(i,s,t){var o=!0;s&&e.log.write(s),t&&e.log.write(t),null!==i&&(e.log.error(i),o=!1),n(o)})})};