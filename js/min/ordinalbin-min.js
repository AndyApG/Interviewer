var OrdinalBin=function e(t){var o={},a=!1,n;o.options={targetEl:$(".container"),edgeType:"Dyad",criteria:{from:network.getNodes({type_t0:"Ego"})[0].id},variable:{label:"gender_p_t0",values:["Female","Male","Transgender","Don't Know","Won't Answer"]},heading:"Default Heading",subheading:"Default Subheading."},extend(o.options,t);var i,d,l,s=function(){o.destroy()},r=function(){var e=$(this).data("value"),t=l,a={to:t};extend(a,o.options.criteria);var n=network.getEdges(a)[0],i={};i[o.options.followup.variable]=e,extend(n,i),network.updateEdge(n.id,n),$(".followup").hide()};return o.destroy=function(){notify("Destroying ordinalBin.",0),window.removeEventListener("changeStageStart",s,!1),$(document).off("click",".followup-option",r)},o.init=function(){o.options.targetEl.append("<h1>"+o.options.heading+"</h1>"),o.options.targetEl.append('<p class="lead">'+o.options.subheading+"</p>"),o.options.targetEl.append('<div class="node-bucket"></div>'),"undefined"!=typeof o.options.followup&&(o.options.targetEl.append('<div class="followup"><h2>'+o.options.followup.prompt+"</h2></div>"),$.each(o.options.followup.values,function(e,t){$(".followup").append('<span class="btn btn-primary btn-block followup-option" data-value="'+t.value+'">'+t.label+"</span>")}));var e=o.options.variable.values.length;i=$(".container").outerWidth()/e-20,d=$(".container").outerHeight()-270,$.each(o.options.variable.values,function(e,t){var i=$('<div class="ord-node-bin node-bin-static d'+e+'" data-index="'+e.value+'"><h1>'+t.label+'</h1><p class="lead">(Empty)</p><div class="active-node-list"></div></div>');i.data("index",e),o.options.targetEl.append(i),$(".d"+e).droppable({accept:".draggable",drop:function(t,i){var d=i.draggable,s=$(this);console.log("index is: "+o.options.variable.values[e].value),o.options.variable.values[e].value>0&&($(".followup").show(),l=$(d).data("node-id")),$(d).appendTo(s.children(".active-node-list")),$(d).css({position:"",top:"",left:""});var r={};r[o.options.variable.label]=o.options.variable.values[e].value;var p=network.getEdges({from:network.getNodes({type_t0:"Ego"})[0].id,to:$(d).data("node-id"),type:o.options.edgeType})[0].id;network.updateEdge(p,r),$.each($(".ord-node-bin"),function(e){var t=$(".d"+e).children(".active-node-list").children().length;if(t>0){var o="people";1===t&&(o="person"),$(".d"+e+" p").html(t+" "+o+".")}else $(".d"+e+" p").html("(Empty)")});var c=$(".d"+e);setTimeout(function(){c.transition({background:c.data("oldBg")},200,"ease")},0),$(".draggable").draggable({cursor:"pointer",revert:"invalid",disabled:!1,start:function(){if(a===!1){var e={stage:session.currentStage(),timestamp:new Date};n=new CustomEvent("log",{detail:{eventType:"taskComprehended",eventObject:e}}),window.dispatchEvent(n),a=!0}$(".ord-node-bin").children(".active-node-list").css({overflow:"visible"})}})},over:function(){$(this).data("oldBg",$(this).css("background-color")),$(this).stop().transition({background:"rgba(255, 193, 0, 1.0)"},400,"ease")},out:function(){$(this).stop().transition({background:$(this).data("oldBg")},500,"ease")}})}),$(".ord-node-bin").css({width:i,height:d});var t=network.getEdges(o.options.criteria);console.log("edges"),console.log(t),$.each(t,function(e,t){var a;if("Dyad"!==o.options.criteria.type&&(console.log("dyadedge"),a=network.getEdges({from:t.from,to:t.to,type:"Dyad"})[0],console.log(a)),void 0!==t[o.options.variable.label]&&""!==t[o.options.variable.label]){e="error",$.each(o.options.variable.values,function(a,n){t[o.options.variable.label]===n.value&&(e=a)}),$(".d"+e).children(".active-node-list").append("Dyad"!==o.options.criteria.type?'<div class="node-item draggable" data-node-id="'+t.to+'">'+a.nname_t0+"</div>":'<div class="node-item draggable" data-node-id="'+t.to+'">'+t.nname_t0+"</div>");var n="people",i=$(".d"+e).children(".active-node-list").children().length;1===i&&(n="person"),$(".d"+e).children("p").html(0===i?"(Empty)":i+" "+n+".")}else $(".node-bucket").append("Dyad"!==o.options.criteria.type?'<div class="node-item draggable" data-node-id="'+t.to+'">'+a.nname_t0+"</div>":'<div class="node-item draggable" data-node-id="'+t.to+'">'+t.nname_t0+"</div>")}),$(".draggable").draggable({cursor:"pointer",revert:"invalid",disabled:!1,start:function(){if(a===!1){var e={stage:session.currentStage(),timestamp:new Date};n=new CustomEvent("log",{detail:{eventType:"taskComprehended",eventObject:e}}),window.dispatchEvent(n),a=!0}$(".ord-node-bin").children(".active-node-list").css({overflow:"visible"})}}),window.addEventListener("changeStageStart",s,!1),$(document).on("click",".followup-option",r)},o.init(),o};