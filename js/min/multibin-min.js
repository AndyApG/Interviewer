var MultiBin=function e(t){var i={},n;i.options={targetEl:$(".container"),edgeType:"Dyad",variable:{label:"multibin_variable",values:["Variable 1"]},heading:"Default Heading",subheading:"Default Subheading."};var o=!1;extend(i.options,t);var a=function(){i.destroy()},d=function(){var e=$(this).data("value"),t=n,o={to:t};extend(o,i.options.criteria);var a=network.getEdges(o)[0],d={};d[i.options.followup.variable]=e,extend(a,d),network.updateEdge(a.id,a),$(".followup").hide()},l=function(e){e.stopPropagation(),e.target!==e.currentTarget&&o===!0&&($(".container").children().removeClass("invisible"),$(".copy").removeClass("node-bin-active"),$(".copy").addClass("node-bin-static"),$(".copy").children("h1, p").show(),$(".copy").removeClass("copy"),$(".draggable").draggable({cursor:"pointer",revert:"invalid",disabled:!1}),o=!1)},s=function(e){if(e.stopPropagation(),o===!1){if($(".draggable").draggable({cursor:"pointer",revert:"invalid",disabled:!0}),!$(this).hasClass(".node-bin-active")){$(".container").children().not(this).addClass("invisible");var t=$(this).offset(),i=$(this);i.offset(t),i.addClass("node-bin-active copy"),i.removeClass("node-bin-static"),i.children("h1, p").hide(),i.children(".active-node-list").children(".node-item").css({top:0,left:20,opacity:0}),setTimeout(function(){i.addClass("node-bin-active"),$.each($(".active-node-list").children(),function(e,t){setTimeout(function(){$(t).transition({left:0,opacity:1})},50*e)})},400)}o=!0}},r=function(e){e.stopPropagation();var t=$(this),n=$(this).parent().parent().data("index");if($(this).parent().hasClass("active-node-list")){var o=network.getEdges({from:network.getNodes({type_t0:"Ego"})[0].id,to:t.data("node-id"),type:"Dyad"})[0].id,a={};a[i.options.variable.label]="",network.updateEdge(o,a),$(this).fadeOut(400,function(){$(this).appendTo(".node-bucket"),$(this).css("display","");var e="people";1===$(".c"+n).children(".active-node-list").children().length&&(e="person"),$(".c"+n).children("p").html(0===$(".c"+n).children(".active-node-list").children().length?"(Empty)":$(".c"+n).children(".active-node-list").children().length+" "+e+".")})}};return i.destroy=function(){notify("Destroying multiBin.",0),window.removeEventListener("changeStageStart",a,!1),$(".node-bin-static").off("click",s),$(".node-item").off("click",r),$(".content").off("click",l),$(document).off("click",".followup-option",d)},i.init=function(){i.options.targetEl.append("<h1>"+i.options.heading+"</h1>"),i.options.targetEl.append('<p class="lead">'+i.options.subheading+"</p>"),i.options.targetEl.append('<div class="node-bucket"></div>'),"undefined"!=typeof i.options.followup&&(i.options.targetEl.append('<div class="followup"><h2>'+i.options.followup.prompt+"</h2></div>"),$.each(i.options.followup.values,function(e,t){$(".followup").append('<span class="btn btn-primary btn-block followup-option" data-value="'+t.value+'">'+t.label+"</span>")}));for(var e=Math.floor(.66*i.options.variable.values.length),t=$(".container").outerWidth()/e,o=t;2*o>$(".container").height()-300;)o=.98*o;var c=network.getEdges({from:network.getNodes({type_t0:"Ego"})[0].id,type:i.options.edgeType}),p=!1;$.each(i.options.variable.values,function(t,o){t+1>e&&p===!1&&(i.options.targetEl.append("<br>"),p=!0);var a=$('<div class="node-bin node-bin-static c'+t+'" data-index="'+t+'"><h1>'+o+'</h1><p class="lead">(Empty)</p><div class="active-node-list"></div></div>');a.data("index",t),i.options.targetEl.append(a),$(".c"+t).droppable({accept:".draggable",drop:function(e,o){var a=o.draggable,d=$(this);i.options.variable.values[t].value>0&&($(".followup").show(),n=$(a).data("node-id")),$(a).appendTo(d.children(".active-node-list"));var l={};l[i.options.variable.label]=i.options.variable.values[t];var s=network.getEdges({from:network.getNodes({type_t0:"Ego"})[0].id,to:$(a).data("node-id"),type:"Dyad"})[0].id;console.log(l),console.log(s),network.updateEdge(s,l);var r="people";1===$(".c"+t+" .active-node-list").children().length&&(r="person"),$(".c"+t+" p").html($(".c"+t+" .active-node-list").children().length+" "+r+".");var c=$(".c"+t);c.transition({scale:1.2},200,"ease"),setTimeout(function(){c.transition({background:c.data("oldBg")},200,"ease"),c.transition({scale:1},200,"ease")},0)},over:function(){$(this).data("oldBg",$(this).css("background-color")),$(this).stop().transition({background:"rgba(255, 193, 0, 1.0)"},400,"ease")},out:function(){$(this).stop().transition({background:$(this).data("oldBg")},500,"ease")}})}),$(".node-bin").css({width:o-20,height:o-20}),$(".node-bin h1").css({marginTop:o/3}),$.each($(".node-bin"),function(e,t){var i=$(t).offset();$(t).data("oldPos",i),$(t).css(i)}),$(".node-bin").css({position:"absolute"}),$.each(c,function(e,t){if(void 0!==t[i.options.variable.label]&&""!==t[i.options.variable.label]){e=i.options.variable.values.indexOf(t[i.options.variable.label]),$(".c"+e).children(".active-node-list").append('<div class="node-item draggable" data-node-id="'+t.to+'">'+t.nname_t0+"</div>");var n="people";1===$(".c"+e).children(".active-node-list").children().length&&(n="person"),$(".c"+e).children("p").html(0===$(".c"+e).children(".active-node-list").children().length?"(Empty)":$(".c"+e).children(".active-node-list").children().length+" "+n+".")}else $(".node-bucket").append('<div class="node-item draggable" data-node-id="'+t.to+'">'+t.nname_t0+"</div>")}),$(".draggable").draggable({cursor:"pointer",revert:"invalid",disabled:!1}),window.addEventListener("changeStageStart",a,!1),$(".node-bin-static").on("click",s),$(".node-item").on("click",r),$(".content").on("click",l),$(document).on("click",".followup-option",d)},i.init(),i};