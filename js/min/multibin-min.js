var MultiBin=function e(o){var t={},i;t.options={targetEl:$(".container"),edgeType:"Dyad",variable:{label:"multibin_variable",values:["Variable 1"]},heading:"Default Heading",subheading:"Default Subheading."};var n=!1;extend(t.options,o);var a=function(){t.destroy()},l=function(){var e=$("#"+t.options.followup.variable).val(),o=i,n={to:o};extend(n,t.options.criteria);var a=network.getEdges(n)[0],l={};l[t.options.followup.variable]=e,extend(a,l),network.updateEdge(a.id,a),$("#"+t.options.followup.variable).val(""),$(".followup").hide()},d=function(){$("#"+t.options.followup.variable).val(""),$(".followup").hide()},s=function(e){e.stopPropagation(),e.target!==e.currentTarget&&n===!0&&($(".container").children().removeClass("invisible"),$(".copy").removeClass("node-bin-active"),$(".copy").addClass("node-bin-static"),$(".copy").children("h1, p").show(),$(".copy").removeClass("copy"),$(".draggable").draggable({cursor:"pointer",revert:"invalid",disabled:!1}),n=!1)},r=function(e){if(e.stopPropagation(),n===!1){if($(".draggable").draggable({cursor:"pointer",revert:"invalid",disabled:!0}),!$(this).hasClass(".node-bin-active")){$(".container").children().not(this).addClass("invisible");var o=$(this).offset(),t=$(this);t.offset(o),t.addClass("node-bin-active copy"),t.removeClass("node-bin-static"),t.children("h1, p").hide(),t.children(".active-node-list").children(".node-item").css({top:0,left:20,opacity:0}),setTimeout(function(){t.addClass("node-bin-active"),$.each($(".active-node-list").children(),function(e,o){setTimeout(function(){$(o).transition({left:0,opacity:1})},20*e)})},100)}n=!0}},c=function(e){e.stopPropagation();var o=$(this),i=$(this).parent().parent().data("index");if($(this).parent().hasClass("active-node-list")){var n=network.getEdges({from:network.getNodes({type_t0:"Ego"})[0].id,to:o.data("node-id"),type:"Dyad"})[0].id,a={};a[t.options.variable.label]="",network.updateEdge(n,a),$(this).fadeOut(400,function(){$(this).appendTo(".node-bucket"),$(this).css("display","");var e="people";1===$(".c"+i).children(".active-node-list").children().length&&(e="person"),$(".c"+i).children("p").html(0===$(".c"+i).children(".active-node-list").children().length?"(Empty)":$(".c"+i).children(".active-node-list").children().length+" "+e+".")})}};return t.destroy=function(){notify("Destroying multiBin.",0),window.removeEventListener("changeStageStart",a,!1),$(".node-bin-static").off("click",r),$(".node-item").off("click",c),$(".content").off("click",s),$(".followup-submit").off("click",l),$(".followup-cancel").off("click",d)},t.init=function(){t.options.targetEl.append("<h1>"+t.options.heading+"</h1>"),t.options.targetEl.append('<p class="lead">'+t.options.subheading+"</p>"),t.options.targetEl.append('<div class="node-bucket"></div>'),"undefined"!=typeof t.options.followup&&(t.options.targetEl.append('<div class="followup overlay"><h2>'+t.options.followup.prompt+'</h2><div class="row form-group"><input type="text" class="form-control '+t.options.followup.variable+'" id="'+t.options.followup.variable+'" required="" placeholder="Answer here..."></div><div class="row form-group"><button type="submit" class="btn btn-primary btn-block followup-submit">Continue</button></div></div>'),"undefined"!=typeof t.options.followup.cancel&&$(".overlay").children().last(".form-group").prepend('<button type="submit" class="btn btn-warning btn-block followup-cancel">'+t.options.followup.cancel+"</button>"));for(var e=Math.floor(.66*t.options.variable.values.length),o=$(".container").outerWidth()/e,n=o;2*n>$(".container").height()-300;)n=.98*n;var p=network.getEdges({from:network.getNodes({type_t0:"Ego"})[0].id,type:t.options.edgeType}),v=!1;$.each(t.options.variable.values,function(o,n){o+1>e&&v===!1&&(t.options.targetEl.append("<br>"),v=!0);var a=$('<div class="node-bin node-bin-static c'+o+'" data-index="'+o+'"><h1>'+n+'</h1><p class="lead">(Empty)</p><div class="active-node-list"></div></div>');a.data("index",o),t.options.targetEl.append(a),$(".c"+o).droppable({accept:".draggable",drop:function(e,n){var a=n.draggable,l=$(this);t.options.followup.trigger.indexOf(t.options.variable.values[o])>=0&&($(".followup").show(),$("#"+t.options.followup.variable).focus(),i=$(a).data("node-id")),$(a).appendTo(l.children(".active-node-list"));var d={};d[t.options.variable.label]=t.options.variable.values[o];var s=network.getEdges({from:network.getNodes({type_t0:"Ego"})[0].id,to:$(a).data("node-id"),type:"Dyad"})[0].id;console.log(d),console.log(s),network.updateEdge(s,d);var r="people";1===$(".c"+o+" .active-node-list").children().length&&(r="person"),$(".c"+o+" p").html($(".c"+o+" .active-node-list").children().length+" "+r+".");var c=$(".c"+o);c.transition({scale:1.2},200,"ease"),setTimeout(function(){c.transition({background:c.data("oldBg")},200,"ease"),c.transition({scale:1},200,"ease")},0)},over:function(){$(this).data("oldBg",$(this).css("background-color")),$(this).stop().transition({background:"rgba(255, 193, 0, 1.0)"},400,"ease")},out:function(){$(this).stop().transition({background:$(this).data("oldBg")},500,"ease")}})}),$(".node-bin").css({width:n-20,height:n-20}),$(".node-bin h1").css({marginTop:n/3}),$.each($(".node-bin"),function(e,o){var t=$(o).offset();$(o).data("oldPos",t),$(o).css(t)}),$(".node-bin").css({position:"absolute"}),$.each(p,function(e,o){if(void 0!==o[t.options.variable.label]&&""!==o[t.options.variable.label]){e=t.options.variable.values.indexOf(o[t.options.variable.label]),$(".c"+e).children(".active-node-list").append('<div class="node-item draggable" data-node-id="'+o.to+'">'+o.nname_t0+"</div>");var i="people";1===$(".c"+e).children(".active-node-list").children().length&&(i="person"),$(".c"+e).children("p").html(0===$(".c"+e).children(".active-node-list").children().length?"(Empty)":$(".c"+e).children(".active-node-list").children().length+" "+i+".")}else $(".node-bucket").append('<div class="node-item draggable" data-node-id="'+o.to+'">'+o.nname_t0+"</div>")}),$(".draggable").draggable({cursor:"pointer",revert:"invalid",disabled:!1}),window.addEventListener("changeStageStart",a,!1),$(".node-bin-static").on("click",r),$(".node-item").on("click",c),$(".content").on("click",s),$(".followup-submit").on("click",l),$(".followup-cancel").on("click",d)},t.init(),t};