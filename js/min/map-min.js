var GeoInterface=function e(){function e(e){var t=e.target,n;h===!1?(o(e),n={},n[u]=t.feature.properties.name,network.updateEdge(p[f].id,n),$(".map-node-location").html("<strong>Currently marked as:</strong> <br>"+t.feature.properties.name)):t.feature.properties.name===h?(a(e),h=!1,n={},n[u]=void 0,network.updateEdge(p[f].id,n)):(r(),o(e),n={},n[u]=t.feature.properties.name,network.updateEdge(p[f].id,n))}function t(){if(void 0!==p[f][u])if(h=p[f][u],"Homeless"===p[f][u]||"Jail"===p[f][u]){s();var e="Homeless";"Jail"===p[f][u]&&(e="in Jail"),$(".map-node-location").html("<strong>Currently marked as:</strong> <br>"+e)}else $.each(g._layers,function(e,t){t.feature.properties.name===p[f][u]&&($(".map-node-location").html("<strong>Currently marked as:</strong> <br>"+p[f][u]),n(t))});else s()}function o(e){var t=e.target;d.fitBounds(e.target.getBounds(),{maxZoom:14}),t.setStyle({fillOpacity:.8,fillColor:k[1]}),L.Browser.ie||L.Browser.opera||t.bringToFront(),h=t.feature.properties.name}function n(e){var t=e;d.fitBounds(e.getBounds(),{maxZoom:14}),t.setStyle({fillOpacity:.8,fillColor:k[1]}),L.Browser.ie||L.Browser.opera||t.bringToFront()}function a(e){$(".map-node-location").html(""),h=!1,g.resetStyle(e.target)}function r(){$(".map-node-location").html(""),h=!1,$.each(g._layers,function(e,t){g.resetStyle(t)})}function i(t,o){o.on({click:e})}function s(){d.setView([41.798395426119534,-87.83967137233888],11)}function l(){r();var e={};e[u]="Homeless",network.updateEdge(p[f].id,e),$(".map-node-location").html("<strong>Currently marked as:</strong> <br>Homeless")}function c(){r();var e={};e[u]="Jail",network.updateEdge(p[f].id,e),$(".map-node-location").html("<strong>Currently marked as:</strong> <br>in Jail")}var m={},d,p,u="res_chicago_location_p_t0",f=0,g,h=!1,k=["#67c2d4","#1ECD97","#B16EFF","#FA920D","#e85657","#20B0CA","#FF2592","#153AFF","#8708FF"];return m.nextPerson=function(){f<p.length-1&&(r(),f++,$(".current-id").html(f+1),$(".map-node-status").html("Tap on the map to indicate the general area where <strong>"+p[f].nname_t0+"</strong> lives."),t(),f===p.length-1?$(".map-forwards").hide():$(".map-forwards").show(),0===f?$(".map-back").hide():$(".map-back").show())},m.previousPerson=function(){f>0&&(r(),f--,$(".current-id").html(f+1),$(".map-node-status").html("Tap on the map to indicate the general area where <strong>"+p[f].nname_t0+"</strong> lives."),t(),f===p.length-1?$(".map-forwards").hide():$(".map-forwards").show(),0===f?$(".map-back").hide():$(".map-back").show())},m.init=function(){d=L.map("map",{maxBounds:[[41.4985986599114,-88.49824022406345],[42.1070175291862,-87.07098424716594]],zoomControl:!1}),L.tileLayer("img/Tiles/{z}/{x}/{y}.png",{maxZoom:17,minZoom:11}).addTo(d),$.ajax({dataType:"json",url:"data/census2010.json",success:function(e){g=L.geoJson(e,{onEachFeature:i,style:function(){return{weight:1,fillOpacity:0,strokeWidth:.2,color:k[1]}}}).addTo(d),p=network.getEdges({from:network.getNodes({type_t0:"Ego"})[0].id,type:"Dyad",res_cat_p_t0:"Chicago"}),$(".map-counter").html('<span class="current-id">1</span>/'+p.length),$(".map-node-status").html("Tap on the map to indicate the general area where <strong>"+p[0].nname_t0+"</strong> lives."),t(),$(".map-back").hide(),f===p.length-1?$(".map-forwards").hide():$(".map-forwards").show()}}).error(function(){});var e=new L.KML("data/transit.kml",{style:function(){return{stroke:k[1],fillColor:null,weight:1}}});d.addLayer(e),$(".map-back").on("click",m.previousPerson),$(".map-forwards").on("click",m.nextPerson),$(".homeless").on("click",l),$(".jail").on("click",c)},m.destroy=function(){$(".map-back").off("click",m.previousPerson),$(".map-forwards").off("click",m.nextPerson),$(".homeless").on("click",l),$(".jail").on("click",c)},m.init(),m};