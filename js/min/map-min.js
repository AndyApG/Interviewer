var GeoInterface=function e(){function e(e){if(d===!1){var t={zoomLevel:u.getZoom(),stage:session.currentStage(),timestamp:new Date};c=new CustomEvent("log",{detail:{eventType:"taskComprehended",eventObject:t}}),window.dispatchEvent(c),d=!0}var n={zoomLevel:u.getZoom(),timestamp:new Date};c=new CustomEvent("log",{detail:{eventType:"mapMarkerPlaced",eventObject:n}}),window.dispatchEvent(c);var i=e.target,s;k===!1?(o(e),s={},s[f]=i.feature.properties.name,network.updateEdge(g[h].id,s),$(".map-node-location").html("<strong>Currently marked as:</strong> <br>"+i.feature.properties.name)):i.feature.properties.name===k?(a(e),k=!1,s={},s[f]=void 0,network.updateEdge(g[h].id,s)):(r(),o(e),s={},s[f]=i.feature.properties.name,network.updateEdge(g[h].id,s))}function t(){if(void 0!==g[h][f])if(k=g[h][f],"Homeless"===g[h][f]||"Jail"===g[h][f]){s();var e="Homeless";"Jail"===g[h][f]&&(e="in Jail"),$(".map-node-location").html("<strong>Currently marked as:</strong> <br>"+e)}else $.each(w._layers,function(e,t){t.feature.properties.name===g[h][f]&&($(".map-node-location").html("<strong>Currently marked as:</strong> <br>"+g[h][f]),n(t))});else s()}function o(e){var t=e.target;u.fitBounds(e.target.getBounds(),{maxZoom:14}),t.setStyle({fillOpacity:.8,fillColor:v[1]}),L.Browser.ie||L.Browser.opera||t.bringToFront(),k=t.feature.properties.name}function n(e){var t=e;u.fitBounds(e.getBounds(),{maxZoom:14}),t.setStyle({fillOpacity:.8,fillColor:v[1]}),L.Browser.ie||L.Browser.opera||t.bringToFront()}function a(e){$(".map-node-location").html(""),k=!1,w.resetStyle(e.target)}function r(){$(".map-node-location").html(""),k=!1,$.each(w._layers,function(e,t){w.resetStyle(t)})}function i(t,o){o.on({click:e})}function s(){u.setView([41.798395426119534,-87.83967137233888],11)}function l(){r();var e={};e[f]="Homeless",network.updateEdge(g[h].id,e),$(".map-node-location").html("<strong>Currently marked as:</strong> <br>Homeless")}function m(){r();var e={};e[f]="Jail",network.updateEdge(g[h].id,e),$(".map-node-location").html("<strong>Currently marked as:</strong> <br>in Jail")}var c,d=!1,p={},u,g,f="res_chicago_location_p_t0",h=0,w,k=!1,v=["#67c2d4","#1ECD97","#B16EFF","#FA920D","#e85657","#20B0CA","#FF2592","#153AFF","#8708FF"];return p.nextPerson=function(){h<g.length-1&&(r(),h++,$(".current-id").html(h+1),$(".map-node-status").html("Tap on the map to indicate the general area where <strong>"+g[h].nname_t0+"</strong> lives."),t(),h===g.length-1?$(".map-forwards").hide():$(".map-forwards").show(),0===h?$(".map-back").hide():$(".map-back").show())},p.previousPerson=function(){h>0&&(r(),h--,$(".current-id").html(h+1),$(".map-node-status").html("Tap on the map to indicate the general area where <strong>"+g[h].nname_t0+"</strong> lives."),t(),h===g.length-1?$(".map-forwards").hide():$(".map-forwards").show(),0===h?$(".map-back").hide():$(".map-back").show())},p.init=function(){u=L.map("map",{maxBounds:[[41.4985986599114,-88.49824022406345],[42.1070175291862,-87.07098424716594]],zoomControl:!1}),L.tileLayer("img/Tiles/{z}/{x}/{y}.png",{maxZoom:17,minZoom:11}).addTo(u),$.ajax({dataType:"json",url:"data/census2010.json",success:function(e){w=L.geoJson(e,{onEachFeature:i,style:function(){return{weight:1,fillOpacity:0,strokeWidth:.2,color:v[1]}}}).addTo(u),g=network.getEdges({from:network.getNodes({type_t0:"Ego"})[0].id,type:"Dyad",res_cat_p_t0:"Chicago"}),$(".map-counter").html('<span class="current-id">1</span>/'+g.length),$(".map-node-status").html("Tap on the map to indicate the general area where <strong>"+g[0].nname_t0+"</strong> lives."),t(),$(".map-back").hide(),h===g.length-1?$(".map-forwards").hide():$(".map-forwards").show()}}).error(function(){});var e=new L.KML("data/transit.kml",{style:function(){return{stroke:v[1],fillColor:null,weight:1}}});u.addLayer(e),$(".map-back").on("click",p.previousPerson),$(".map-forwards").on("click",p.nextPerson),$(".homeless").on("click",l),$(".jail").on("click",m)},p.destroy=function(){$(".map-back").off("click",p.previousPerson),$(".map-forwards").off("click",p.nextPerson),$(".homeless").on("click",l),$(".jail").on("click",m)},p.init(),p};