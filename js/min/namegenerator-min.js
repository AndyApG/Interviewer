var Namegenerator=function e(t){var a={};a.options={nodeType:"Alter",edgeType:"Dyad",targetEl:$(".container"),variables:[],heading:"This is a default heading",subheading:"And this is a default subheading"},extend(a.options,t);var n=!1,o=!1,i=network.getNodes({type_t0:"Alter"}).length,r={Friend:["Best Friend","Friend","Ex-friend","Other type"],"Family/Relative":["Parent/Guardian","Brother/Sister","Grandparent","Other Family","Chosen Family"],"Romantic/Sexual Partner":["Boyfriend/Girlfriend","Ex-Boyfriend/Ex-Girlfriend","Booty Call/Fuck Buddy/Hook Up","One Night Stand","Other type of Partner"],"Acquaintaince/Associate":["Coworker-Colleague","Classmate","Roommate","Friend of a Friend","Neighbor","Other"],"Other Support/Source of Advice":["Teacher/Professor","Counselor/Therapist","Community Agency Staff","Religious Leader","Mentor","Coach","Other"],"Drug Use":["Someone you use drugs with","Someone you buy drugs from"],Other:[]},l=function(e){13===e.keyCode&&(e.preventDefault(),n===!1?a.openNodeBox():n===!0&&$(".submit-1").click()),27===e.keyCode&&a.closeNodeBox(),8!==e.keyCode||$(e.target).is("input, textarea")||e.preventDefault()},s=function(e){if(n===!0&&13!==e.keyCode&&$("#fname_t0").val().length>0&&$("#fname_t0").val().length>0){var t=$("#fname_t0").val()+" "+$("#lname_t0").val().charAt(0);$("#lname_t0").val().length>0&&(t+=".");var a=function(){$("#nname_t0").val(t)};setTimeout(a,0)}},d=function(){a.destroy()},p=function(){var e=$(this).data("index"),t=network.getEdges({from:network.getNodes({type_t0:"Ego"})[0].id,to:e,type:"Dyad"})[0];o=e,$.each(a.options.variables,function(e,n){n.private===!1&&("relationship"===n.type?$("select[name='"+n.variable+"']").val(t[n.variable]):"subrelationship"===n.type?($("select[name='reltype_sub_t0']").children().remove(),$("select[name='reltype_sub_t0']").append('<option value="">Choose a specific relationship</option>'),$.each(r[$("select[name='reltype_main_t0']").val()],function(e,t){$("select[name='reltype_sub_t0']").append('<option value="'+t+'">'+t+"</option>")}),$("select[name='"+n.variable+"']").val(t[n.variable]),$("select[name='reltype_sub_t0']").prop("disabled",!1),void 0!==t.reltype_oth_t0&&""!==t.reltype_oth_t0&&($(".reltype_oth_t0").val(t.reltype_oth_t0),$(".reltype_oth_t0").show())):$("#"+n.variable).val(t[n.variable]),a.openNodeBox())})},c=function(){a.closeNodeBox()},v=function(){return""===$("select[name='reltype_main_t0']").val()?($("select[name='reltype_sub_t0']").prop("disabled",!0),!1):($("select[name='reltype_sub_t0']").prop("disabled",!1),$("select[name='reltype_sub_t0']").children().remove(),$("select[name='reltype_sub_t0']").append('<option value="">Choose a specific relationship</option>'),void $.each(r[$("select[name='reltype_main_t0']").val()],function(e,t){$("select[name='reltype_sub_t0']").append('<option value="'+t+'">'+t+"</option>")}))},u=function(){"Other"===$("select[name='reltype_sub_t0']").val()?$(".reltype_oth_t0").show():($(".reltype_oth_t0").val(""),$(".reltype_oth_t0").hide())},b=function(e){e.preventDefault();var t={},n={};$.each(a.options.variables,function(e,a){"edge"===a.target?t[a.variable]=a.private===!0?a.value:"relationship"===a.type||"subrelationship"===a.type?$("select[name='"+a.variable+"']").val():$("#"+a.variable).val():"node"===a.target&&(n[a.variable]=a.private===!0?a.value:"relationship"===a.type||"subrelationship"===a.type?$("select[name='"+a.variable+"']").val():$("#"+a.variable).val())});var r={},l={};if(o===!1){extend(r,n);var s=network.addNode(r),d;$.each(a.options.edgeTypes,function(e,t){var n={},o=t;$.each(a.options.variables,function(e,t){"edge"===t.target&&t.edge===o&&(n[t.variable]=t.private===!0?t.value:"relationship"===t.type||"subrelationship"===t.type?$("select[name='"+t.variable+"']").val():$("#"+t.variable).val())}),l={from:network.getNodes({type_t0:"Ego"})[0].id,to:s,type:o},extend(l,n),d=network.addEdge(l)});var p=network.getEdges({to:s,type:"Dyad"})[0];a.addToList(p),i++,$(".alter-count-box").html(i)}else{var c=function(){var e=$("div[data-index="+o+"]");e.stop().transition({background:"rgba(51, 160, 117, 1)"},400,"ease"),setTimeout(function(){e.stop().transition({background:"rgba(238,238,238, 1)"},800,"ease")},1500)},v=o;$.each(a.options.edgeTypes,function(e,t){var n=t,i={};$.each(a.options.variables,function(e,t){"edge"===t.target&&t.edge===n&&(i[t.variable]=t.private===!0?t.value:"relationship"===t.type||"subrelationship"===t.type?$("select[name='"+t.variable+"']").val():$("#"+t.variable).val())});var r=network.getEdges({from:network.getNodes({type_t0:"Ego"})[0].id,to:o,type:t});$.each(r,function(e,t){network.updateEdge(t.id,i,c)})}),network.updateNode(v,n);var u=extend(t,n);$("div[data-index="+o+"]").html(""),$("div[data-index="+o+"]").append("<h4>"+u.nname_t0+"</h4>");var b=$("<ul></ul>");$.each(a.options.variables,function(e,t){t.private===!1&&void 0!==u[t.variable]&&""!==u[t.variable]&&b.append('<li class="'+u[t.variable]+'"><strong>'+t.label+"</strong>: "+u[t.variable]+"</li>")}),$("div[data-index="+o+"]").append(b),o=!1}a.closeNodeBox()};return a.openNodeBox=function(){$(".newNodeBox").transition({scale:1,opacity:1},300),$("#ngForm input:text").first().focus(),n=!0},a.closeNodeBox=function(){$(".newNodeBox").transition({scale:.1,opacity:0},500),n=!1,$("#ngForm").trigger("reset"),$(".reltype_oth_t0").hide(),o=!1},a.destroy=function(){notify("Destroying namegenerator.",0),$(document).off("keydown",l),$(".cancel").off("click",c),$("#fname_t0, #lname_t0").off("keyup",s),$(document).off("click",".card",p),$("select[name='reltype_main_t0']").off("change",v),$("select[name='reltype_sub_t0']").off("change",u),$("#ngForm").off("submit",b),window.removeEventListener("changeStageStart",d,!1)},a.init=function(){var e=$('<h1 class="text-center"></h1>').html(a.options.heading);a.options.targetEl.append(e);var t=$('<p class="lead"></p>').html(a.options.subheading);a.options.targetEl.append(t);var n=$('<div class="alter-count-box"></div>');a.options.targetEl.append(n);var o=$('<div class="newNodeBox"><form role="form" id="ngForm" class="form"><div class="col-sm-6 left"><h2 style="margin-top:0">Adding a Node</h2><ul><li>Try to be as accurate as you can, but don\'t worry if you aren\'t sure.</li><li>We are interested in your perceptions, so there are no right answers!</li><li>You can use the tab key to quickly move between the fields.</li><li>You can use the enter key to submit the form.</li></ul></div><div class="col-sm-6 right"></div></form></div>');a.options.targetEl.append(o),$.each(a.options.variables,function(e,t){if(t.private!==!0){var a,n;switch(t.type){case"text":a=$('<div class="form-group '+t.variable+'"><label class="sr-only" for="'+t.variable+'">'+t.label+'</label><input type="text" class="form-control '+t.variable+'" id="'+t.variable+'" placeholder="'+t.label+'"></div></div>');break;case"number":a=$('<div class="form-group '+t.variable+'"><label class="sr-only" for="'+t.variable+'">'+t.label+'</label><input type="number" class="form-control '+t.variable+'" id="'+t.variable+'" placeholder="'+t.label+'"></div></div>');break;case"relationship":n=$('<select class="form-control" name="'+t.variable+'"><option value="">Choose a relationship category</option></select>'),$.each(r,function(e){n.append('<option value="'+e+'">'+e+"</option>")}),a=$('<div class="form-group '+t.variable+'"></div></div>'),a.append(n);break;case"subrelationship":n=$('<select class="form-control" name="'+t.variable+'"><option value="">Choose a specific relationship</option></select>'),$.each(r,function(e){n.append('<option value="'+e+'">'+e+"</option>")}),a=$('<div class="form-group '+t.variable+'"></div>'),a.append(n)}$(".newNodeBox .form .right").append(a),t.required===!0&&("relationship"===t.type?$("select[name='"+t.variable+"']").prop("required",!0):$("#"+t.variable).prop("required",!0))}}),$("select[name='reltype_sub_t0']").prop("disabled",!0);var h=$('<div class="col-sm-6 text-center"><button type="submit" class="btn btn-primary btn-block submit-1">Add</button></div><div class="col-sm-6"><span class="btn btn-danger btn-block cancel">Cancel</span></div>');$(".newNodeBox .form .right").append(h),$(".reltype_oth_t0").hide();var m=$('<div class="node-container"></div>');a.options.targetEl.append(m);var f=$('<div class="table nameList"></div>');$(".node-container").append(f),window.addEventListener("changeStageStart",d,!1),$(document).on("keydown",l),$(".cancel").on("click",c),$("#fname_t0, #lname_t0").on("keyup",s),$(document).on("click",".card",p),$("select[name='reltype_main_t0']").on("change",v),$("select[name='reltype_sub_t0']").on("change",u),$("#ngForm").on("submit",b),$(".alter-count-box").html(i)},a.addToList=function(e){var t;t=$('<div class="card" data-index="'+e.to+'"><h4>'+e.nname_t0+"</h4></div>");var n=$("<ul></ul>");$.each(a.options.variables,function(t,a){a.private===!1&&void 0!==e[a.variable]&&""!==e[a.variable]&&n.append('<li class="'+e[a.variable]+'"><strong>'+a.label+"</strong>: "+e[a.variable]+"</li>")}),t.append(n),$(".nameList").append(t)},a.update=function(e){var t={};$.each(a.options.variables,function(a,n){t[n.variable]=n.private===!0?n.value:$("div[data-index="+e+"]").children("."+n.variable).html()});var n=function(){$("tr[data-index="+e+"]").stop().transition({background:"rgba(51, 160, 117, 1)"},800,"ease"),setTimeout(function(){$("tr[data-index="+e+"]").stop().transition({background:"rgba(0,0,0,0)"},1800,"ease")},1500),$("#ngForm input:text").first().focus()};network.updateEdge(e,t,n)},a.init(),a};