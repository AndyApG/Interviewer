"use strict";var NetworkCanvas=function e(t){var o,n,r,i,a,d={},s=[],l=!1,c=!1,h={blue:"#0174DF",placidblue:"#83b5dd",violettulip:"#9B90C8",hemlock:"#9eccb3",paloma:"#aab1b0",freesia:"#ffd600",cayenne:"#c40000",celosiaorange:"#f47d44",sand:"#ceb48d",dazzlingblue:"#006bb6",edge:"#bbb",selected:"gold"},f={defaultNodeSize:20,defaultNodeColor:h.blue,defaultEdgeColor:h.edge,concentricCircleColor:"#ffffff",concentricCircleNumber:4,nodeTypes:[{name:"Person",color:h.blue},{name:"OnlinePerson",color:h.hemlock},{name:"Organisation",color:h.cayenne},{name:"Professional",color:h.violettulip}]},u=["Barney","Jonathon","Myles","Alethia","Tammera","Veola","Meredith","Renee","Grisel","Celestina","Fausto","Eliana","Raymundo","Lyle","Carry","Kittie","Melonie","Elke","Mattie","Kieth","Lourie","Marcie","Trinity","Librada","Lloyd","Pearlie","Velvet","Stephan","Hildegard","Winfred","Tempie","Maybelle","Melynda","Tiera","Lisbeth","Kiera","Gaye","Edra","Karissa","Manda","Ethelene","Michelle","Pamella","Jospeh","Tonette","Maren","Aundrea","Madelene","Epifania","Olive"];return d.init=function(){d.initKinetic(),d.drawUIComponents(),extend(f,t),session.registerData("nodes"),session.registerData("edges")},d.addNode=function(e){var t,o=d.getNodes(),n=Math.round(randomBetween(0,f.nodeTypes.length-1)),a={coords:[$(window).width()+50,100],id:o.length+1,label:u[Math.round(randomBetween(0,u.length-1))],size:f.defaultNodeSize,type:f.nodeTypes[n].name,color:f.nodeTypes[n].color,strokeWidth:4};extend(a,e),a.id=parseInt(a.id,10);var l=new Kinetic.Group({id:a.id,x:a.coords[0],y:a.coords[1],name:a.label,edges:[],type:a.type,nodeSize:a.size,color:a.color,draggable:!0,dragDistance:10});switch(a.type){case"Person":t=new Kinetic.Circle({radius:a.size,fill:a.color,stroke:d.calculateStrokeColor(a.color),strokeWidth:a.strokeWidth});break;case"Organisation":t=new Kinetic.Rect({width:2*a.size,height:2*a.size,fill:a.color,stroke:d.calculateStrokeColor(a.color),strokeWidth:a.strokeWidth,offset:{x:a.size,y:a.size}});break;case"OnlinePerson":t=new Kinetic.RegularPolygon({sides:3,fill:a.color,radius:1.2*a.size,stroke:d.calculateStrokeColor(a.color),strokeWidth:a.strokeWidth});break;case"Professional":t=new Kinetic.Star({numPoints:6,fill:a.color,innerRadius:a.size-a.size/3,outerRadius:a.size+a.size/3,stroke:d.calculateStrokeColor(a.color),strokeWidth:a.strokeWidth})}var c=new Kinetic.Text({text:a.label,fontSize:20,fontFamily:"Lato",fill:"white",offsetX:-1*a.size-10,offsetY:1*a.size-10,fontStyle:500});if(l.add(t),l.add(c),notify("Putting node "+a.label+" at coordinates x:"+a.coords[0]+", y:"+a.coords[1],2),session.log("nodeCreate",a,a.id),l.on("dragstart",function(){notify("dragstart",0),this.attrs.oldx=this.attrs.x,this.attrs.oldy=this.attrs.y,this.moveToTop(),i.draw()}),l.on("dragmove",function(){notify("Dragmove",0);var e=this;$.each(r.children,function(t,o){if(o.attrs.from===e||o.attrs.to===e){var n=[o.attrs.from.attrs.x,o.attrs.from.attrs.y,o.attrs.to.attrs.x,o.attrs.to.attrs.y];o.attrs.points=n}}),r.draw()}),l.on("tap click",function(){notify("tap or click.",0),session.log("nodeClick",this,this.attrs.id),this.moveToTop(),i.draw()}),l.on("dbltap dblclick",function(){notify("double tap",0),s.push(this),2===s.length?(d.addEdge(s[0],s[1])||d.removeEdge(s[0],s[1]),s[0].children[0].stroke(d.calculateStrokeColor(d.getNodeColorByType(s[0].attrs.type))),s[1].children[0].stroke(d.calculateStrokeColor(d.getNodeColorByType(s[1].attrs.type))),s=[],i.draw()):(this.children[0].stroke(h.selected),i.draw())}),l.on("dragend",function(){notify("dragend",0);var e={},t={};e.x=this.attrs.oldx,e.y=this.attrs.oldy,t.x=this.attrs.x,t.y=this.attrs.y;var o={from:e,to:t};session.log("nodeMove",o,this.attrs.id),d.saveGraph(),delete this.attrs.oldx,delete this.attrs.oldy}),i.add(l),l.moveToBottom(),i.draw(),d.saveGraph(),!e.coords){var g=new Kinetic.Tween({node:l,x:$(window).width()-150,y:100,duration:.7,easing:Kinetic.Easings.EaseOut});g.play()}return l},d.addEdge=function(e,t){var o=!1,n,a,s;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t?(n=e,a=t):(n=this.getNodeByID(e),a=this.getNodeByID(t)),r.children.length>0&&$.each(r.children,function(e,t){(t.attrs.from===n&&t.attrs.to===a||t.attrs.to===n&&t.attrs.from===a)&&(s=t,o=!0)}),o)return!1;var l=[n.attrs.x,n.attrs.y,a.attrs.x,a.attrs.y],c=new Kinetic.Line({strokeWidth:2,opacity:.5,stroke:f.defaultEdgeColor,from:n,to:a,points:l});r.add(c),r.draw(),i.draw(),notify("Created Edge between "+n.children[1].attrs.text+" and "+a.children[1].attrs.text,"success",2);var h=d.getSimpleEdge(r.children.length-1);return session.log("edgeCreate",h,"0"),d.saveGraph(),!0},d.removeEdge=function(e){notify("Removing edge."),$.each(r.children,function(t,o){o===e&&(r.children[t].remove(),r.draw())}),this.saveGraph()},d.calculateStrokeColor=function(e){return modifyColor(e,15)},d.clearGraph=function(){r.removeChildren(),r.clear(),i.removeChildren(),i.clear(),d.saveGraph()},d.createRandomGraph=function(e,t){e=e||10,t=t||.4;var o=d.getNodes();notify("Creating random graph...",3);for(var n=0;e>n;n++){var r=n+1;notify("Adding node "+r+" of "+e,1);var i={coords:[Math.round(randomBetween(100,window.innerWidth-100)),Math.round(randomBetween(100,window.innerHeight-100))]};d.addNode(i)}notify("Adding edges.",3),$.each(o,function(e){if(randomBetween(0,1)<t){var n=Math.round(randomBetween(0,o.length-1));d.addEdge(o[e],o[n])}})},d.initKinetic=function(){o=new Kinetic.Stage({container:"kineticCanvas",width:window.innerWidth,height:window.innerHeight}),n=new Kinetic.Layer,i=new Kinetic.Layer,r=new Kinetic.Layer,a=new Kinetic.Layer,o.add(n),o.add(r),o.add(i),o.add(a),notify("Kinetic stage initialised.",3)},d.drawUIComponents=function(){for(var e,t,o=f.concentricCircleColor,r=window.innerHeight-2*f.defaultNodeSize,i=.1,s=0;s<f.concentricCircleNumber;s++){var l=1-s/f.concentricCircleNumber,c=r/2*l;t=new Kinetic.Circle({x:window.innerWidth/2,y:window.innerHeight/2,radius:c,stroke:"white",strokeWidth:1.5,opacity:0}),e=new Kinetic.Circle({x:window.innerWidth/2,y:window.innerHeight/2,radius:c,fill:o,opacity:i,strokeWidth:0}),i+=(.3-i)/f.concentricCircleNumber,n.add(e),n.add(t)}var h=new Kinetic.Circle({radius:50,stroke:"#666",strokeWidth:0,y:window.innerHeight-100,x:100});h.on("click tap",function(){}),a.add(h),n.draw(),a.draw(),d.initNewNodeForm(),notify("User interface initialised.",3)},d.initNewNodeForm=function(){var e=$('<div class="new-node-form"></div>'),t=$('<div class="new-node-inner"></div>');e.append(t),t.append("<h1>Add a new contact</h1>"),t.append("<p>Some text accompanying the node creation box.</p>"),t.append('<input type="text" class="form-control name-box"></input>'),$(".content").after(e),$(document).on("keypress",function(e){if(!c&&(l||($(".new-node-form").addClass("node-form-open"),$(".content").addClass("blurry"),l=!0,$(".name-box").focus()),8!==e.which||$(e.target).is("input, textarea, div")||e.preventDefault(),13===event.which)){$(".new-node-form").removeClass("node-form-open"),$(".content").removeClass("blurry"),l=!1;var t={label:$(".name-box").val()};d.addNode(t),$(".name-box").val("")}})},d.loadGraph=function(){notify("Loading graph from localStorage.",3);var e=localStorage.getObject("nodes")||{},t=localStorage.getObject("edges")||{};$.each(e,function(e,t){var o={coords:[t.x,t.y],id:e,type:t.type,label:t.name,color:t.color};d.addNode(o)}),$.each(t,function(e,t){d.addEdge(t.from,t.to)})},d.saveGraph=function(){notify("Saving graph.",3);var e=d.getSimpleNodes(),t=d.getSimpleEdges();session.addData("nodes",e),session.addData("edges",t),session.saveData()},d.getNodes=function(){return i.children},d.getEdges=function(){return r.children},d.getSimpleNodes=function(){var e={},t=d.getNodes();return $.each(t,function(t,o){e[o.attrs.id]={},e[o.attrs.id].x=o.attrs.x,e[o.attrs.id].y=o.attrs.y,e[o.attrs.id].name=o.attrs.name,e[o.attrs.id].type=o.attrs.type,e[o.attrs.id].size=o.attrs.size,e[o.attrs.id].color=o.attrs.color}),e},d.getSimpleEdges=function(){var e={},t=0;return $.each(r.children,function(o,n){e[t]={},e[t].from=n.attrs.from.attrs.id,e[t].to=n.attrs.to.attrs.id,t++}),e},d.getSimpleEdge=function(e){var t=d.getSimpleEdges();if(!e)return!1;var o=t[e];return o},d.getEdgeLayer=function(){return r},d.getNodeByID=function(e){var t={},o=d.getNodes();return $.each(o,function(o,n){n.attrs.id===e&&(t=n)}),t},d.getNodeColorByType=function(e){var t=null;return $.each(f.nodeTypes,function(o,n){n.name===e&&(t=n.color)}),t?t:!1},d.init(),d};
//# sourceMappingURL=./NetworkCanvas-min.map