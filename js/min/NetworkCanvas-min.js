"use strict";var NetworkCanvas=function e(t){var o,n,r,i,a,d={},s=!1,c=!1,l=new Logger,h=[],g={};g.blue="#0174DF",g.placidblue="#83b5dd",g.violettulip="#9B90C8",g.hemlock="#9eccb3",g.paloma="#aab1b0",g.freesia="#ffd600",g.cayenne="#c40000",g.celosiaorange="#f47d44",g.sand="#ceb48d",g.dazzlingblue="#006bb6",g.edge="#999",g.selected="gold";var u={defaultNodeSize:20,defaultNodeColor:g.blue,defaultEdgeColor:g.edge,concentricCircleColor:"#ffffff",concentricCircleNumber:4,nodeTypes:[{name:"Person",color:g.blue},{name:"OnlinePerson",color:g.hemlock},{name:"Organisation",color:g.cayenne},{name:"Professional",color:g.violettulip}]};$.extend(!0,u,t);var f=["Barney","Jonathon","Myles","Alethia","Tammera","Veola","Meredith","Renee","Grisel","Celestina","Fausto","Eliana","Raymundo","Lyle","Carry","Kittie","Melonie","Elke","Mattie","Kieth","Lourie","Marcie","Trinity","Librada","Lloyd","Pearlie","Velvet","Stephan","Hildegard","Winfred","Tempie","Maybelle","Melynda","Tiera","Lisbeth","Kiera","Gaye","Edra","Karissa","Manda","Ethelene","Michelle","Pamella","Jospeh","Tonette","Maren","Aundrea","Madelene","Epifania","Olive"];return d.init=function(){d.initKinetic(),d.drawUIComponents(),l.init(),$("#new-name-box").focus()},d.addNode=function(e,t,o,n,a,s){var c;if(!t){var y=d.getNodes();t=y.length}t=parseInt(t,10);var m={};m.coords=e||[$(window).width()+50,100],m.size=o||u.defaultNodeSize,m.label=a||f[Math.round(randomBetween(0,f.length-1))],m.id=t;var w=Math.round(randomBetween(0,u.nodeTypes.length-1));m.type=n||u.nodeTypes[w].name,m.color=s||u.nodeTypes[w].color,m.strokeWidth=4;var p=new Kinetic.Group({id:m.id,x:m.coords[0],y:m.coords[1],name:m.label,edges:[],type:m.type,nodeSize:m.size,color:m.color,draggable:!0,dragDistance:10});switch(m.type){case"Person":c=new Kinetic.Circle({radius:m.size,fill:m.color,stroke:d.calculateStrokeColor(m.color),strokeWidth:m.strokeWidth});break;case"Organisation":c=new Kinetic.Rect({width:2*m.size,height:2*m.size,fill:m.color,stroke:d.calculateStrokeColor(m.color),strokeWidth:m.strokeWidth,offset:{x:m.size,y:m.size}});break;case"OnlinePerson":c=new Kinetic.RegularPolygon({sides:3,fill:m.color,radius:1.2*m.size,stroke:d.calculateStrokeColor(m.color),strokeWidth:m.strokeWidth});break;case"Professional":c=new Kinetic.Star({numPoints:6,fill:m.color,innerRadius:m.size-m.size/3,outerRadius:m.size+m.size/3,stroke:d.calculateStrokeColor(m.color),strokeWidth:m.strokeWidth})}var v=new Kinetic.Text({text:m.label,fontSize:20,fontFamily:"Futura",fill:"white",stroke:"black",strokeWidth:.2,offsetX:-1*m.size-10,offsetY:1*m.size-10,fontStyle:500});if(p.add(c),p.add(v),notify("Putting node "+m.label+" at coordinates x:"+m.coords[0]+", y:"+m.coords[1],2),l.addToLog("nodeCreate",m,m.id),p.on("dragstart",function(){notify("dragstart",0),this.attrs.oldx=this.attrs.x,this.attrs.oldy=this.attrs.y,this.moveToTop(),i.draw()}),p.on("dragmove",function(){notify("Dragmove",0);var e=this;$.each(r.children,function(t,o){if(o.attrs.from===e||o.attrs.to===e){var n=[o.attrs.from.attrs.x,o.attrs.from.attrs.y,o.attrs.to.attrs.x,o.attrs.to.attrs.y];o.attrs.points=n}}),r.draw()}),p.on("tap click",function(){notify("tap or click.",0),l.addToLog("nodeClick",this,this.attrs.id),this.moveToTop(),i.draw()}),p.on("dbltap dblclick",function(){notify("double tap",0),h.push(this),2===h.length?(d.addEdge(h[0],h[1])||d.removeEdge(h[0],h[1]),h[0].children[0].stroke(d.calculateStrokeColor(d.getNodeColorByType(h[0].attrs.type))),h[1].children[0].stroke(d.calculateStrokeColor(d.getNodeColorByType(h[1].attrs.type))),h=[],i.draw()):(this.children[0].stroke(g.selected),i.draw())}),p.on("dragend",function(){notify("dragend",0);var e={},t={};e.x=this.attrs.oldx,e.y=this.attrs.oldy,t.x=this.attrs.x,t.y=this.attrs.y;var o={from:e,to:t};l.addToLog("nodeMove",o,this.attrs.id),d.saveGraph(),delete this.attrs.oldx,delete this.attrs.oldy}),i.add(p),p.moveToBottom(),i.draw(),d.saveGraph(),!e){var k=new Kinetic.Tween({node:p,x:$(window).width()-150,y:100,duration:.7,easing:Kinetic.Easings.EaseOut});k.play()}return p},d.addEdge=function(e,t){var o=!1,n,a,s;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t?(n=e,a=t):(n=this.getNodeByID(e),a=this.getNodeByID(t)),r.children.length>0&&$.each(r.children,function(e,t){(t.attrs.from===n&&t.attrs.to===a||t.attrs.to===n&&t.attrs.from===a)&&(s=t,o=!0)}),o)return!1;var c=[n.attrs.x,n.attrs.y,a.attrs.x,a.attrs.y],h=new Kinetic.Line({strokeWidth:2,opacity:.5,stroke:u.defaultEdgeColor,from:n,to:a,points:c});r.add(h),r.draw(),i.draw(),notify("Created Edge between "+n.children[1].attrs.text+" and "+a.children[1].attrs.text,"success",2);var g=d.getSimpleEdge(r.children.length-1);return l.addToLog("edgeCreate",g,"0"),d.saveGraph(),!0},d.removeEdge=function(e){notify("Removing edge."),$.each(r.children,function(t,o){o===e&&(r.children[t].remove(),r.draw())}),this.saveGraph()},d.calculateStrokeColor=function(e){return modifyColor(e,15)},d.clearGraph=function(){r.removeChildren(),r.clear(),i.removeChildren(),i.clear(),d.saveGraph()},d.createRandomGraph=function(e,t){e=e||10,t=t||.4;var o=d.getNodes();notify("Creating random graph...",3);for(var n=0;e>n;n++){var r=n+1;notify("Adding node "+r+" of "+e,1),d.addNode([Math.round(randomBetween(100,window.innerWidth-100)),Math.round(randomBetween(100,window.innerHeight-100))],o.length)}notify("Adding edges.",3),$.each(o,function(e){if(randomBetween(0,1)<t){var n=Math.round(randomBetween(0,o.length-1));d.addEdge(o[e],o[n])}})},d.initKinetic=function(){o=new Kinetic.Stage({container:"kineticCanvas",width:window.innerWidth,height:window.innerHeight}),n=new Kinetic.Layer,i=new Kinetic.Layer,r=new Kinetic.Layer,a=new Kinetic.Layer,o.add(n),o.add(r),o.add(i),o.add(a),notify("Kinetic stage initialised.",3)},d.drawUIComponents=function(){for(var e,t,r=u.concentricCircleColor,i=window.innerHeight-2*u.defaultNodeSize,l=.1,h=0;h<u.concentricCircleNumber;h++){var g=1-h/u.concentricCircleNumber,f=i/2*g;t=new Kinetic.Circle({x:window.innerWidth/2,y:window.innerHeight/2,radius:f,stroke:"white",strokeWidth:1.5,opacity:0}),e=new Kinetic.Circle({x:window.innerWidth/2,y:window.innerHeight/2,radius:f,fill:r,opacity:l,strokeWidth:0}),l+=(.3-l)/u.concentricCircleNumber,n.add(e),n.add(t)}var y=new Kinetic.Circle({radius:50,stroke:"#666",strokeWidth:0,y:window.innerHeight-100,x:100});y.on("click tap",function(){var e=o.getPointerPosition(),t=[],n=d.getNodes();t[0]=e.x,t[1]=e.y,d.addNode(t,n.length),y.moveToBottom(),a.draw()}),a.add(y),n.draw(),a.draw(),$(document).on("keypress",function(e){$("#generate-graph").data()["bs.modal"].isShown||($("#new-name-box").focus(),8!==e.which||$(e.target).is("input, textarea, div")||e.preventDefault(),13!==event.which?(menu.close(),s===!1&&c===!1&&(s=!0,$("#newNodeForm").css("z-index",9999),$("#newNodeForm").transition({opacity:"1",marginTop:"0"},50,"easeInSine"),$("#newNodeForm > *").transition({opacity:"1",right:"0"},400,"easeInSine").promise().done(function(){s=!1,c=!0}))):s||(s=!0,$("#newNodeForm").css("z-index",0),$("#newNodeForm").transition({scale:"2",opacity:"0",marginTop:"0"},300,"easeInSine").promise().done(function(){$("#newNodeForm > *").transition({opacity:"0",right:"100px"}),$("#newNodeForm").transition({scale:"1"}),s=!1,c=!1,$("#new-name-box").focus()})))}),notify("User interface initialised.",3)},d.loadGraph=function(){notify("Loading graph from localStorage.",3);var e=localStorage.getObject("nodes")||{},t=localStorage.getObject("edges")||{};$.each(e,function(e,t){var o=[];o.push(t.x),o.push(t.y),d.addNode(o,e,t.nodeSize,t.type,t.name,t.color)}),$.each(t,function(e,t){d.addEdge(t.from,t.to)})},d.saveGraph=function(){notify("Saving graph.",3);var e=d.getSimpleNodes(),t=d.getSimpleEdges(),o=d.getLog();localStorage.setObject("nodes",e),localStorage.setObject("edges",t),localStorage.setObject("log",o)},d.getNodes=function(){return i.children},d.getEdges=function(){return r.children},d.getSimpleNodes=function(){var e={},t=d.getNodes();return $.each(t,function(t,o){e[o.attrs.id]={},e[o.attrs.id].x=o.attrs.x,e[o.attrs.id].y=o.attrs.y,e[o.attrs.id].name=o.attrs.name,e[o.attrs.id].type=o.attrs.type,e[o.attrs.id].size=o.attrs.size,e[o.attrs.id].color=o.attrs.color}),e},d.getSimpleEdges=function(){var e={},t=0;return $.each(r.children,function(o,n){e[t]={},e[t].from=n.attrs.from.attrs.id,e[t].to=n.attrs.to.attrs.id,t++}),e},d.getSimpleEdge=function(e){var t=d.getSimpleEdges();if(!e)return!1;var o=t[e];return o},d.getEdgeLayer=function(){return r},d.getNodeByID=function(e){var t={},o=d.getNodes();return $.each(o,function(o,n){n.attrs.id===e&&(t=n)}),t},d.getNodeColorByType=function(e){var t=null;return $.each(u.nodeTypes,function(o,n){n.name===e&&(t=n.color)}),t?t:!1},d.getLog=function(){return l},d.getLastEvent=function(){return l[l.length-1]},d.init(),d};
//# sourceMappingURL=./NetworkCanvas-min.map