/* sigmajs.org - an open-source light-weight JavaScript graph drawing library - Version: 0.1 - Author:  Alexis Jacomy - License: MIT */
var sigma={tools:{},classes:{},instances:{}};
(function(){Array.prototype.some||(Array.prototype.some=function(l,v){var f=this.length;if("function"!=typeof l)throw new TypeError;for(var m=0;m<f;m++)if(m in this&&l.call(v,this[m],m,this))return!0;return!1});Array.prototype.forEach||(Array.prototype.forEach=function(l,v){var f=this.length;if("function"!=typeof l)throw new TypeError;for(var m=0;m<f;m++)m in this&&l.call(v,this[m],m,this)});Array.prototype.map||(Array.prototype.map=function(l,v){var f=this.length;if("function"!=typeof l)throw new TypeError;
for(var m=Array(f),t=0;t<f;t++)t in this&&(m[t]=l.call(v,this[t],t,this));return m});Array.prototype.filter||(Array.prototype.filter=function(l,v){var f=this.length;if("function"!=typeof l)throw new TypeError;for(var m=[],t=0;t<f;t++)if(t in this){var z=this[t];l.call(v,z,t,this)&&m.push(z)}return m});Object.keys||(Object.keys=function(){var l=Object.prototype.hasOwnProperty,v=!{toString:null}.propertyIsEnumerable("toString"),f="toString toLocaleString valueOf hasOwnProperty isPrototypeOf propertyIsEnumerable constructor".split(" "),
m=f.length;return function(t){if("object"!==typeof t&&"function"!==typeof t||null===t)throw new TypeError("Object.keys called on non-object");var z=[],B;for(B in t)l.call(t,B)&&z.push(B);if(v)for(B=0;B<m;B++)l.call(t,f[B])&&z.push(f[B]);return z}}())})();sigma.classes.Cascade=function(){this.p={};this.config=function(l,v){if("string"==typeof l&&void 0==v)return this.p[l];var f="object"==typeof l&&void 0==v?l:{};"string"==typeof l&&(f[l]=v);for(var m in f)void 0!=this.p[m]&&(this.p[m]=f[m]);return this}};
sigma.classes.EventDispatcher=function(){var l={},v=this;this.one=function(f,m){if(!m||!f)return v;("string"==typeof f?f.split(" "):f).forEach(function(f){l[f]||(l[f]=[]);l[f].push({h:m,one:!0})});return v};this.bind=function(f,m){if(!m||!f)return v;("string"==typeof f?f.split(" "):f).forEach(function(f){l[f]||(l[f]=[]);l[f].push({h:m,one:!1})});return v};this.unbind=function(f,m){f||(l={});var t="string"==typeof f?f.split(" "):f;m?t.forEach(function(f){l[f]&&(l[f]=l[f].filter(function(f){return f.h!=
m}));l[f]&&0==l[f].length&&delete l[f]}):t.forEach(function(f){delete l[f]});return v};this.dispatch=function(f,m){l[f]&&(l[f].forEach(function(l){l.h({type:f,content:m,target:v})}),l[f]=l[f].filter(function(f){return!f.one}));return v}};
(function(){function l(){function a(c){return{x:c.x,y:c.y,size:c.size,degree:c.degree,inDegree:c.inDegree,outDegree:c.outDegree,displayX:c.displayX,displayY:c.displayY,displaySize:c.displaySize,label:c.label,id:c.id,color:c.color,fixed:c.fixed,active:c.active,hidden:c.hidden,forceLabel:c.forceLabel,attr:c.attr}}function p(c){return{source:c.source.id,target:c.target.id,size:c.size,type:c.type,weight:c.weight,displaySize:c.displaySize,label:c.label,hidden:c.hidden,id:c.id,attr:c.attr,color:c.color}}
function g(){c.nodes=[];c.nodesIndex={};c.edges=[];c.edgesIndex={};return c}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var c=this;this.p={minNodeSize:0,maxNodeSize:0,minEdgeSize:0,maxEdgeSize:0,scalingMode:"inside",nodesPowRatio:0.5,edgesPowRatio:0,safe:!0};this.borders={};g();this.addNode=function(a,d){if(c.nodesIndex[a])throw Error('Node "'+a+'" already exists.');d=d||{};var b={x:0,y:0,size:1,degree:0,inDegree:0,outDegree:0,fixed:!1,active:!1,hidden:!1,forceLabel:!1,
label:a.toString(),id:a.toString(),attr:{}},s;for(s in d)switch(s){case "id":break;case "x":case "y":case "size":b[s]=+d[s];break;case "fixed":case "active":case "hidden":case "forceLabel":b[s]=!!d[s];break;case "color":case "label":b[s]=d[s];break;case "attributes":for(var g in d[s])void 0!=d[s][g].attr&&void 0!=d[s][g].val&&(b.attr[d[s][g].attr]=d[s][g].val);break;default:void 0!=d[s]&&(b.attr[s]=d[s])}c.nodes.push(b);c.nodesIndex[a.toString()]=b;return c};this.addEdge=function(a,d,b,g){if(c.edgesIndex[a])throw Error('Edge "'+
a+'" already exists.');if(!c.nodesIndex[d])throw Error("Edge's source \""+d+'" does not exist yet.');if(!c.nodesIndex[b])throw Error("Edge's target \""+b+'" does not exist yet.');g=g||{};d={source:c.nodesIndex[d],target:c.nodesIndex[b],size:1,weight:1,displaySize:0.5,label:a.toString(),id:a.toString(),hidden:!1,attr:{}};d.source.degree++;d.source.outDegree++;d.target.degree++;d.target.inDegree++;for(var n in g)switch(n){case "id":case "source":case "target":break;case "hidden":d[n]=!!g[n];break;case "size":case "weight":d[n]=
+g[n];break;case "color":d[n]=g[n].toString();break;case "type":d[n]=g[n].toString();break;case "label":d[n]=g[n];break;case "attributes":for(var p in g[n])void 0!=g[n][p].attr&&void 0!=g[n][p].val&&(d.attr[g[n][p].attr]=g[n][p].val);break;default:void 0!=g[n]&&(d.attr[n]=g[n])}c.edges.push(d);c.edgesIndex[a.toString()]=d;return c};this.dropNode=function(a){var d=(a instanceof Array?a:[a])||[];d.forEach(function(b){if(c.nodesIndex[b]){var d=null;c.nodes.some(function(c,a){return c.id==b?(d=a,!0):
!1});null!=d&&c.nodes.splice(d,1);delete c.nodesIndex[b]}else sigma.log('Node "'+b+'" does not exist.')});c.edges=c.edges.filter(function(b){return-1!=d.indexOf(b.source.id)?(delete c.edgesIndex[b.id],b.target.degree--,b.target.inDegree--,!1):-1!=d.indexOf(b.target.id)?(delete c.edgesIndex[b.id],b.source.degree--,b.source.outDegree--,!1):!0});return c};this.dropEdge=function(a){((a instanceof Array?a:[a])||[]).forEach(function(d){if(c.edgesIndex[d]){c.edgesIndex[d].source.degree--;c.edgesIndex[d].source.outDegree--;
c.edgesIndex[d].target.degree--;c.edgesIndex[d].target.inDegree--;var b=null;c.edges.some(function(c,a){return c.id==d?(b=a,!0):!1});null!=b&&c.edges.splice(b,1);delete c.edgesIndex[d]}else sigma.log('Edge "'+d+'" does not exist.')});return c};this.iterEdges=function(a,d){var b=d?d.map(function(b){return c.edgesIndex[b]}):c.edges;if(c.p.safe){var g=b.map(p);g.forEach(a);b.forEach(function(b,d){var a=g[d],k;for(k in a)switch(k){case "id":case "displaySize":break;case "weight":case "size":b[k]=+a[k];
break;case "source":case "target":b[k]=c.nodesIndex[k]||b[k];break;case "hidden":b[k]=!!a[k];break;case "color":case "label":case "type":b[k]=(a[k]||"").toString();break;default:b[k]=a[k]}})}else b.forEach(a);return c};this.iterNodes=function(k,d){var b=d?d.map(function(b){return c.nodesIndex[b]}):c.nodes;if(c.p.safe){var g=b.map(a);g.forEach(k);b.forEach(function(b,d){var c=g[d],a;for(a in c)switch(a){case "id":case "attr":case "degree":case "inDegree":case "outDegree":case "displayX":case "displayY":case "displaySize":break;
case "x":case "y":case "size":b[a]=+c[a];break;case "fixed":case "active":case "hidden":case "forceLabel":b[a]=!!c[a];break;case "color":case "label":b[a]=(c[a]||"").toString();break;default:b[a]=c[a]}})}else b.forEach(k);return c};this.getEdges=function(a){var d=(a instanceof Array?a:[a])||[];c.p.safe?d.map(function(b){return p(c.edgesIndex[b])}):d.map(function(b){return c.edgesIndex[b]});return a instanceof Array?d:d[0]};this.getNodes=function(k){var d=(k instanceof Array?k:[k])||[];c.p.safe?d.map(function(b){return a(c.nodesIndex[b])}):
d.map(function(b){return c.nodesIndex[b]});return k instanceof Array?d:d[0]};this.empty=g;this.rescale=function(a,d,b,g){var p=0,y=0;b&&c.nodes.forEach(function(b){y=Math.max(b.size,y)});g&&c.edges.forEach(function(b){p=Math.max(b.size,p)});var y=y||1,p=p||1,u,q;!c.p.maxNodeSize&&!c.p.minNodeSize?(u=1,q=0):c.p.maxNodeSize==c.p.minNodeSize?(u=0,q=c.p.maxNodeSize):(u=(c.p.maxNodeSize-c.p.minNodeSize)/y,q=c.p.minNodeSize);var r,f;!c.p.maxEdgeSize&&!c.p.minEdgeSize?(r=1,f=0):(r=c.p.maxEdgeSize==c.p.minEdgeSize?
0:(c.p.maxEdgeSize-c.p.minEdgeSize)/p,f=c.p.minEdgeSize);b&&c.nodes.forEach(function(b){b.displaySize=Math.sqrt((b.size*u+q)/Math.PI);b.fixed||(b.displayX=b.x,b.displayY=b.y)});g&&c.edges.forEach(function(b){b.displaySize=b.size*r+f});return c};this.translate=function(a,d,b,g,p){var f=Math.pow(b,c.p.nodesPowRatio);g&&c.nodes.forEach(function(c){c.fixed||(c.displayX=c.displayX*b+a,c.displayY=c.displayY*b+d);c.displaySize*=f});f=Math.pow(b,c.p.edgesPowRatio);p&&c.edges.forEach(function(b){b.displaySize*=
f});return c};this.translateNodes=function(a,d,b,g,p,f){a.forEach(function(a){a=c.nodesIndex[a];a.x=(a.displayX-g+d)/f;a.y=(a.displayY-p+b)/f});return c};this.setBorders=function(){c.borders={};c.nodes.forEach(function(a){c.borders.minX=Math.min(void 0==c.borders.minX?a.displayX-a.displaySize:c.borders.minX,a.displayX-a.displaySize);c.borders.maxX=Math.max(void 0==c.borders.maxX?a.displayX+a.displaySize:c.borders.maxX,a.displayX+a.displaySize);c.borders.minY=Math.min(void 0==c.borders.minY?a.displayY-
a.displaySize:c.borders.minY,a.displayY-a.displaySize);c.borders.maxY=Math.max(void 0==c.borders.maxY?a.displayY-a.displaySize:c.borders.maxY,a.displayY-a.displaySize)})};this.checkHover=function(a,d){var b,g,p,f=[],u=[];c.nodes.forEach(function(c){if(c.hidden)c.hover=!1;else{b=Math.abs(c.displayX-a);g=Math.abs(c.displayY-d);p=c.displaySize;var r=c.hover,l=b<p&&g<p&&Math.sqrt(b*b+g*g)<p;r&&!l?(c.hover=!1,u.push(c.id)):l&&!r&&(c.hover=!0,f.push(c.id))}});f.length&&c.dispatch("overnodes",f);u.length&&
c.dispatch("outnodes",u);return c};this.checkHoverEdge=function(a,d,b,g){var p,f,l,q,r,m,h,C,D,E,A,H,w,x=[],F=[],J=18*Math.abs(Math.log(1/(b*b)))||100;c.edges.forEach(function(b){if(b.hidden)b.hover=!1;else{r=b.source.displayX;m=b.source.displayY;D=b.source.displaySize;h=b.target.displayX;C=b.target.displayY;E=b.target.displaySize;A=b.displaySize;H=b.hover;w=!1;p=Math.abs(r-a);f=Math.abs(m-d);l=Math.abs(h-a);q=Math.abs(C-d);if(!(r==h&&m==C||p<D&&f<D||l<E&&q<E))switch(c.edgeType||g){case "curve":(w=
sigma.tools.isOnQuadraticCurve(a,d,r,m,h,C,(r+h)/2+(C-m)/4,(m+C)/2+(r-h)/4,A,J))&&x.push(b.id);break;default:(w=sigma.tools.isOnSegment(a,d,r,m,h,C,A,J))&&x.push(b.id)}b.hover=w;H&&!w&&F.push(b.id)}});x.length&&c.dispatch("overedges",x);F.length&&c.dispatch("outedges",F);return c}}function v(a,p){function g(){var a;a="<p>GLOBAL :</p>";for(var d in c.p.globalProbes)a+="<p>"+d+" : "+c.p.globalProbes[d]()+"</p>";a+="<br><p>LOCAL :</p>";for(d in c.p.localProbes)a+="<p>"+d+" : "+c.p.localProbes[d]()+"</p>";
c.p.dom.innerHTML=a;return c}sigma.classes.Cascade.call(this);var c=this;this.instance=a;this.monitoring=!1;this.p={fps:40,dom:p,globalProbes:{"Time (ms)":sigma.chronos.getExecutionTime,Queue:sigma.chronos.getQueuedTasksCount,Tasks:sigma.chronos.getTasksCount,FPS:sigma.chronos.getFPS},localProbes:{"Nodes count":function(){return c.instance.graph.nodes.length},"Edges count":function(){return c.instance.graph.edges.length}}};this.activate=function(){c.monitoring||(c.monitoring=window.setInterval(g,
1E3/c.p.fps));return c};this.desactivate=function(){c.monitoring&&(window.clearInterval(c.monitoring),c.monitoring=null,c.p.dom.innerHTML="");return c}}function f(a){function p(b){d.p.mouseEnabled&&(c(d.mouseX,d.mouseY,d.ratio*(0<(void 0!=b.wheelDelta&&b.wheelDelta||void 0!=b.detail&&-b.detail)?d.p.zoomMultiply:1/d.p.zoomMultiply)),d.p.blockScroll&&(b.preventDefault?b.preventDefault():b.returnValue=!1))}function g(){n=d.stageX;l=d.stageY;d.startX=d.mouseX;d.startY=d.mouseY;h=t=d.stageX;D=C=d.stageY;
d.dispatch("startdrag")}function c(b,a,c){if(!d.isMouseDown&&(window.clearInterval(d.interpolationID),A=void 0!=c,n=d.stageX,q=b,l=d.stageY,r=a,m=c||d.ratio,m=Math.min(Math.max(m,d.p.minRatio),d.p.maxRatio),E=d.p.directZooming?1-(A?d.p.zoomDelta:d.p.dragDelta):0,d.ratio!=m||d.stageX!=q||d.stageY!=r))k(),d.interpolationID=window.setInterval(k,50),d.dispatch("startinterpolate")}function k(){E+=A?d.p.zoomDelta:d.p.dragDelta;E=Math.min(E,1);var b=sigma.easing.quadratic.easeout(E),a=d.ratio;d.ratio=a*
(1-b)+m*b;A?(d.stageX=q+(d.stageX-q)*d.ratio/a,d.stageY=r+(d.stageY-r)*d.ratio/a):(d.stageX=n*(1-b)+q*b,d.stageY=l*(1-b)+r*b);d.dispatch("interpolate");1<=E&&(window.clearInterval(d.interpolationID),b=d.ratio,A?(d.ratio=m,d.stageX=q+(d.stageX-q)*d.ratio/b,d.stageY=r+(d.stageY-r)*d.ratio/b):(d.stageX=q,d.stageY=r),d.dispatch("stopinterpolate"))}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var d=this;this.p={minRatio:1,maxRatio:32,marginRatio:1,zoomDelta:0.1,dragDelta:0.3,
zoomMultiply:2,directZooming:!1,blockScroll:!0,inertia:1.1,mouseEnabled:!0};var b=0,f=0;d.startX=0;var n=d.startY=0,l=0,m=1,q=0,r=0,t=0,h=0,C=0,D=0,E=0,A=!1,H=Date.now();this.stageY=this.stageX=0;this.ratio=1;this.mouseY=this.mouseX=0;this.isMouseDown=!1;a.addEventListener("DOMMouseScroll",p,!0);a.addEventListener("mousewheel",p,!0);a.addEventListener("mousemove",function(a){b=d.mouseX;f=d.mouseY;d.mouseX=void 0!=a.offsetX&&a.offsetX||void 0!=a.layerX&&a.layerX||void 0!=a.clientX&&a.clientX;d.mouseY=
void 0!=a.offsetY&&a.offsetY||void 0!=a.layerY&&a.layerY||void 0!=a.clientY&&a.clientY;d.dispatch("move",{dX:d.mouseX-b,dY:d.mouseY-f,stageX:d.stageX,stageY:d.stageY,ratio:d.ratio});a.preventDefault?a.preventDefault():a.returnValue=!1},!0);a.addEventListener("mousedown",function(a){if(d.p.mouseEnabled){var c=Date.now();400>c-H?d.dispatch("dblclick"):H=c;if(a.ctrlKey||a.metaKey)d.dispatch("ctrlclick");else switch(a.which){case 1:d.isMouseDown=!0;b=d.mouseX;f=d.mouseY;d.dispatch("mousedown");g();break;
case 2:d.dispatch("rightclick");break;case 3:d.dispatch("rightclick");break;default:d.isMouseDown=!0,b=d.mouseX,f=d.mouseY,d.dispatch("mousedown"),g()}a.preventDefault?a.preventDefault():a.returnValue=!1}},!0);document.addEventListener("mouseup",function(b){d.p.mouseEnabled&&d.isMouseDown&&(d.isMouseDown=!1,d.dispatch("mouseup"),(n!=d.stageX||l!=d.stageY)&&c(d.stageX+d.p.inertia*(d.stageX-h),d.stageY+d.p.inertia*(d.stageY-D)),b.preventDefault?b.preventDefault():b.returnValue=!1)},!0);this.checkBorders=
function(b,a,c){return d};this.interpolate=c;this.drag=function(){var b=d.mouseX-d.startX+n,a=d.mouseY-d.startY+l;if(b!=d.stageX||a!=d.stageY)h=t,D=C,t=b,C=a,d.stageX=b,d.stageY=a,d.dispatch("drag")}}function m(a,p,g,c,k,d,b,f,l){function m(a){var c=a.source.displayX,d=a.source.displayY,g=a.target.displayX,k=a.target.displayY,q=a.color;if(!q)switch(h.p.edgeColor){case "source":q=a.source.color||h.p.defaultNodeColor;break;case "target":q=a.target.color||h.p.defaultNodeColor;break;default:q=h.p.defaultEdgeColor}var f=
p;f.arrow=function(b,a,c,d,g){var A=d/2,k=g/2;this.fillStyle=q||h.p.defaultEdgeColor;this.translate(b,a);this.rotate(c);this.translate(-A,-k);this.beginPath();this.moveTo(0,0);this.lineTo(0,1*g);this.lineTo(1*d,1*k);this.closePath();this.fill();this.translate(A,k);this.rotate(-c);this.translate(-b,-a)};var G=a.displaySize/3;switch(b.edgeType||h.p.defaultEdgeType){case "curve":f.strokeStyle=q;f.lineWidth=G;f.beginPath();var s=(c+g)/2+(k-d)/4,l=(d+k)/2+(c-g)/4;if(b.oriented)var n=Math.round(10*a.target.displaySize)/
10+2+1.5*G,y=Math.sqrt(Math.pow(g-s,2)+Math.pow(k-l,2)),u=Math.round((g-s)*n/y),n=Math.round((k-l)*n/y),g=g-u,k=k-n;f.moveTo(c,d);f.quadraticCurveTo(s,l,g,k);f.stroke();b.oriented&&f.arrow(g,k,Math.atan2(k-l,g-s),3*G,3*G);break;default:f.strokeStyle=q,f.lineWidth=G,f.beginPath(),b.oriented&&(n=Math.round(10*a.target.displaySize)/10+2+1.5*G,y=Math.sqrt(Math.pow(g-c,2)+Math.pow(k-d,2)),u=Math.round((g-c)*n/y),n=Math.round((k-d)*n/y),g-=u,k-=n),f.moveTo(c,d),f.lineTo(g,k),f.stroke(),b.oriented&&f.arrow(g,
k,Math.atan2(k-d,g-c),3*G,3*G)}a.hover&&r(a);return h}function u(a){if(a.source==a.target||void 0==a.label||!a.label.length)return h;var c="fixed"==h.p.edgeLabelSize?h.p.defaultEdgeLabelSize:h.p.edgeLabelSizeRatio*a.displaySize;if(c>=2.3*h.p.edgeLabelThreshold||a.forceLabel){var g=d,k=a.source.displayX,f=a.source.displayY,p=a.target.displayX,q=a.target.displayY,r;g.font=(h.p.hoverFontStyle||h.p.fontStyle||"")+" "+c+"px "+(h.p.hoverFont||h.p.font||"");r=g.measureText(a.label).width;switch(b.edgeType||
h.p.defaultEdgeType){case "curve":f=sigma.tools.pointOnQuadraticCurve(0.5,k,f,p,q,(k+p)/2+(q-f)/4,(f+q)/2+(k-p)/4);k=f.x;f=f.y;break;default:k=(k+p)/2,f=(f+q)/2}"none"!=h.p.edgeHoverLabelBGColor&&(g.fillStyle="edge"==h.p.edgeHoverLabelBGColor?a.color||h.p.defaultEdgeHoverColor:h.p.defaultEdgeHoverLabelBGColor,g.fillRect(Math.round(k-r/2),Math.round(f-c/2),r,c));g.fillStyle="edge"==h.p.edgeHoverLabelColor?a.color||h.p.defaultEdgeHoverColor:h.p.defaultEdgeHoverLabelColor;g.fillText(a.label,Math.round(k-
r/2),Math.round(f+c/2))}return h}function q(b){var a=k,c="fixed"==h.p.labelSize?h.p.defaultLabelSize:h.p.labelSizeRatio*b.displaySize;a.font=(h.p.hoverFontStyle||h.p.fontStyle||"")+" "+c+"px "+(h.p.hoverFont||h.p.font||"");a.fillStyle="node"==h.p.labelHoverBGColor?b.color||h.p.defaultNodeColor:h.p.defaultHoverLabelBGColor;a.beginPath();h.p.labelHoverShadow&&(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=4,a.shadowColor=h.p.labelHoverShadowColor);sigma.tools.drawRoundRect(a,Math.round(b.displayX-
c/2-2),Math.round(b.displayY-c/2-2),Math.round(a.measureText(b.label).width+1.5*b.displaySize+c/2+4),Math.round(c+4),Math.round(c/2+2),"left");a.closePath();a.fill();a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=0;a.beginPath();a.fillStyle="node"==h.p.nodeBorderColor?b.color||h.p.defaultNodeColor:h.p.defaultNodeBorderColor;a.arc(Math.round(b.displayX),Math.round(b.displayY),b.displaySize+h.p.borderSize,0,2*Math.PI,!0);a.closePath();a.fill();a.beginPath();a.fillStyle="node"==h.p.nodeHoverColor?
b.color||h.p.defaultNodeColor:h.p.defaultNodeHoverColor;a.arc(Math.round(b.displayX),Math.round(b.displayY),b.displaySize,0,2*Math.PI,!0);a.closePath();a.fill();a.fillStyle="node"==h.p.labelHoverColor?b.color||h.p.defaultNodeColor:h.p.defaultLabelHoverColor;a.fillText(b.label,Math.round(b.displayX+1.5*b.displaySize),Math.round(b.displayY+c/2-3));return h}function r(a){var c=d,g=a.source.displayX,k=a.source.displayY,f=a.target.displayX,p=a.target.displayY,q;if(!(e.hidden||!h.isOnScreen(a.source)&&
!h.isOnScreen(a.target))){switch(h.p.edgeHoverColor){case "source":q=a.source.color||h.p.defaultNodeColor;break;case "target":q=a.target.color||h.p.defaultNodeColor;break;case "edge":q=a.color||h.p.defaultEdgeHoverColor;break;default:q=h.p.defaultEdgeHoverColor}c.arrow=function(b,a,c,d,g){var h=d/2,k=g/2;this.fillStyle=q;this.translate(b,a);this.rotate(c);this.translate(-h,-k);this.beginPath();this.moveTo(0,0);this.lineTo(0,1*g);this.lineTo(1*d,1*k);this.closePath();this.fill();this.translate(h,k);
this.rotate(-c);this.translate(-b,-a)};var r=a.displaySize*h.p.edgeHoverSizeRatio/3;switch(b.edgeType||h.p.defaultEdgeType){case "curve":c.strokeStyle=q;c.lineWidth=r;c.beginPath();var s=(g+f)/2+(p-k)/4,l=(k+p)/2+(g-f)/4;if(b.oriented)var n=Math.round(10*a.target.displaySize)/10+2+1.5*r,m=Math.sqrt(Math.pow(f-s,2)+Math.pow(p-l,2)),y=Math.round((f-s)*n/m),n=Math.round((p-l)*n/m),f=f-y,p=p-n;c.moveTo(g,k);c.quadraticCurveTo(s,l,f,p);c.stroke();b.oriented&&c.arrow(f,p,Math.atan2(p-l,f-s),3*r,3*r);break;
default:c.strokeStyle=q,c.lineWidth=r,c.beginPath(),b.oriented&&(n=Math.round(10*a.target.displaySize)/10+2+1.5*r,m=Math.sqrt(Math.pow(f-g,2)+Math.pow(p-k,2)),y=Math.round((f-g)*n/m),n=Math.round((p-k)*n/m),f-=y,p-=n),c.moveTo(g,k),c.lineTo(f,p),c.stroke(),b.oriented&&c.arrow(f,p,Math.atan2(p-k,f-g),3*r,3*r)}u(a);h.p.hoverSourceOnEdgeHover&&(a.source.hover=!0);h.p.hoverTargetOnEdgeHover&&(a.target.hover=!0);return h}}function t(b){if(isNaN(b.x)||isNaN(b.y))throw Error("A node's coordinate is not a number (id: "+
b.id+")");return!b.hidden&&b.displayX+b.displaySize>-C/3&&b.displayX-b.displaySize<4*C/3&&b.displayY+b.displaySize>-D/3&&b.displayY-b.displaySize<4*D/3}sigma.classes.Cascade.call(this);var h=this;this.p={labelColor:"default",defaultLabelColor:"#000",labelHoverBGColor:"default",defaultHoverLabelBGColor:"#fff",labelHoverShadow:!0,labelHoverShadowColor:"#000",labelHoverColor:"default",defaultLabelHoverColor:"#000",labelActiveBGColor:"default",defaultActiveLabelBGColor:"#fff",labelActiveShadow:!0,labelActiveShadowColor:"#000",
labelActiveColor:"default",defaultLabelActiveColor:"#000",labelSize:"fixed",defaultLabelSize:12,labelSizeRatio:2,labelThreshold:6,font:"Arial",hoverFont:"",activeFont:"",fontStyle:"",hoverFontStyle:"",activeFontStyle:"",edgeLabelSize:"fixed",defaultEdgeLabelSize:12,edgeLabelSizeRatio:1,edgeLabelThreshold:6,defaultEdgeLabelColor:"#000",defaultEdgeLabelBGColor:"rgba(255,255,255,0.7)",defaultEdgeHoverLabelColor:"#000",defaultEdgeHoverLabelBGColor:"rgba(255,255,255,0.7)",edgeLabelColor:"default",edgeLabelBGColor:"default",
edgeHoverLabelColor:"default",edgeHoverLabelBGColor:"edge",edgeColor:"source",defaultEdgeColor:"#aaa",defaultEdgeType:"line",edgeHoverSizeRatio:1,edgeHoverColor:"default",defaultEdgeHoverColor:"#aaa",hoverSourceOnEdgeHover:!1,hoverTargetOnEdgeHover:!1,defaultNodeColor:"#aaa",nodeHoverColor:"node",defaultNodeHoverColor:"#fff",nodeActiveColor:"node",defaultNodeActiveColor:"#fff",borderSize:0,nodeBorderColor:"node",defaultNodeBorderColor:"#fff",edgesSpeed:200,nodesSpeed:200,labelsSpeed:200,edgeLabelsSpeed:200};
var C=f,D=l;this.currentEdgeLabelIndex=this.currentLabelIndex=this.currentNodeIndex=this.currentEdgeIndex=0;this.task_drawLabel=function(){for(var a=b.nodes.length,c=0;c++<h.p.labelsSpeed&&h.currentLabelIndex<a;)if(h.isOnScreen(b.nodes[h.currentLabelIndex])){var d=b.nodes[h.currentLabelIndex++],k=g;if(d.displaySize>=h.p.labelThreshold||d.forceLabel){var f="fixed"==h.p.labelSize?h.p.defaultLabelSize:h.p.labelSizeRatio*d.displaySize;k.font=h.p.fontStyle+f+"px "+h.p.font;k.fillStyle="node"==h.p.labelColor?
d.color||h.p.defaultNodeColor:h.p.defaultLabelColor;k.fillText(d.label,Math.round(d.displayX+1.5*d.displaySize),Math.round(d.displayY+f/2-3))}}else h.currentLabelIndex++;return h.currentLabelIndex<a};this.task_drawEdgeLabel=function(){for(var a=b.edges.length,d,g,k=0;k++<h.p.edgeLabelsSpeed&&h.currentEdgeLabelIndex<a;)if(e=b.edges[h.currentEdgeLabelIndex],d=e.source,g=e.target,e.hidden||!h.isOnScreen(d)&&!h.isOnScreen(g))h.currentEdgeLabelIndex++;else if(d=b.edges[h.currentEdgeLabelIndex++],!(d.source==
d.target||void 0==d.label||!d.label.length))if(g="fixed"==h.p.edgeLabelSize?h.p.defaultEdgeLabelSize:h.p.edgeLabelSizeRatio*d.displaySize,g>=2.3*h.p.edgeLabelThreshold||d.forceLabel){var f=c,p=d.source.displayX,q=d.source.displayY,r=d.target.displayX,s=d.target.displayY,n=void 0,l=void 0,m=void 0;f.font=(h.p.hoverFontStyle||h.p.fontStyle||"")+" "+g+"px "+(h.p.hoverFont||h.p.font||"");m=f.measureText(d.label).width;switch(b.edgeType||h.p.defaultEdgeType){case "curve":p=sigma.tools.pointOnQuadraticCurve(0.5,
p,q,r,s,(p+r)/2+(s-q)/4,(q+s)/2+(p-r)/4);n=p.x;l=p.y;break;default:n=(p+r)/2,l=(q+s)/2}f.strokeStyle="edge"==h.p.edgeLabelBGColor?d.color||h.p.defaultEdgeHoverColor:h.p.defaultEdgeLabelBGColor;f.strokeText(d.label,Math.round(n-m/2),Math.round(l+g/2));f.fillStyle="edge"==h.p.edgeLabelColor?d.color||h.p.defaultEdgeColor:h.p.defaultEdgeLabelColor;f.fillText(d.label,Math.round(n-m/2),Math.round(l+g/2))}return h.currentEdgeLabelIndex<a};this.task_drawEdge=function(){for(var a=b.edges.length,c,d,g=0;g++<
h.p.edgesSpeed&&h.currentEdgeIndex<a;)e=b.edges[h.currentEdgeIndex],c=e.source,d=e.target,e.hidden||c.hidden||d.hidden||!h.isOnScreen(c)&&!h.isOnScreen(d)?h.currentEdgeIndex++:m(b.edges[h.currentEdgeIndex++]);return h.currentEdgeIndex<a};this.task_drawNode=function(){for(var c=b.nodes.length,d=0;d++<h.p.nodesSpeed&&h.currentNodeIndex<c;)if(h.isOnScreen(b.nodes[h.currentNodeIndex])){var g=b.nodes[h.currentNodeIndex++],k=Math.round(10*g.displaySize)/10,f=a;f.fillStyle=g.color?g.color:h.p.defaultNodeColor;
f.beginPath();f.arc(g.displayX,g.displayY,k,0,2*Math.PI,!0);f.closePath();f.fill();g.hover&&q(g)}else h.currentNodeIndex++;return h.currentNodeIndex<c};this.drawActiveNode=function(b){var a=k;if(!t(b))return h;var c="fixed"==h.p.labelSize?h.p.defaultLabelSize:h.p.labelSizeRatio*b.displaySize;a.font=(h.p.activeFontStyle||h.p.fontStyle||"")+" "+c+"px "+(h.p.activeFont||h.p.font||"");a.fillStyle="node"==h.p.labelHoverBGColor?b.color||h.p.defaultNodeColor:h.p.defaultActiveLabelBGColor;a.beginPath();h.p.labelActiveShadow&&
(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=4,a.shadowColor=h.p.labelActiveShadowColor);sigma.tools.drawRoundRect(a,Math.round(b.displayX-c/2-2),Math.round(b.displayY-c/2-2),Math.round(a.measureText(b.label).width+1.5*b.displaySize+c/2+4),Math.round(c+4),Math.round(c/2+2),"left");a.closePath();a.fill();a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=0;a.beginPath();a.fillStyle="node"==h.p.nodeBorderColor?b.color||h.p.defaultNodeColor:h.p.defaultNodeBorderColor;a.arc(Math.round(b.displayX),
Math.round(b.displayY),b.displaySize+h.p.borderSize,0,2*Math.PI,!0);a.closePath();a.fill();a.beginPath();a.fillStyle="node"==h.p.nodeActiveColor?b.color||h.p.defaultNodeColor:h.p.defaultNodeActiveColor;a.arc(Math.round(b.displayX),Math.round(b.displayY),b.displaySize,0,2*Math.PI,!0);a.closePath();a.fill();a.fillStyle="node"==h.p.labelActiveColor?b.color||h.p.defaultNodeColor:h.p.defaultLabelActiveColor;a.fillText(b.label,Math.round(b.displayX+1.5*b.displaySize),Math.round(b.displayY+c/2-3));return h};
this.drawHoverNode=q;this.drawHoverEdge=r;this.isOnScreen=t;this.resize=function(b,a){C=b;D=a;return h}}function t(a,p){function g(){sigma.chronos.removeTask("node_"+b.id,2).removeTask("edge_"+b.id,2).removeTask("label_"+b.id,2).stopTasks();return b}function c(a,c){b.domElements[a]=document.createElement(c);b.domElements[a].style.position="absolute";b.domElements[a].setAttribute("id","sigma_"+a+"_"+b.id);b.domElements[a].setAttribute("class","sigma_"+a+"_"+c);b.domElements[a].setAttribute("width",
b.width+"px");b.domElements[a].setAttribute("height",b.height+"px");b.domRoot.appendChild(b.domElements[a]);return b}function k(){b.p.drawHoverNodes&&b.graph.checkHover(b.mousecaptor.mouseX,b.mousecaptor.mouseY);b.p.drawHoverEdges&&(b.graph.checkHoverEdge(b.mousecaptor.mouseX,b.mousecaptor.mouseY,b.mousecaptor.ratio,b.plotter.p.defaultEdgeType),b.graph.edges.forEach(function(a){a.hover&&!a.active&&b.plotter.drawHoverEdge(a)}));b.p.drawHoverNodes&&b.graph.nodes.forEach(function(a){a.hover&&!a.active&&
b.plotter.drawHoverNode(a)});return b}function d(){b.p.drawActiveNodes&&b.graph.nodes.forEach(function(a){a.active&&b.plotter.drawActiveNode(a)});return b}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var b=this,s,n,y;this.id=p.toString();this.p={auto:!0,drawNodes:2,drawEdges:1,drawLabels:2,drawEdgeLabels:2,lastNodes:2,lastEdges:0,lastLabels:2,lastEdgeLabels:2,drawHoverNodes:!0,drawActiveNodes:!0,drawHoverEdges:!1};this.domRoot=a;this.width=this.domRoot.offsetWidth;this.height=
this.domRoot.offsetHeight;this.graph=new l;this.domElements={};c("edges","canvas");c("edgehover","canvas");c("edgelabels","canvas");c("nodes","canvas");c("labels","canvas");c("hover","canvas");c("monitor","div");c("mouse","canvas");this.plotter=new m(this.domElements.nodes.getContext("2d"),this.domElements.edges.getContext("2d"),this.domElements.labels.getContext("2d"),this.domElements.edgelabels.getContext("2d"),this.domElements.hover.getContext("2d"),this.domElements.edgehover.getContext("2d"),
this.graph,this.width,this.height);this.monitor=new v(this,this.domElements.monitor);this.mousecaptor=new f(this.domElements.mouse,this.id);this.mousecaptor.bind("drag interpolate",function(a){b.draw(b.p.auto?2:b.p.drawNodes,b.p.auto?0:b.p.drawEdges,b.p.auto?2:b.p.drawLabels,b.p.auto?0:b.p.drawEdgeLabels,!0)}).bind("stopdrag stopinterpolate",function(a){b.draw(b.p.auto?2:b.p.drawNodes,b.p.auto?1:b.p.drawEdges,b.p.auto?2:b.p.drawLabels,b.p.auto?1:b.p.drawEdgeLabels,!0)}).bind("mousedown mouseup ctrlclick",
function(a){s="mousedown"==a.type?"downgraph":"upgraph";b.dispatch(s);n=b.graph.nodes.filter(function(b){return!!b.hover}).map(function(b){return b.id});n.length?("ctrlclick"==a.type?s="ctrlclicknodes":"mousedown"==a.type?s="downnodes":(s="upnodes",b.draw(b.p.auto?-1:b.p.drawNodes,b.p.auto?1:b.p.drawEdges,b.p.auto?-1:b.p.drawLabels,b.p.auto?1:b.p.drawEdgeLabels)),b.dispatch(s,n)):(n=b.graph.edges.filter(function(b){return!!b.hover}).map(function(b){return b.id}),n.length&&(s="upedges","ctrlclick"==
a.type?s="ctrlclickedges":"mousedown"==a.type&&(s="downedges"),b.dispatch(s,n)))}).bind("rightclick dblclick",function(a){n=b.graph.nodes.filter(function(b){return!!b.hover}).map(function(b){return b.id});n.length?(s="dblclick"==a.type?"dblclicknodes":"rightclicknodes",b.dispatch(s,n)):(n=b.graph.edges.filter(function(b){return!!b.hover}).map(function(b){return b.id}),n.length&&(s="dblclick"==a.type?"dblclickedges":"rightclickedges",b.dispatch(s,n)))}).bind("move",function(a){"downgraph"==s||"downedges"==
s?(b.mousecaptor.drag(),b.refresh()):"downnodes"==s?(b.graph.translateNodes(n,a.content.dX,a.content.dY,a.content.stageX,a.content.stageY,a.content.ratio),b.domElements.hover.getContext("2d").clearRect(0,0,b.domElements.hover.width,b.domElements.hover.height),b.draw(b.p.auto?2:b.p.drawNodes,b.p.auto?2:b.p.drawEdges,b.p.auto?2:b.p.drawLabels,b.p.auto?0:b.p.drawEdgeLabels)):b.refresh()});sigma.chronos.bind("startgenerators",function(){sigma.chronos.getGeneratorsIDs().some(function(a){return!!a.match(RegExp("_ext_"+
b.id+"$",""))})&&(void 0===y&&(y=b.p.drawHoverEdges,b.p.drawHoverEdges=!1),b.draw(b.p.auto?2:b.p.drawNodes,b.p.auto?0:b.p.drawEdges,b.p.auto?2:b.p.drawLabels,b.p.auto?0:b.p.drawEdgeLabels))}).bind("stopgenerators",function(){b.p.drawHoverEdges=y;y=void 0;b.draw()});for(var u=0;u<I.plugins.length;u++)I.plugins[u](this);this.draw=function(a,c,d,h,k){if(k&&sigma.chronos.getGeneratorsIDs().some(function(a){return!!a.match(RegExp("_ext_"+b.id+"$",""))}))return b;a=void 0==a?b.p.drawNodes:a;c=void 0==c?
b.p.drawEdges:c;k=void 0==d?b.p.drawLabels:d;d=void 0==d?b.p.drawEdgeLabels:h;h={nodes:a,edges:c,labels:k,edgeLabels:d};b.p.lastNodes=a;b.p.lastEdges=c;b.p.lastLabels=k;b.p.lastEdgeLabels=d;g();b.graph.rescale(b.width,b.height,0<a,0<c).setBorders();b.mousecaptor.checkBorders(b.graph.borders,b.width,b.height);b.graph.translate(b.mousecaptor.stageX,b.mousecaptor.stageY,b.mousecaptor.ratio,0<a,0<c);b.dispatch("graphscaled");for(var f in b.domElements)"canvas"==b.domElements[f].nodeName.toLowerCase()&&
(void 0==h[f]||0<=h[f])&&b.domElements[f].getContext("2d").clearRect(0,0,b.domElements[f].width,b.domElements[f].height);b.plotter.currentEdgeIndex=0;b.plotter.currentNodeIndex=0;b.plotter.currentLabelIndex=0;b.plotter.currentEdgeLabelIndex=0;f=null;h=!1;if(d)if(1<d)for(;b.plotter.task_drawEdgeLabel(););else f?sigma.chronos.queueTask(b.plotter.task_drawEdgeLabel,"label_"+b.id,f):sigma.chronos.addTask(b.plotter.task_drawEdgeLabel,"label_"+b.id,!1),h=!0,f="label_"+b.id;if(a)if(1<a)for(;b.plotter.task_drawNode(););
else sigma.chronos.addTask(b.plotter.task_drawNode,"node_"+b.id,!1),h=!0,f="node_"+b.id;if(k)if(1<k)for(;b.plotter.task_drawLabel(););else f?sigma.chronos.queueTask(b.plotter.task_drawLabel,"label_"+b.id,f):sigma.chronos.addTask(b.plotter.task_drawLabel,"label_"+b.id,!1),h=!0,f="label_"+b.id;if(c)if(1<c)for(;b.plotter.task_drawEdge(););else f?sigma.chronos.queueTask(b.plotter.task_drawEdge,"edge_"+b.id,f):sigma.chronos.addTask(b.plotter.task_drawEdge,"edge_"+b.id,!1),h=!0,f="edge_"+b.id;b.dispatch("draw");
b.refresh();h&&sigma.chronos.runTasks();return b};this.resize=function(a,c){var d=b.width,g=b.height;void 0!=a&&void 0!=c?(b.width=a,b.height=c):(b.width=b.domRoot.offsetWidth,b.height=b.domRoot.offsetHeight);if(d!=b.width||g!=b.height){for(var f in b.domElements)b.domElements[f].setAttribute("width",b.width+"px"),b.domElements[f].setAttribute("height",b.height+"px");b.plotter.resize(b.width,b.height);b.draw(b.p.lastNodes,b.p.lastEdges,b.p.lastLabels,b.p.lastEdgeLabels,!0)}return b};this.refresh=
function(){b.domElements.hover.getContext("2d").clearRect(0,0,b.domElements.hover.width,b.domElements.hover.height);b.domElements.edgehover.getContext("2d").clearRect(0,0,b.domElements.edgehover.width,b.domElements.edgehover.height);k();d();return b};this.drawHover=k;this.drawActive=d;this.clearSchedule=g;window.addEventListener("resize",function(){b.resize()})}function z(a){var f=this;sigma.classes.EventDispatcher.call(this);this._core=a;this.kill=function(){};this.getID=function(){return a.id};
this.configProperties=function(g,c){var k=a.config(g,c);return k==a?f:k};this.drawingProperties=function(g,c){var k=a.plotter.config(g,c);return k==a.plotter?f:k};this.mouseProperties=function(g,c){var k=a.mousecaptor.config(g,c);return k==a.mousecaptor?f:k};this.graphProperties=function(g,c){var k=a.graph.config(g,c);return k==a.graph?f:k};this.getMouse=function(){return{mouseX:a.mousecaptor.mouseX,mouseY:a.mousecaptor.mouseY,down:a.mousecaptor.isMouseDown}};this.position=function(g,c,k){if(0==arguments.length)return{stageX:a.mousecaptor.stageX,
stageY:a.mousecaptor.stageY,ratio:a.mousecaptor.ratio};a.mousecaptor.stageX=void 0!=g?g:a.mousecaptor.stageX;a.mousecaptor.stageY=void 0!=c?c:a.mousecaptor.stageY;a.mousecaptor.ratio=void 0!=k?k:a.mousecaptor.ratio;return f};this.goTo=function(g,c,k){a.mousecaptor.interpolate(g,c,k);return f};this.zoomTo=function(g,c,k){k=Math.min(Math.max(a.mousecaptor.config("minRatio"),k),a.mousecaptor.config("maxRatio"));k==a.mousecaptor.ratio?a.mousecaptor.interpolate(g-a.width/2+a.mousecaptor.stageX,c-a.height/
2+a.mousecaptor.stageY):a.mousecaptor.interpolate((k*g-a.mousecaptor.ratio*a.width/2)/(k-a.mousecaptor.ratio),(k*c-a.mousecaptor.ratio*a.height/2)/(k-a.mousecaptor.ratio),k);return f};this.resize=function(g,c){a.resize(g,c);return f};this.draw=function(g,c,k,d,b){a.draw(g,c,k,d,b);return f};this.refresh=function(){a.refresh();return f};this.addGenerator=function(g,c,k){sigma.chronos.addGenerator(g+"_ext_"+a.id,c,k);return f};this.removeGenerator=function(g){sigma.chronos.removeGenerator(g+"_ext_"+
a.id);return f};this.addNode=function(g,c){a.graph.addNode(g,c);return f};this.addEdge=function(g,c,k,d){a.graph.addEdge(g,c,k,d);return f};this.dropNode=function(g){a.graph.dropNode(g);return f};this.dropEdge=function(g){a.graph.dropEdge(g);return f};this.pushGraph=function(g,c){g.nodes&&g.nodes.forEach(function(g){g.id&&(!c||!a.graph.nodesIndex[g.id])&&f.addNode(g.id,g)});g.edges&&g.edges.forEach(function(g){(validID=g.source&&g.target&&g.id)&&(!c||!a.graph.edgesIndex[g.id])&&f.addEdge(g.id,g.source,
g.target,g)});return f};this.emptyGraph=function(){a.graph.empty();return f};this.getNodesCount=function(){return a.graph.nodes.length};this.getEdgesCount=function(){return a.graph.edges.length};this.iterNodes=function(g,c){a.graph.iterNodes(g,c);return f};this.iterEdges=function(g,c){a.graph.iterEdges(g,c);return f};this.getNodes=function(g){return a.graph.getNodes(g)};this.getEdges=function(g){return a.graph.getEdges(g)};this.activateMonitoring=function(){return a.monitor.activate()};this.desactivateMonitoring=
function(){return a.monitor.desactivate()};a.bind("downnodes upnodes downedges upedges downgraph upgraph ctrlclicknodes rightclicknodes dblclicknodes ctrlclickedges rightclickedges dblclickedges",function(a){f.dispatch(a.type,a.content)});a.graph.bind("overnodes outnodes overedges outedges",function(a){f.dispatch(a.type,a.content)})}var B=0,I={plugins:[]};sigma.init=function(a){a=new t(a,(++B).toString());sigma.instances[B]=new z(a);return sigma.instances[B]};sigma.addPlugin=function(a,f,g){z.prototype[a]=
f;I.plugins.push(g)};sigma.chronos=new function(){function a(a){window.setTimeout(a,0);return l}function f(){for(l.dispatch("frameinserted");m&&x.length&&g(););!m||!x.length?k():(A=(new Date).getTime(),t++,B=D-h,v=h-B,l.dispatch("insertframe"),a(f))}function g(){z%=x.length;if(!x[z].task()){var a=x[z].taskName;F=F.filter(function(b){b.taskParent==a&&x.push({taskName:b.taskName,task:b.task});return b.taskParent!=a});l.dispatch("killed",x.splice(z--,1)[0])}z++;D=(new Date).getTime()-A;return D<=v}function c(){m=
!0;t=z=0;E=A=(new Date).getTime();l.dispatch("start");l.dispatch("insertframe");a(f);return l}function k(){l.dispatch("stop");m=!1;return l}function d(a,b,d){if("function"!=typeof a)throw Error('Task "'+b+'" is not a function');x.push({taskName:b,task:a});m=!(!m&&!(d&&c()||1));return l}function b(a){return a?Object.keys(w).filter(function(a){return!!w[a].on}).length:Object.keys(w).length}function s(){Object.keys(w).length?(l.dispatch("startgenerators"),l.unbind("killed",n),a(function(){for(var a in w)w[a].on=
!0,d(w[a].task,a,!1)}),l.bind("killed",n).runTasks()):l.dispatch("stopgenerators");return l}function n(a){void 0!=w[a.content.taskName]&&(w[a.content.taskName].del||!w[a.content.taskName].condition()?delete w[a.content.taskName]:w[a.content.taskName].on=!1,0==b(!0)&&s())}sigma.classes.EventDispatcher.call(this);var l=this,m=!1,q=80,r=0,t=0,h=1E3/q,v=h,D=0,E=0,A=0,B=0,w={},x=[],F=[],z=0;this.frequency=function(a){return void 0!=a?(q=Math.abs(1*a),h=1E3/q,t=0,l):q};this.runTasks=c;this.stopTasks=k;
this.insertFrame=a;this.addTask=d;this.queueTask=function(a,b,c){if("function"!=typeof a)throw Error('Task "'+b+'" is not a function');if(!x.concat(F).some(function(a){return a.taskName==c}))throw Error('Parent task "'+c+'" of "'+b+'" is not attached.');F.push({taskParent:c,taskName:b,task:a});return l};this.removeTask=function(a,b){if(void 0==a)x=[],1==b?F=[]:2==b&&(x=F,F=[]),k();else{var c="string"==typeof a?a:"";x=x.filter(function(b){return("string"==typeof a?b.taskName==a:b.task==a)?(c=b.taskName,
!1):!0});0<b&&(F=F.filter(function(a){1==b&&a.taskParent==c&&x.push(a);return a.taskParent!=c}))}m=!(x.length&&(!k()||1));return l};this.addGenerator=function(a,c,d){if(void 0!=w[a])return l;w[a]={task:c,condition:d};0==b(!0)&&s();return l};this.removeGenerator=function(a){w[a]&&(w[a].on=!1,w[a].del=!0);return l};this.startGenerators=s;this.getGeneratorsIDs=function(){return Object.keys(w)};this.getFPS=function(){m&&(r=Math.round(1E4*(t/((new Date).getTime()-E)))/10);return r};this.getTasksCount=
function(){return x.length};this.getQueuedTasksCount=function(){return F.length};this.getExecutionTime=function(){return A-E};return this};sigma.debugMode=0;sigma.log=function(){if(1==sigma.debugMode)for(var a in arguments)console.log(arguments[a]);else if(1<sigma.debugMode)for(a in arguments)throw Error(arguments[a]);return sigma};sigma.easing={linear:{},quadratic:{}};sigma.easing.linear.easenone=function(a){return a};sigma.easing.quadratic.easein=function(a){return a*a};sigma.easing.quadratic.easeout=
function(a){return-a*(a-2)};sigma.easing.quadratic.easeinout=function(a){return 1>(a*=2)?0.5*a*a:-0.5*(--a*(a-2)-1)};sigma.tools.drawRoundRect=function(a,f,g,c,k,d,b){d=d?d:0;var l=b?b:[],l="string"==typeof l?l.split(" "):l;b=d&&(0<=l.indexOf("topleft")||0<=l.indexOf("top")||0<=l.indexOf("left"));var n=d&&(0<=l.indexOf("topright")||0<=l.indexOf("top")||0<=l.indexOf("right")),m=d&&(0<=l.indexOf("bottomleft")||0<=l.indexOf("bottom")||0<=l.indexOf("left")),l=d&&(0<=l.indexOf("bottomright")||0<=l.indexOf("bottom")||
0<=l.indexOf("right"));a.moveTo(f,g+d);b?a.arcTo(f,g,f+d,g,d):a.lineTo(f,g);n?(a.lineTo(f+c-d,g),a.arcTo(f+c,g,f+c,g+d,d)):a.lineTo(f+c,g);l?(a.lineTo(f+c,g+k-d),a.arcTo(f+c,g+k,f+c-d,g+k,d)):a.lineTo(f+c,g+k);m?(a.lineTo(f+d,g+k),a.arcTo(f,g+k,f,g+k-d,d)):a.lineTo(f,g+k);a.lineTo(f,g+d)};sigma.tools.getRGB=function(a,f){a=a.toString();var g={r:0,g:0,b:0};if(3<=a.length&&"#"==a.charAt(0)){var c=a.length-1;6==c?g={r:parseInt(a.charAt(1)+a.charAt(2),16),g:parseInt(a.charAt(3)+a.charAt(4),16),b:parseInt(a.charAt(5)+
a.charAt(5),16)}:3==c&&(g={r:parseInt(a.charAt(1)+a.charAt(1),16),g:parseInt(a.charAt(2)+a.charAt(2),16),b:parseInt(a.charAt(3)+a.charAt(3),16)})}f&&(g=[g.r,g.g,g.b]);return g};sigma.tools.rgbToHex=function(a,f,g){return sigma.tools.toHex(a)+sigma.tools.toHex(f)+sigma.tools.toHex(g)};sigma.tools.toHex=function(a){a=parseInt(a,10);if(isNaN(a))return"00";a=Math.max(0,Math.min(a,255));return"0123456789ABCDEF".charAt((a-a%16)/16)+"0123456789ABCDEF".charAt(a%16)};sigma.tools.isOnSegment=function(a,f,g,
c,k,d,b,l){return Math.min(g,k)<a&&a<Math.max(g,k)&&Math.min(c,d)<f&&f<Math.max(c,d)?Math.abs((f-c)*(k-g)-(a-g)*(d-c))<b*l:!1};sigma.tools.pointOnQuadraticCurve=function(a,f,g,c,k,d,b){return{x:Math.pow(1-a,2)*f+2*(1-a)*a*d+Math.pow(a,2)*c,y:Math.pow(1-a,2)*g+2*(1-a)*a*b+Math.pow(a,2)*k}};sigma.tools.isOnQuadraticCurve=function(a,f,g,c,k,d,b,l,m,t){var u=Math.sqrt(Math.pow(g-k,2)+Math.pow(c-d,2));if(Math.abs(a-g)>u||Math.abs(f-c)>u)return!1;var q=Math.sqrt(Math.pow(g-a,2)+Math.pow(c-f,2)),r=Math.sqrt(Math.pow(k-
a,2)+Math.pow(d-f,2)),u=0.5,q=q<r?-0.1:0.1;t=Math.log(1+m)*t/20;r=sigma.tools.pointOnQuadraticCurve(u,g,c,k,d,b,l);for(r=Math.sqrt(Math.pow(a-r.x,2)+Math.pow(f-r.y,2));0<=u&&1>=u&&r>t&&(0.025<q||-0.025>q);)m=r,r=sigma.tools.pointOnQuadraticCurve(u,g,c,k,d,b,l),r=Math.sqrt(Math.pow(a-r.x,2)+Math.pow(f-r.y,2)),r>m?(q=-q/2,u+=q):0>u+q||1<u+q?(q/=2,r=m):u+=q;return r<t};sigma.publicPrototype=z.prototype})();
