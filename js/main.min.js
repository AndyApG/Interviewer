//helper functions go here
var settings={debug:!1,defaultNodeRadius:28,circleColor:"#fff",circleNumber:4},Notify=function(e,t){settings.debug&&console.log(e)},randomBetween=function(e,t){return Math.random()*(t-e)+e};Storage.prototype.setObject=function(e,t){this.setItem(e,JSON.stringify(t))};Storage.prototype.getObject=function(e){var t=this.getItem(e);return t&&JSON.parse(t)};var NetCanvas=function(){var e,t,n,r,s,o,u,a,f,l=[],c=!1,h={},p={},d=[],v=[];v.blue="#0174DF";v.edge="#0174DF";var m=new Array("Barney","Jonathon","Myles","Alethia","Tammera","Veola","Meredith","Renee","Grisel","Celestina","Fausto","Eliana","Raymundo","Lyle","Carry","Kittie","Melonie","Elke","Mattie","Kieth","Lourie","Marcie","Trinity","Librada","Lloyd","Pearlie","Velvet","Stephan","Hildegard","Winfred","Tempie","Maybelle","Melynda","Tiera","Lisbeth","Kiera","Gaye","Edra","Karissa","Manda","Ethelene","Michelle","Pamella","Jospeh","Tonette","Maren","Aundrea","Madelene","Epifania","Olive");p.init=function(e){if(c)return;c=!0;h=e;this.initKinetic();this.drawUIComponents();this.loadGraph()};p.addNode=function(e,t,n,i){var o,u,a=i!=null?i:m[Math.round(randomBetween(0,m.length-1))],f=t!=null?t:h.defaultNodeRadius;if(e!=null){o=e[0];u=e[1]}else{o=Math.round(randomBetween(100,window.innerWidth-100));u=Math.round(randomBetween(100,window.innerHeight-100))}var c=new Kinetic.Group({id:l.length,y:u,x:o,name:a,edges:[],draggable:!0,dragDistance:10}),g=new Kinetic.Circle({radius:f,fill:v.blue,strokeWidth:0}),y=new Kinetic.Text({text:a,fontSize:25,fontFamily:"Lato",fill:"white",offsetX:-32,offsetY:15,fontStyle:100,shadowColor:"black",shadowBlur:4,shadowOffset:{x:0,y:0},shadowOpacity:1});c.add(g);c.add(y);Notify("Putting node "+a+" at coordinates x:"+o+", y:"+u,"success");c.on("dragstart",function(){Notify("dragstart");var e=this;this.moveToTop();s.draw()});c.on("dragmove",function(e){Notify("Dragmove");var t=this;$.each(r.children,function(e,n){if(n.attrs.from==t||n.attrs.to==t){var r=[n.attrs.from.attrs.x,n.attrs.from.attrs.y,n.attrs.to.attrs.x,n.attrs.to.attrs.y];n.attrs.points=r}});r.draw()});c.on("tap",function(e){this.moveToTop();s.draw()});c.on("dbltap",function(e){Notify("double tap");d.push(this);if(d.length==2){p.addEdge(d[0],d[1]);d[0].children[0].fill(v.blue);d[1].children[0].fill(v.blue);d=[];s.draw()}else{this.children[0].fill("red");s.draw()}});c.on("dragend",function(){Notify("dragend");var e=this;p.saveGraph()});s.add(c);l.push(c);c.moveToBottom();s.draw();p.saveGraph();return c};p.getNodeByID=function(e){var t={};$.each(l,function(n,r){r.attrs.id==e&&(t=r)});return t};p.addEdge=function(e,t){var n=!1,i,o,u;if(e!=null&&typeof e=="object"||t!=null&&typeof t=="object"){i=e;o=t}else{i=p.getNodeByID(e);o=p.getNodeByID(t)}r.children.length>0&&$.each(r.children,function(e,t){if(t.attrs.from==i&&t.attrs.to==o||t.attrs.to==i&&t.attrs.from==o){u=t;n=!0}});if(n){p.removeEdge(u);return!1}var a=[i.attrs.x,i.attrs.y,o.attrs.x,o.attrs.y],f=new Kinetic.Line({strokeWidth:4,stroke:v.edge,from:i,to:o,points:a});r.add(f);r.draw();s.draw();Notify("Created Edge between "+i.children[1].attrs.text+" and "+o.children[1].attrs.text,"success");p.saveGraph();return!0};p.removeEdge=function(e){Notify("Removing edge.");$.each(r.children,function(t,n){if(n==e){r.children[t].remove();r.draw()}});p.saveGraph()};p.getSimpleEdges=function(){var e={},t=0;$.each(r.children,function(n,r){e[t]={};e[t].from=r.attrs.from.attrs.id;e[t].to=r.attrs.to.attrs.id;t++});return e};p.getEdgeLayer=function(){return r};p.initKinetic=function(){e=new Kinetic.Stage({container:"kineticCanvas",width:window.innerWidth,height:window.innerHeight});e.getContent().addEventListener("touchmove",function(e){var t=e.touches[0],n=e.touches[1]},!1);e.getContent().addEventListener("MSHoldVisual",function(e){e.preventDefault()},!1);n=new Kinetic.Layer;s=new Kinetic.Layer;r=new Kinetic.Layer;a=new Kinetic.Layer;e.add(n);e.add(r);e.add(s);e.add(a)};p.loadGraph=function(){Notify("Loading graph from localStorage.");loadedNodes=localStorage.getObject("nodes");loadedEdges=localStorage.getObject("edges");$.each(loadedNodes,function(e,t){var n=[];n.push(t.x);n.push(t.y);var r=t.name;p.addNode(n,null,null,r)});$.each(loadedEdges,function(e,t){p.addEdge(t.from,t.to)})};p.saveGraph=function(){Notify("Saving graph.");simpleNodes=p.getSimpleNodes();simpleEdges=p.getSimpleEdges();localStorage.setObject("nodes",simpleNodes);localStorage.setObject("edges",simpleEdges)};p.getNodes=function(){return l};p.getEdges=function(){return r.children};p.getSimpleNodes=function(){var e=new Object;$.each(l,function(t,n){e[n.attrs.id]={};e[n.attrs.id].x=n.attrs.x;e[n.attrs.id].y=n.attrs.y;e[n.attrs.id].name=n.attrs.name});return e};p.drawUIComponents=function(){var t,r,s=h.circleColor,o=window.innerHeight-h.defaultNodeRadius*2,u=.1;for(i=0;i<h.circleNumber;i++){var f=1-i/h.circleNumber,l=o/2*f,r=new Kinetic.Circle({x:window.innerWidth/2,y:window.innerHeight/2,radius:l,stroke:"white",strokeWidth:1.5,opacity:0}),t=new Kinetic.Circle({x:window.innerWidth/2,y:window.innerHeight/2,radius:l,fill:s,opacity:u,strokeWidth:0});u+=(.3-u)/h.circleNumber;n.add(t);n.add(r)}var c=new Kinetic.Circle({radius:50,stroke:"#666",strokeWidth:0,y:window.innerHeight-100,x:100});c.on("click tap",function(){var t=e.getPointerPosition(),n=new Array;n[0]=t.x;n[1]=t.y;Notify(n);var r=p.addNode(n);c.moveToBottom();a.draw()});a.add(c);n.draw();a.draw()};p.clearGraph=function(){r.removeChildren();r.clear();s.removeChildren();s.clear();l=[];p.saveGraph()};p.createRandomGraph=function(e,t){e=e||10;t=t||.4;Notify("Creating random graph...");for(i=0;i<e;i++){var n=i+1;Notify("Adding node "+n+" of "+e);p.addNode()}Notify("Adding edges.");$.each(l,function(e,n){if(randomBetween(0,1)<t){var r=Math.round(randomBetween(0,l.length-1));p.addEdge(l[e],l[r])}})};return p}(),menu=function(){var e={},t=!1;e.open=function(){$(".menu-item").animate({marginLeft:0},500,"easeOutQuint");$(".menu-container").animate({opacity:"1"},500,"easeOutQuint");t=!0};e.close=function(){$(".menu-item").animate({marginLeft:"-110px"},700,"easeOutQuint");$(".menu-container").animate({opacity:"0"},500,"easeOutQuint");t=!1};e.toggle=function(){t?e.close():e.open()};return e}();window.onload=function(){$("body").addClass("bodyfade");document.getElementById("kineticCanvas").addEventListener("contextmenu",function(e){e.preventDefault()});$("#menu-button").click(function(){menu.toggle()});$(".menu-item").click(function(){menu.close()});$("#kineticCanvas").click(function(){menu.close()});$("#refresh-button").click(function(){$(this).addClass(".refresh-animate");location.reload()});$("#generate-graph-submit").click(function(){$(".modal").modal("hide");menu.close();$("#gen-graph-clear").is(":checked")&&NetCanvas.clearGraph();var e=$("#gen-graph-nodes").val(),t=$("#gen-graph-edge-prob").val();NetCanvas.createRandomGraph(e,t)});mySwiper=new Swiper(".swiper-container",{mode:"horizontal",loop:!1,autoResize:!0,keyboardControl:!0,speed:1e3,onlyExternal:!0,onSlideChangeStart:function(e){},onSlideChangeEnd:function(){}});NetCanvas.init(settings)};