// globals
function doNotification(e,t){notificationStyle=t!=null?t:"Standard";debug==1&&alertify.log(e,notificationStyle)}function drawNewNodeBox(){var e=new Kinetic.Circle({radius:50,stroke:"#666",strokeWidth:0,y:window.innerHeight-100,x:100});e.on("mousedown touchstart",function(){var t=stage.getTouchPosition()!=null?stage.getTouchPosition():stage.getMousePosition(),n=new Array;n[0]=t.x;n[1]=t.y;console.log(n);var r=buildNode(n);e.moveToBottom();e.setListening(!1);uiLayer.draw()});uiLayer.add(e);uiLayer.draw()}function drawConcentricCircles(e,t){var t=t!=null?t:"#666",n,r,s=window.innerHeight-defaultNodeRadius*2,o=s/e,u=o,a=.2,f=a/e,l=f;for(i=0;i<e;i++){var c=a-i*f,r=new Kinetic.Circle({x:window.innerWidth/2,y:window.innerHeight/2,radius:u/2,stroke:"white",strokeWidth:.5,opacity:1}),n=new Kinetic.Circle({x:window.innerWidth/2,y:window.innerHeight/2,radius:u/2,fill:t,strokeWidth:.5,opacity:c});u+=o;l+=f;circleLayer.add(r);circleLayer.add(n)}circleLayer.draw()}function randomBetween(e,t){return Math.random()*(t-e)+e}function clearGraph(){edgeLayer.removeChildren();edgeLayer.clear();nodeLayer.removeChildren();nodeLayer.clear();nodes=[];edges=[]}function animSelected(e,t){$.each(nodes,function(e,t){});nodeLayer.draw();if(selected!=e){var n=e.children[0],r=Math.PI/3;n.setStroke(colors.blue);n.setStrokeWidth(10);var i=new Kinetic.Animation(function(e){var t=e.timeDiff*r/1e3;n.rotate(t)},nodeLayer);selected=e;return i}}function handleNodeTouch(e){this=e;switch(currentMode){case 1:break;case 2:if(edgeTemp.length==1)if(this==edgeTemp[0]){doNotification("Same node. Ignoring...");edgeTemp=[]}else{doNotification("Selected second node.","info");buildEdge(edgeTemp[0],this);edgeTemp=[]}else{doNotification("Selected first node.","info");edgeTemp.push(this)}break;case 3:break;default:doNotification("ERROR: Current mode not set correctly.","error")}}function randomGraph(e,t){doNotification("Creating random graph...");for(i=0;i<e;i++)nodes.push(buildNode());$.each(nodes,function(e,n){if(randomBetween(0,1)<t){var r=Math.round(randomBetween(0,nodes.length-1));buildEdge(nodes[e],nodes[r])}})}function updateEdgePosition(e){e!=null&&$.each(e.attrs.edges,function(t,n){if(n.attrs.from==e){n.attrs.points[0].y=e.attrs.y;n.attrs.points[0].x=e.attrs.x}else{n.attrs.points[1].y=e.attrs.y;n.attrs.points[1].x=e.attrs.x}});edgeLayer.draw()}function changeMode(e){if(e!=null){currentMode=e;doNotification("Changing mode to: "+e,"info");switch(e){case 1:break;case 2:$.each(nodes,function(e,t){nodes[e].attrs.draggable=!1});break;case 3:break;default:doNotification("ERROR: Current mode not set correctly.","error")}}else doNotification("ERROR: No new mode specified.","error")}function buildNode(e,t,n,r){var i,s;if(e!=null){i=e[0];s=e[1]}else{i=Math.round(randomBetween(100,window.innerWidth-100));s=Math.round(randomBetween(100,window.innerHeight-100))}var o=r!=null?r:namesList[Math.round(randomBetween(0,namesList.length))],u=t!=null?t:defaultNodeRadius,a=new Kinetic.Group({id:nodes.length,draggable:!0,y:s,x:i,edges:[]}),n=new Kinetic.Circle({dashArray:[15,3],radius:u,stroke:colors.blue,strokeWidth:10}),r=new Kinetic.Text({text:o,fontSize:15,fontFamily:"Raleway",fill:colors.blue,offset:[-1.2*u,8]});a.add(n);a.add(r);doNotification("Putting node "+o+" at coordinates x:"+i+", y:"+s,"success");a.on("click",function(e){this.moveToTop();doNotification("Selected node "+this.children[1].attrs.text);if(selected!=null){selected.stop();$.each(nodes,function(e,t){nodes[e].setStrokeWidth=0})}currentNode=this;selected=animSelected(this);selected.start()});a.on("dragmove",function(){updateEdgePosition(this)});a.on("dragend",function(){updateEdgePosition(this);uiLayer.children[0].setListening(!0);uiLayer.draw();currentNode=null});nodeLayer.add(a);nodes.push(a);a.moveToBottom();nodeLayer.draw();return a}function buildEdge(e,t){var n=!1;$.each(e.attrs.edges,function(e,r){if(r.attrs.from==t||r.attrs.to==t)n=!0});if(n||e===t){doNotification("Edge already exists. Cancelling.","error");return!1}var r=e.attrs.x,i=e.attrs.y,s=t.attrs.x,o=t.attrs.y,u=new Kinetic.Line({strokeWidth:2,stroke:colors.edge,from:e,to:t,points:[r,i,s,o]});e.attrs.edges.push(u);t.attrs.edges.push(u);edgeLayer.add(u);edgeLayer.draw();nodeLayer.draw();doNotification("Created Edge between "+e.children[1].attrs.text+" and "+t.children[1].attrs.text,"success");return!0}var stage,nodeOrigin,circleLayer,edgeLayer,nodeLayer,currentNode,selected,uiLayer,mySwiper,nodes=[],edges=[],edgeTemp=[],defaultNodeRadius=33,debug=!0,leftHanded=!0,currentMode=1,colors=[];colors.blue="#0174DF";colors.edge="#888";var namesList=new Array("Barney","Jonathon","Myles","Alethia","Tammera","Veola","Meredith","Renee","Grisel","Celestina","Fausto","Eliana","Raymundo","Lyle","Carry","Kittie","Melonie","Elke","Mattie","Kieth","Lourie","Marcie","Trinity","Librada","Lloyd","Pearlie","Velvet","Stephan","Hildegard","Winfred","Tempie","Maybelle","Melynda","Tiera","Lisbeth","Kiera","Gaye","Edra","Karissa","Manda","Ethelene","Michelle","Pamella","Jospeh","Tonette","Maren","Aundrea","Madelene","Epifania","Olive");alertify.set({delay:1700});window.onload=function(){mySwiper=new Swiper(".swiper-container",{mode:"horizontal",loop:!1,autoResize:!0,keyboardControl:!0,speed:1e3,onlyExternal:!0,onSlideChangeStart:function(e){$(".swiper-slide").fadeTo(200,0)},onSlideChangeEnd:function(){$(".swiper-slide").fadeTo(1e3,1)}});stage=new Kinetic.Stage({container:"kineticCanvas",width:window.innerWidth,height:window.innerHeight});$(".nodebutton").click(function(){changeMode(1);buildNode()});$(".edgebutton").click(function(){$(this).toggleClass("btn-danger");currentMode==2?changeMode(1):changeMode(2)});$(".communitybutton").click(function(){$(this).toggleClass("btn-danger");changeMode(3)});circleLayer=new Kinetic.Layer;nodeLayer=new Kinetic.Layer;edgeLayer=new Kinetic.Layer;uiLayer=new Kinetic.Layer;nodeLayer.on("beforeDraw",function(){currentNode!=null&&updateEdgePosition(currentNode)});stage.add(circleLayer);stage.add(edgeLayer);stage.add(nodeLayer);stage.add(uiLayer);updateEdgePosition();$("img").on("dragstart",function(e){e.preventDefault()});drawConcentricCircles(4);drawNewNodeBox();randomGraph(10,.4)};