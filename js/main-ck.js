// globals
function doNotification(e,t){if(debug==1){var n=t!=null?t:"info";$(".top-right").notify({message:e,type:n}).show()}}function drawNewNodeBox(){var e=new Kinetic.Circle({radius:50,stroke:"#666",strokeWidth:2,y:window.innerHeight-100,x:100});e.on("mousedown touchstart",function(){var t=stage.getTouchPosition()!=null?stage.getTouchPosition():stage.getMousePosition(),n=t.x,r=t.y,i=buildNode(r,n);e.moveToBottom();e.setListening(!1);uiLayer.draw()});uiLayer.add(e);uiLayer.draw()}function drawConcentricCircles(e,t){var t=t!=null?t:"#666",n,r,s=window.innerHeight-defaultNodeRadius*2,o=s/e,u=o,a=.2,f=a/e,l=f;for(i=0;i<e;i++){var c=a-i*f,r=new Kinetic.Circle({x:window.innerWidth/2,y:window.innerHeight/2,radius:u/2,stroke:"white",strokeWidth:.5,opacity:1}),n=new Kinetic.Circle({x:window.innerWidth/2,y:window.innerHeight/2,radius:u/2,fill:t,strokeWidth:.5,opacity:c});u+=o;l+=f;circleLayer.add(r);circleLayer.add(n)}circleLayer.draw()}function randomBetween(e,t){return Math.random()*(t-e)+e}function clearGraph(){edgeLayer.removeChildren();edgeLayer.clear();nodeLayer.removeChildren();nodeLayer.clear();nodes=[]}function animSelected(e,t){$.each(nodes,function(e,t){});nodeLayer.draw();if(selected!=e){var n=e.children[0],r=Math.PI/3;n.setStroke(colors.blue);n.setStrokeWidth(10);var i=new Kinetic.Animation(function(e){var t=e.timeDiff*r/1e3;n.rotate(t)},nodeLayer);selected=e;return i}}function randomGraph(e,t){doNotification("Creating random graph...");for(i=0;i<e;i++)nodes.push(buildNode());$.each(nodes,function(e,n){if(randomBetween(0,1)<t){var r=Math.round(randomBetween(0,nodes.length-1));buildEdge(nodes[e],nodes[r])}})}function updateEdgePosition(e){e!=null&&$.each(e.attrs.edges,function(t,n){if(n.attrs.from==e){n.attrs.points[0].y=e.attrs.y;n.attrs.points[0].x=e.attrs.x}else{n.attrs.points[1].y=e.attrs.y;n.attrs.points[1].x=e.attrs.x}});edgeLayer.draw()}function changeMode(e){if(e!=null){currentMode=e;doNotification("Changing mode to: "+e,"info");switch(e){case 1:break;case 2:$.each(nodes,function(e,t){nodes[e].attrs.draggable=!1});break;case 3:break;default:doNotification("ERROR: Current mode not set correctly.","error")}}else doNotification("ERROR: No new mode specified.","error")}function buildNode(e,t,n,r,i){var s=t!=null?e:Math.round(randomBetween(100,window.innerHeight-100)),o=e!=null?t:Math.round(randomBetween(100,window.innerWidth-100)),u=i!=null?i:namesList[Math.round(randomBetween(0,namesList.length))],a=n!=null?n:defaultNodeRadius,f=new Kinetic.Group({id:nodes.length,draggable:!0,y:s,x:o,edges:[]}),r=new Kinetic.Circle({dashArray:[15,3],radius:a,stroke:colors.blue,strokeWidth:10}),i=new Kinetic.Text({text:u,fontSize:15,fontFamily:"Helvetica",fill:colors.blue,offset:[-30,10]});f.add(r);f.add(i);doNotification("Putting node at: "+o+", "+s,"success");f.on("mouseover",function(){document.body.style.cursor="pointer";nodeLayer.draw()});f.on("mouseout",function(){document.body.style.cursor="default";nodeLayer.draw()});f.on("mousedown",function(e){this.moveToTop();doNotification("Event: "+e);switch(currentMode){case 1:break;case 2:if(edgeTemp.length==1)if(this==edgeTemp[0]){doNotification("Same node. Ignoring...");edgeTemp=[]}else{doNotification("Selected second node.","info");buildEdge(edgeTemp[0],this);edgeTemp=[]}else{doNotification("Selected first node.","info");edgeTemp.push(this)}break;case 3:break;default:doNotification("ERROR: Current mode not set correctly.","error")}doNotification("Selected node "+this.children[1].attrs.text);if(selected!=null){selected.stop();$.each(nodes,function(e,t){nodes[e].setStrokeWidth=0})}currentNode=this;selected=animSelected(this);selected.start()});f.on("dragstart",function(){updateEdgePosition(this)});f.on("dragend",function(){updateEdgePosition(this);uiLayer.children[0].setListening(!0);uiLayer.draw();currentNode=null});nodeLayer.add(f);nodes.push(f);f.moveToBottom();nodeLayer.draw();return f}function buildEdge(e,t){var n=!1;$.each(e.attrs.edges,function(e,r){if(r.attrs.from==t||r.attrs.to==t)n=!0});if(n||e===t){doNotification("Edge already exists. Cancelling.","error");return!1}var r=e.attrs.x,i=e.attrs.y,s=t.attrs.x,o=t.attrs.y,u=new Kinetic.Line({strokeWidth:2,stroke:colors.edge,from:e,to:t,points:[r,i,s,o]});e.attrs.edges.push(u);t.attrs.edges.push(u);edgeLayer.add(u);edgeLayer.draw();nodeLayer.draw();doNotification("Created Edge between "+e.children[1].attrs.text+" and "+t.children[1].attrs.text,"success");return!0}var stage,nodeOrigin,circleLayer,edgeLayer,nodeLayer,currentNode,selected,uiLayer,nodes=[],edges=[],edgeTemp=[],defaultNodeRadius=23,debug=!0,leftHanded=!0,currentMode=1,colors=[];colors.blue="#0174DF";colors.edge="#888";var namesList=new Array("Barney","Jonathon","Myles","Alethia","Tammera","Veola","Meredith","Renee","Grisel","Celestina","Fausto","Eliana","Raymundo","Lyle","Carry","Kittie","Melonie","Elke","Mattie","Kieth","Lourie","Marcie","Trinity","Librada","Lloyd","Pearlie","Velvet","Stephan","Hildegard","Winfred","Tempie","Maybelle","Melynda","Tiera","Lisbeth","Kiera","Gaye","Edra","Karissa","Manda","Ethelene","Michelle","Pamella","Jospeh","Tonette","Maren","Aundrea","Madelene","Epifania","Olive");window.onload=function(){stage=new Kinetic.Stage({container:"container",width:window.innerWidth,height:window.innerHeight});$(document).bind("contextmenu",function(e){return!1});$(".nodebutton").click(function(){changeMode(1);buildNode()});$(".edgebutton").click(function(){$(this).toggleClass("btn-danger");currentMode==2?changeMode(1):changeMode(2)});$(".communitybutton").click(function(){$(this).toggleClass("btn-danger");changeMode(3)});circleLayer=new Kinetic.Layer;nodeLayer=new Kinetic.Layer;edgeLayer=new Kinetic.Layer;uiLayer=new Kinetic.Layer;nodeLayer.on("beforeDraw",function(){currentNode!=null&&updateEdgePosition(currentNode)});stage.add(circleLayer);stage.add(edgeLayer);stage.add(nodeLayer);stage.add(uiLayer);updateEdgePosition();$("img").on("dragstart",function(e){e.preventDefault()});drawConcentricCircles(4);drawNewNodeBox()};