var Network=function e(){var e={},t={};return e.init=function(){return notify("Network Initialising",2),window.nodes=session.registerData("nodes",!0),window.edges=session.registerData("edges",!0),!0},e.addNode=function(t){if("undefined"!=typeof t.id&&e.getNode(t.id)!==!1)return notify("Node already exists with id "+t.id+". Cancelling!",2),!1;for(var n=0;e.getNode(n)!==!1;)n++;var d={id:n};extend(d,t),session.addData("nodes",d,!0);var o=new CustomEvent("log",{detail:{eventType:"nodeCreate",eventObject:d}});window.dispatchEvent(o);var r=new CustomEvent("nodeAdded",{detail:d});window.dispatchEvent(r);var i=new Event("unsavedChanges");return window.dispatchEvent(i),d.id},e.addEdge=function(t){if("undefined"==typeof t.from||"undefined"==typeof t.to)return notify('ERROR: "To" and "From" must BOTH be defined.',2),!1;if("undefined"!==t.id&&e.getEdge(t.id)!==!1)return notify("edge with this id already exists!!!",2),!1;for(var n=0;e.getEdge(n)!==!1;)n++;var d={id:n,type:"Default"};extend(d,t);var o=!1,r={},i;if(r=$.extend(!0,{},t),i=r.to,r.to=r.from,r.from=i,(e.getEdges(t).length>0||e.getEdges(r).length>0)&&(o=!0),o===!1){session.addData("edges",d,!0);var a=new CustomEvent("log",{detail:{eventType:"edgeCreate",eventObject:d}});window.dispatchEvent(a);var s=new CustomEvent("edgeAdded",{detail:d});window.dispatchEvent(s);var v=new Event("unsavedChanges");return window.dispatchEvent(v),d.id}return notify("ERROR: Edge already exists!",2),!1},e.removeEdges=function(t){e.removeEdge(t)},e.removeEdge=function(e){if(console.log(e),!e)return!1;var t,n,d=session.returnData("edges");if("object"==typeof e&&"undefined"!=typeof e.length)for(var o=0;o<e.length;o++)removeFromObject(e[o],d),t=new CustomEvent("log",{detail:{eventType:"edgeRemove",eventObject:e[o]}}),n=new CustomEvent("edgeRemoved",{detail:e[o]}),window.dispatchEvent(t),window.dispatchEvent(n);else removeFromObject(e,d),t=new CustomEvent("log",{detail:{eventType:"edgeRemove",eventObject:e}}),n=new CustomEvent("edgeRemoved",{detail:e}),window.dispatchEvent(t),window.dispatchEvent(n);session.addData("edges",d);var r=new Event("unsavedChanges");return window.dispatchEvent(r),!0},e.removeNode=function(t){var n,d;e.removeEdge(e.getNodeEdges(t));for(var o=session.returnData("nodes"),r=0;r<o.length;r++)if(o[r].id===t)return d=new CustomEvent("log",{detail:{eventType:"nodeRemove",eventObject:o[r]}}),window.dispatchEvent(d),n=new CustomEvent("edgeRemoved",{detail:o[r]}),window.dispatchEvent(n),removeFromObject(o[r],o),session.addData("nodes",o),!0;return!1},e.updateEdge=function(t,n,d){if(e.getEdge(t)===!1||void 0===n)return!1;var o=e.getEdge(t),r,i;extend(o,n),r=new CustomEvent("edgeUpdatedEvent",{detail:o}),window.dispatchEvent(r),i=new CustomEvent("log",{detail:{eventType:"edgeUpdate",eventObject:o}}),window.dispatchEvent(i);var a=new Event("unsavedChanges");window.dispatchEvent(a),d&&d()},e.updateNode=function(t,n,d){if(e.getNode(t)===!1||void 0===n)return!1;var o=e.getNode(t),r,i;extend(o,n),r=new CustomEvent("nodeUpdatedEvent",{detail:o}),window.dispatchEvent(r),i=new CustomEvent("log",{detail:{eventType:"nodeUpdate",eventObject:o}}),window.dispatchEvent(i);var a=new Event("unsavedChanges");window.dispatchEvent(a),d&&d()},e.getNode=function(e){if(void 0===e)return!1;for(var t=session.returnData("nodes"),n=0;n<t.length;n++)if(t[n].id===e)return t[n];return!1},e.getEdge=function(e){if(void 0===e)return!1;for(var t=session.returnData("edges"),n=0;n<t.length;n++)if(t[n].id===e)return t[n];return!1},e.filterObject=function(e,t){if(!t)return!1;var n=e.filter(function(e){var n=!0;for(var d in t)void 0!==e[d]?e[d]!==t[d]&&(n=!1):n=!1;return n===!0?e:void 0});if("undefined"!=typeof t.from&&"undefined"!=typeof t.to){var d={},o;d=$.extend(!0,{},t),o=d.to,d.to=d.from,d.from=o;var r=e.filter(function(e){var t=!0;for(var n in d)void 0!==e[n]?e[n]!==d[n]&&(t=!1):t=!1;return t===!0?e:void 0});n=n.concat(r)}return n},e.getNodes=function(t,n){var d=session.returnData("nodes"),o;return o="undefined"!=typeof t&&0!==Object.keys(t).length?e.filterObject(d,t):d,n&&(o=n(o)),o},e.getEdges=function(t,n){var d=session.returnData("edges"),o;return o="undefined"!=typeof t&&0!==Object.keys(t).length?e.filterObject(d,t):d,n&&(o=n(o)),o},e.getNodeInboundEdges=function(t){return e.getEdges({to:t})},e.getNodeOutboundEdges=function(t){return e.getEdges({from:t})},e.getNodeEdges=function(t){if(e.getNode(t)===!1)return!1;var n=e.getNodeInboundEdges(t),d=e.getNodeOutboundEdges(t),o=n.concat(d);return o},e.setProperties=function(e,t){if("undefined"==typeof e)return!1;if("object"==typeof e&&e.length>0)for(var n=0;n<e.length;n++)$.extend(e[n],t);else $.extend(e,t)},e.returnNetwork=function(){return t},e.returnAllNodes=function(){return session.returnData("nodes")},e.returnAllEdges=function(){return session.returnData("edges")},e.createRandomGraph=function(t,n){var d=session.returnData("nodes");t=t||10,n=n||.4,notify("Creating random graph...",1);for(var o=0;t>o;o++){var r=o+1;notify("Adding node "+r+" of "+t,2);var i={coords:[Math.round(randomBetween(100,window.innerWidth-100)),Math.round(randomBetween(100,window.innerHeight-100))]};e.addNode(i)}notify("Adding edges.",3),$.each(d,function(t){if(randomBetween(0,1)<n){var o=Math.round(randomBetween(0,d.length-1));e.addEdge({from:d[t].id,to:d[o].id})}})},e.init(),e};