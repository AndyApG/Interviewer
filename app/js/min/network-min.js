var Network=function e(){var e={},t={};return e.init=function(){return global.tools.notify("Network Initialising",2),global.nodes=global.session.registerData("nodes",!0),global.edges=global.session.registerData("edges",!0),!0},e.addNode=function(t){if("undefined"!=typeof t.id&&e.getNode(t.id)!==!1)return global.tools.notify("Node already exists with id "+t.id+". Cancelling!",2),!1;for(var n=0;e.getNode(n)!==!1;)n++;var o={id:n};global.tools.extend(o,t),global.session.addData("nodes",o,!0);var d=new window.CustomEvent("log",{detail:{eventType:"nodeCreate",eventObject:o}});window.dispatchEvent(d);var i=new window.CustomEvent("nodeAdded",{detail:o});window.dispatchEvent(i);var r=new window.Event("unsavedChanges");return window.dispatchEvent(r),o.id},e.addEdge=function(t){if("undefined"==typeof t.from||"undefined"==typeof t.to)return global.tools.notify('ERROR: "To" and "From" must BOTH be defined.',2),!1;if("undefined"!==t.id&&e.getEdge(t.id)!==!1)return global.tools.notify("edge with this id already exists!!!",2),!1;for(var n=0;e.getEdge(n)!==!1;)n++;var o={id:n,type:"Default"};global.tools.extend(o,t);var d=!1,i={},r;if(i=$.extend(!0,{},t),r=i.to,i.to=i.from,i.from=r,(e.getEdges(t).length>0||e.getEdges(i).length>0)&&(d=!0),d===!1){global.session.addData("edges",o,!0);var a=new window.CustomEvent("log",{detail:{eventType:"edgeCreate",eventObject:o}});window.dispatchEvent(a);var s=new window.CustomEvent("edgeAdded",{detail:o});window.dispatchEvent(s);var l=new window.Event("unsavedChanges");return window.dispatchEvent(l),o.id}return global.tools.notify("ERROR: Edge already exists!",2),!1},e.removeEdges=function(t){e.removeEdge(t)},e.removeEdge=function(e){if(console.log(e),!e)return!1;var t,n,o=global.session.returnData("edges");if("object"==typeof e&&"undefined"!=typeof e.length)for(var d=0;d<e.length;d++)global.tools.removeFromObject(e[d],o),t=new window.CustomEvent("log",{detail:{eventType:"edgeRemove",eventObject:e[d]}}),n=new window.CustomEvent("edgeRemoved",{detail:e[d]}),window.dispatchEvent(t),window.dispatchEvent(n);else global.tools.removeFromObject(e,o),t=new window.CustomEvent("log",{detail:{eventType:"edgeRemove",eventObject:e}}),n=new window.CustomEvent("edgeRemoved",{detail:e}),window.dispatchEvent(t),window.dispatchEvent(n);global.session.addData("edges",o);var i=new window.Event("unsavedChanges");return window.dispatchEvent(i),!0},e.removeNode=function(t){var n,o;e.removeEdge(e.getNodeEdges(t));for(var d=global.session.returnData("nodes"),i=0;i<d.length;i++)if(d[i].id===t)return o=new window.CustomEvent("log",{detail:{eventType:"nodeRemove",eventObject:d[i]}}),window.dispatchEvent(o),n=new window.CustomEvent("edgeRemoved",{detail:d[i]}),window.dispatchEvent(n),global.tools.removeFromObject(d[i],d),global.session.addData("nodes",d),!0;return!1},e.updateEdge=function(t,n,o){if(e.getEdge(t)===!1||void 0===n)return!1;var d=e.getEdge(t),i,r;global.tools.extend(d,n),i=new window.CustomEvent("edgeUpdatedEvent",{detail:d}),window.dispatchEvent(i),r=new window.CustomEvent("log",{detail:{eventType:"edgeUpdate",eventObject:d}}),window.dispatchEvent(r);var a=new window.Event("unsavedChanges");window.dispatchEvent(a),o&&o()},e.updateNode=function(t,n,o){if(e.getNode(t)===!1||void 0===n)return!1;var d=e.getNode(t),i,r;global.tools.extend(d,n),i=new window.CustomEvent("nodeUpdatedEvent",{detail:d}),window.dispatchEvent(i),r=new window.CustomEvent("log",{detail:{eventType:"nodeUpdate",eventObject:d}}),window.dispatchEvent(r);var a=new window.Event("unsavedChanges");window.dispatchEvent(a),o&&o()},e.getNode=function(e){if(void 0===e)return!1;for(var t=global.session.returnData("nodes"),n=0;n<t.length;n++)if(t[n].id===e)return t[n];return!1},e.getEdge=function(e){if(void 0===e)return!1;for(var t=global.session.returnData("edges"),n=0;n<t.length;n++)if(t[n].id===e)return t[n];return!1},e.filterObject=function(e,t){if(!t)return!1;var n=e.filter(function(e){var n=!0;for(var o in t)void 0!==e[o]?e[o]!==t[o]&&(n=!1):n=!1;return n===!0?e:void 0});if("undefined"!=typeof t.from&&"undefined"!=typeof t.to){var o={},d;o=$.extend(!0,{},t),d=o.to,o.to=o.from,o.from=d;var i=e.filter(function(e){var t=!0;for(var n in o)void 0!==e[n]?e[n]!==o[n]&&(t=!1):t=!1;return t===!0?e:void 0});n=n.concat(i)}return n},e.getNodes=function(t,n){var o=global.session.returnData("nodes"),d;return d="undefined"!=typeof t&&0!==Object.keys(t).length?e.filterObject(o,t):o,n&&(d=n(d)),d},e.getEdges=function(t,n){var o=global.session.returnData("edges"),d;return d="undefined"!=typeof t&&0!==Object.keys(t).length?e.filterObject(o,t):o,n&&(d=n(d)),d},e.getNodeInboundEdges=function(t){return e.getEdges({to:t})},e.getNodeOutboundEdges=function(t){return e.getEdges({from:t})},e.getNodeEdges=function(t){if(e.getNode(t)===!1)return!1;var n=e.getNodeInboundEdges(t),o=e.getNodeOutboundEdges(t),d=n.concat(o);return d},e.setProperties=function(e,t){if("undefined"==typeof e)return!1;if("object"==typeof e&&e.length>0)for(var n=0;n<e.length;n++)$.global.tools.extend(e[n],t);else $.global.tools.extend(e,t)},e.returnNetwork=function(){return t},e.returnAllNodes=function(){return global.session.returnData("nodes")},e.returnAllEdges=function(){return global.session.returnData("edges")},e.createRandomGraph=function(t,n){var o=global.session.returnData("nodes");t=t||10,n=n||.4,global.tools.notify("Creating random graph...",1);for(var d=0;t>d;d++){var i=d+1;global.tools.notify("Adding node "+i+" of "+t,2);var r={coords:[Math.round(randomBetween(100,window.innerWidth-100)),Math.round(randomBetween(100,window.innerHeight-100))]};e.addNode(r)}global.tools.notify("Adding edges.",3),$.each(o,function(t){if(randomBetween(0,1)<n){var d=Math.round(randomBetween(0,o.length-1));e.addEdge({from:o[t].id,to:o[d].id})}})},e.init(),e};module.exports=new Network;