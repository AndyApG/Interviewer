var MultiBin=function o(){var o,e=!1,t={},i;t.options={targetEl:$(".container"),edgeType:"Dyad",variable:{label:"multibin_variable",values:["Variable 1"]},filter:void 0,heading:"Default Heading",subheading:"Default Subheading."};var n=!1,a=function(){t.destroy()},l=function(o){o.preventDefault();var e=i,n={to:e};global.tools.extend(n,t.options.criteria);var a=global.network.getEdges(n)[0],l={};$.each(t.options.followup.questions,function(o){var e=$("#"+t.options.followup.questions[o].variable).val();l[t.options.followup.questions[o].variable]=e}),global.tools.extend(a,l),global.network.updateEdge(a.id,a),$.each(t.options.followup.questions,function(o){$("#"+t.options.followup.questions[o].variable).val("")}),$(".followup").hide(),$(".black-overlay").hide()},s=function(){$("#"+t.options.followup.variable).val(""),$(".followup").hide(),$(".black-overlay").hide()},d=function(t){t.stopPropagation(),t.target!==t.currentTarget&&n===!0&&($(".container").children().removeClass("invisible"),$(".copy").removeClass("node-bin-active"),$(".copy").addClass("node-bin-static"),$(".copy").children("h1, p").show(),$(".copy").removeClass("copy"),$(".draggable").draggable({cursor:"pointer",revert:"invalid",disabled:!1,start:function(){if(e===!1){var t={stage:global.session.currentStage(),timestamp:new Date};o=new window.CustomEvent("log",{detail:{eventType:"taskComprehended",eventObject:t}}),window.dispatchEvent(o),e=!0}}}),n=!1)},r=function(t){if(t.stopPropagation(),n===!1){if($(".draggable").draggable({cursor:"pointer",revert:"invalid",disabled:!0,start:function(){if(e===!1){var t={stage:global.session.currentStage(),timestamp:new Date};o=new window.CustomEvent("log",{detail:{eventType:"taskComprehended",eventObject:t}}),window.dispatchEvent(o),e=!0}}}),!$(this).hasClass(".node-bin-active")){$(".container").children().not(this).addClass("invisible");var i=$(this).offset(),a=$(this);a.offset(i),a.addClass("node-bin-active copy"),a.removeClass("node-bin-static"),a.children("h1, p").hide(),a.children(".active-node-list").children(".node-item").css({top:0,left:20,opacity:0}),setTimeout(function(){a.addClass("node-bin-active"),$.each($(".active-node-list").children(),function(o,e){setTimeout(function(){$(e).transition({left:0,opacity:1})},20*o)})},100)}n=!0}},p=function(o){o.stopPropagation();var e=$(this),i=$(this).parent().parent().data("index");if($(this).parent().hasClass("active-node-list")){var n=global.network.getEdges({from:global.network.getNodes({type_t0:"Ego"})[0].id,to:e.data("node-id"),type:t.options.edgeType})[0].id,a={};a[t.options.variable.label]="","undefined"!=typeof t.options.followup&&$.each(t.options.followup.questions,function(o,e){a[e.variable]=void 0}),global.network.updateEdge(n,a),$(this).fadeOut(400,function(){$(this).appendTo(".node-bucket"),$(this).css("display","");var o="people";1===$(".c"+i).children(".active-node-list").children().length&&(o="person"),$(".c"+i).children("p").html(0===$(".c"+i).children(".active-node-list").children().length?"(Empty)":$(".c"+i).children(".active-node-list").children().length+" "+o+".")})}};return t.destroy=function(){global.tools.notify("Destroying multiBin.",0),window.removeEventListener("changeStageStart",a,!1),$(".node-bin-static").off("click",r),$(".node-item").off("click",p),$(".content").off("click",d),$(".followup-submit").off("click",l),$(".followup-cancel").off("click",s),$(".followup").remove()},t.init=function(n){if(global.tools.extend(t.options,n),t.options.targetEl.append("<h1>"+t.options.heading+"</h1>"),t.options.targetEl.append('<p class="lead">'+t.options.subheading+"</p>"),t.options.targetEl.append('<div class="node-bucket"></div>'),"undefined"!=typeof t.options.followup){if($("body").append('<div class="followup overlay"><form class="followup-form"></form></div>'),"undefined"!=typeof t.options.followup.linked&&t.options.followup.linked===!0){var c=!0;$.each(t.options.followup.questions,function(o,e){$(".followup").children("form").append("<h2>"+e.prompt+'</h2><div class="row form-group"><input type="number" class="form-control '+e.variable+'" id="'+e.variable+'" required></div>'),c&&$("#"+e.variable).change(function(){$("#"+t.options.followup.questions[o+1].variable).val()>$("#"+e.variable).val()&&$("#"+t.options.followup.questions[o+1].variable).val($("#"+e.variable).val()),$("#"+t.options.followup.questions[o+1].variable).attr("max",$("#"+e.variable).val())}),c=!c})}else $.each(t.options.followup.questions,function(o,e){$(".followup").children("form").append("<h2>"+e.prompt+'</h2><div class="row form-group"><input type="text" class="form-control '+e.variable+'" id="'+e.variable+'" required></div>')});$(".followup").children("form").append('<div class="row form-group"><button type="submit" class="btn btn-primary btn-block followup-submit">Continue</button></div>'),"undefined"!=typeof t.options.followup.cancel&&$(".overlay").children().last(".form-group").prepend('<button type="submit" class="btn btn-warning btn-block followup-cancel">'+t.options.followup.cancel+"</button>")}for(var u=Math.floor(.66*t.options.variable.values.length),v=$(".container").outerWidth()/u,f=v;2*f>$(".container").height()-300;)f=.98*f;var b=global.network.getEdges(t.options.criteria,t.options.filter);$.each(t.options.variable.values,function(o,e){var n=$('<div class="node-bin node-bin-static c'+o+'" data-index="'+o+'"><h1>'+e+'</h1><p class="lead">(Empty)</p><div class="active-node-list"></div></div>');n.data("index",o),t.options.targetEl.append(n),$(".c"+o).droppable({accept:".draggable",drop:function(e,n){var a=n.draggable,l=$(this);if("undefined"!=typeof t.options.followup&&t.options.followup.trigger.indexOf(t.options.variable.values[o])>=0)$(".followup").show(),$(".black-overlay").show(),$("#"+t.options.followup.questions[0].variable).focus(),i=$(a).data("node-id");else if("undefined"!=typeof t.options.followup){var s=$(a).data("node-id"),d={to:s};global.tools.extend(d,t.options.criteria);var r=global.network.getEdges(d)[0],p={};$.each(t.options.followup.questions,function(o){p[t.options.followup.questions[o].variable]=void 0}),global.tools.extend(r,p),global.network.updateEdge(r.id,r),$.each(t.options.followup.questions,function(o){$("#"+t.options.followup.questions[o].variable).val("")})}$(a).appendTo(l.children(".active-node-list"));var c={};c[t.options.variable.label]=t.options.variable.values[o];var u=global.network.getEdges({from:global.network.getNodes({type_t0:"Ego"})[0].id,to:$(a).data("node-id"),type:t.options.edgeType})[0].id;global.network.updateEdge(u,c);var v="people";1===$(".c"+o+" .active-node-list").children().length&&(v="person"),$(".c"+o+" p").html($(".c"+o+" .active-node-list").children().length+" "+v+".");var f=$(".c"+o);f.transition({scale:1.2},200,"ease"),setTimeout(function(){f.transition({background:f.data("oldBg")},200,"ease"),f.transition({scale:1},200,"ease")},0)},over:function(){$(this).data("oldBg",$(this).css("background-color")),$(this).stop().transition({background:"rgba(255, 193, 0, 1.0)"},400,"ease")},out:function(){$(this).stop().transition({background:$(this).data("oldBg")},500,"ease")}})}),$(".node-bin").css({width:f-20,height:f-20}),$(".node-bin h1").css({marginTop:f/3}),$.each($(".node-bin"),function(o,e){var t=$(e).offset();$(e).data("oldPos",t),$(e).css(t)}),$(".node-bin").css({position:"absolute"}),$.each(b,function(o,e){var i=global.network.getEdges({from:global.network.getNodes({type_t0:"Ego"})[0].id,type:"Dyad",to:e.to})[0];if(void 0!==e[t.options.variable.label]&&""!==e[t.options.variable.label]){o=t.options.variable.values.indexOf(e[t.options.variable.label]),$(".c"+o).children(".active-node-list").append('<div class="node-item draggable" data-node-id="'+e.to+'">'+i.nname_t0+"</div>");var n="people";1===$(".c"+o).children(".active-node-list").children().length&&(n="person"),$(".c"+o).children("p").html(0===$(".c"+o).children(".active-node-list").children().length?"(Empty)":$(".c"+o).children(".active-node-list").children().length+" "+n+".")}else $(".node-bucket").append('<div class="node-item draggable" data-node-id="'+e.to+'">'+i.nname_t0+"</div>")}),$(".draggable").draggable({cursor:"pointer",revert:"invalid",disabled:!1,start:function(){if(e===!1){var t={stage:global.session.currentStage(),timestamp:new Date};o=new window.CustomEvent("log",{detail:{eventType:"taskComprehended",eventObject:t}}),window.dispatchEvent(o),e=!0}}}),window.addEventListener("changeStageStart",a,!1),$(".node-bin-static").on("click",r),$(".node-item").on("click",p),$(".content").on("click",d),$(".followup-form").on("submit",l),$(".followup-cancel").on("click",s)},t};module.exports=new MultiBin;