var GeoInterface=function e(){function e(e){if(c===!1){var t={zoomLevel:u.getZoom(),stage:global.session.currentStage(),timestamp:new Date};p=new CustomEvent("log",{detail:{eventType:"taskComprehended",eventObject:t}}),window.dispatchEvent(p),c=!0}var a={zoomLevel:u.getZoom(),timestamp:new Date};p=new CustomEvent("log",{detail:{eventType:"mapMarkerPlaced",eventObject:a}}),window.dispatchEvent(p);var s=e.target,i;k===!1?(o(e),i={},i[h]=s.feature.properties.name,global.network.updateEdge(g[f].id,i),$(".map-node-location").html("<strong>Currently marked as:</strong> <br>"+s.feature.properties.name)):s.feature.properties.name===k?(n(e),k=!1,i={},i[h]=void 0,global.network.updateEdge(g[f].id,i)):(r(),o(e),i={},i[h]=s.feature.properties.name,global.network.updateEdge(g[f].id,i))}function t(){if(void 0!==g[f][h])if(k=g[f][h],"Homeless"===g[f][h]||"Jail"===g[f][h]){i();var e="Homeless";"Jail"===g[f][h]&&(e="in Jail"),$(".map-node-location").html("<strong>Currently marked as:</strong> <br>"+e)}else $.each(w._layers,function(e,t){t.feature.properties.name===g[f][h]&&($(".map-node-location").html("<strong>Currently marked as:</strong> <br>"+g[f][h]),a(t))});else i()}function o(e){var t=e.target;u.fitBounds(e.target.getBounds(),{maxZoom:14}),t.setStyle({fillOpacity:.8,fillColor:b[1]}),L.Browser.ie||L.Browser.opera||t.bringToFront(),k=t.feature.properties.name}function a(e){var t=e;u.fitBounds(e.getBounds(),{maxZoom:14}),t.setStyle({fillOpacity:.8,fillColor:b[1]}),L.Browser.ie||L.Browser.opera||t.bringToFront()}function n(e){$(".map-node-location").html(""),k=!1,w.resetStyle(e.target)}function r(){$(".map-node-location").html(""),k=!1,$.each(w._layers,function(e,t){w.resetStyle(t)})}function s(t,o){o.on({click:e})}function i(){u.setView([41.798395426119534,-87.83967137233888],11)}function l(){r();var e={};e[h]="Homeless",global.network.updateEdge(g[f].id,e),$(".map-node-location").html("<strong>Currently marked as:</strong> <br>Homeless")}function m(){r();var e={};e[h]="Jail",global.network.updateEdge(g[f].id,e),$(".map-node-location").html("<strong>Currently marked as:</strong> <br>in Jail")}var p,c=!1,d={},u,g,h="res_chicago_location_p_t0",f=0,w,k=!1,b=["#67c2d4","#1ECD97","#B16EFF","#FA920D","#e85657","#20B0CA","#FF2592","#153AFF","#8708FF"];return d.nextPerson=function(){f<g.length-1&&(r(),f++,$(".current-id").html(f+1),$(".map-node-status").html("Tap on the map to indicate the general area where <strong>"+g[f].nname_t0+"</strong> lives."),t(),f===g.length-1?$(".map-forwards").hide():$(".map-forwards").show(),0===f?$(".map-back").hide():$(".map-back").show())},d.previousPerson=function(){f>0&&(r(),f--,$(".current-id").html(f+1),$(".map-node-status").html("Tap on the map to indicate the general area where <strong>"+g[f].nname_t0+"</strong> lives."),t(),f===g.length-1?$(".map-forwards").hide():$(".map-forwards").show(),0===f?$(".map-back").hide():$(".map-back").show())},d.init=function(){u=L.map("map",{maxBounds:[[41.4985986599114,-88.49824022406345],[42.1070175291862,-87.07098424716594]],zoomControl:!1}),L.tileLayer("http://{s}.{base}.maps.cit.api.here.com/maptile/2.1/maptile/{mapID}/normal.day.transit/{z}/{x}/{y}/256/png8?app_id={app_id}&app_code={app_code}",{subdomains:"1234",mapID:"newest",app_id:"FxdAZ7O0Wh568CHyJWKV",app_code:"FuQ7aPiHQcR8BSnXBCCmuQ",base:"base",minZoom:0,maxZoom:20}).addTo(u),$.ajax({dataType:"json",url:"data/census2010.json",success:function(e){w=L.geoJson(e,{onEachFeature:s,style:function(){return{weight:1,fillOpacity:0,strokeWidth:.2,color:b[1]}}}).addTo(u),g=global.network.getEdges({from:global.network.getNodes({type_t0:"Ego"})[0].id,type:"Dyad",res_cat_p_t0:"Chicago"}),$(".map-counter").html('<span class="current-id">1</span>/'+g.length),$(".map-node-status").html("Tap on the map to indicate the general area where <strong>"+g[0].nname_t0+"</strong> lives."),t(),$(".map-back").hide(),f===g.length-1?$(".map-forwards").hide():$(".map-forwards").show()}}).error(function(){}),$(".map-back").on("click",d.previousPerson),$(".map-forwards").on("click",d.nextPerson),$(".homeless").on("click",l),$(".jail").on("click",m)},d.destroy=function(){$(".map-back").off("click",d.previousPerson),$(".map-forwards").off("click",d.nextPerson),$(".homeless").on("click",l),$(".jail").on("click",m)},d};module.exports=new GeoInterface;