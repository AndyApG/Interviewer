var Namegenerator=function e(){var e={};e.options={nodeType:"Alter",edgeType:"Dyad",targetEl:$(".container"),variables:[],heading:"This is a default heading",subheading:"And this is a default subheading"};var t=!1,o=!1,a=global.network.getNodes({type_t0:"Alter"}).length,n={Friend:["Best Friend","Friend","Ex-friend","Other type"],"Family / Relative":["Parent / Guardian","Brother / Sister","Grandparent","Other Family","Chosen Family"],"Romantic / Sexual Partner":["Boyfriend / Girlfriend","Ex-Boyfriend / Ex-Girlfriend","Booty Call / Fuck Buddy / Hook Up","One Night Stand","Other type of Partner"],"Acquaintance / Associate":["Coworker / Colleague","Classmate","Roommate","Friend of a Friend","Neighbor","Other"],"Other Support / Source of Advice":["Teacher / Professor","Counselor / Therapist","Community Agency Staff","Religious Leader","Mentor","Coach","Other"],"Drug Use":["Someone you use drugs with","Someone you buy drugs from"],Other:["Other relationship"]},i=["Barney","Jonathon","Myles","Alethia","Tammera","Veola","Meredith","Renee","Grisel","Celestina","Fausto","Eliana","Raymundo","Lyle","Carry","Kittie","Melonie","Elke","Mattie","Kieth","Lourie","Marcie","Trinity","Librada","Lloyd","Pearlie","Velvet","Stephan","Hildegard","Winfred","Tempie","Maybelle","Melynda","Tiera","Lisbeth","Kiera","Gaye","Edra","Karissa","Manda","Ethelene","Michelle","Pamella","Jospeh","Tonette","Maren","Aundrea","Madelene","Epifania","Olive"],l=function(o){13===o.keyCode&&(o.preventDefault(),t===!1?e.openNodeBox():t===!0&&$(".submit-1").click()),27===o.keyCode&&e.closeNodeBox(),8!==o.keyCode||$(o.target).is("input, textarea")||o.preventDefault()},r=function(){$(this).data("selected")===!0?($(this).data("selected",!1),$(this).removeClass("selected")):($(this).data("selected",!0),$(this).addClass("selected"))},s=function(e){if(t===!0&&13!==e.keyCode&&$("#fname_t0").val().length>0&&$("#fname_t0").val().length>0){var o=$("#fname_t0").val()+" "+$("#lname_t0").val().charAt(0);$("#lname_t0").val().length>0&&(o+=".");var a=function(){$("#nname_t0").val(o)};setTimeout(a,0)}},d=function(){e.destroy()},p=function(){var t=$(this).data("index"),a=global.network.getEdges({from:global.network.getNodes({type_t0:"Ego"})[0].id,to:t,type:"Dyad"})[0];o=t;var n=global.network.getEdges({from:global.network.getNodes({type_t0:"Ego"})[0].id,to:o,type:"Role"}).length;$(".relationship-button").html(n+" roles selected."),$.each(e.options.variables,function(t,o){o["private"]===!1&&("relationship"===o.type?$("select[name='"+o.variable+"']").val(a[o.variable]):$("#"+o.variable).val(a[o.variable]),$(".delete-button").show(),e.openNodeBox())})},c=function(){$(".delete-button").hide(),e.closeNodeBox()},u=function(){return""===$("select[name='reltype_main_t0']").val()?($("select[name='reltype_sub_t0']").prop("disabled",!0),!1):($("select[name='reltype_sub_t0']").prop("disabled",!1),$("select[name='reltype_sub_t0']").children().remove(),$("select[name='reltype_sub_t0']").append('<option value="">Choose a specific relationship</option>'),void $.each(n[$("select[name='reltype_main_t0']").val()],function(e,t){$("select[name='reltype_sub_t0']").append('<option value="'+t+'">'+t+"</option>")}))},h=function(){"Other"===$("select[name='reltype_sub_t0']").val()?$(".reltype_oth_t0").show():($(".reltype_oth_t0").val(""),$(".reltype_oth_t0").hide())},b=function(t){t.preventDefault();var n={},i={};$(".delete-button").hide(),$.each(e.options.variables,function(e,t){"edge"===t.target?n[t.variable]=t["private"]===!0?t.value:"relationship"===t.type||"subrelationship"===t.type?$("select[name='"+t.variable+"']").val():$("#"+t.variable).val():"node"===t.target&&(i[t.variable]=t["private"]===!0?t.value:"relationship"===t.type||"subrelationship"===t.type?$("select[name='"+t.variable+"']").val():$("#"+t.variable).val())});var l={},r={};if(o===!1){global.tools.extend(l,i);var s=global.network.addNode(l),d;$.each(e.options.edgeTypes,function(t,o){var a={},n=o;$.each(e.options.variables,function(e,t){"edge"===t.target&&t.edge===n&&(a[t.variable]=t["private"]===!0?t.value:"relationship"===t.type||"subrelationship"===t.type?$("select[name='"+t.variable+"']").val():$("#"+t.variable).val())}),r={from:global.network.getNodes({type_t0:"Ego"})[0].id,to:s,type:n},global.tools.extend(r,a),d=global.network.addEdge(r)}),$.each($(".relationship.selected"),function(){r={type:"Role",from:global.network.getNodes({type_t0:"Ego"})[0].id,to:s,reltype_main_t0:$(this).parent(".relationship-type").data("main-relationship"),reltype_sub_t0:$(this).data("sub-relationship")},global.network.addEdge(r)});var p=global.network.getEdges({to:s,type:"Dyad"})[0];e.addToList(p),a++,$(".alter-count-box").html(a)}else{var c=function(){var e=$("div[data-index="+o+"]");e.stop().transition({background:"#1ECD97"},400,"ease"),setTimeout(function(){e.stop().transition({background:"#67c2d4"},800,"ease")},700)},u=o;$.each(e.options.edgeTypes,function(t,a){var n=a,i={};$.each(e.options.variables,function(e,t){"edge"===t.target&&t.edge===n&&(i[t.variable]=t["private"]===!0?t.value:"relationship"===t.type||"subrelationship"===t.type?$("select[name='"+t.variable+"']").val():$("#"+t.variable).val())});var l=global.network.getEdges({from:global.network.getNodes({type_t0:"Ego"})[0].id,to:o,type:a});$.each(l,function(e,t){global.network.updateEdge(t.id,i,c)})}),global.network.updateNode(u,i);var h=global.tools.extend(n,i);global.network.removeEdges(global.network.getEdges({type:"Role",from:global.network.getNodes({type_t0:"Ego"})[0].id,to:o})),$.each($(".relationship.selected"),function(){r={type:"Role",from:global.network.getNodes({type_t0:"Ego"})[0].id,to:o,reltype_main_t0:$(this).parent(".relationship-type").data("main-relationship"),reltype_sub_t0:$(this).data("sub-relationship")},global.network.addEdge(r)}),$("div[data-index="+o+"]").html(""),$("div[data-index="+o+"]").append("<h4>"+h.nname_t0+"</h4>");var b=$("<ul></ul>");$.each(e.options.variables,function(e,t){t["private"]===!1&&void 0!==h[t.variable]&&""!==h[t.variable]&&b.append('<li class="'+h[t.variable]+'"><strong>'+t.label+"</strong>: "+h[t.variable]+"</li>")}),$("div[data-index="+o+"]").append(b),o=!1}e.closeNodeBox()};return e.generateTestAlters=function(e){if(!e)return global.tools.notify("You must specify the number of test alters you want to create. Cancelling!",2),!1;$(".add-button").click(),setTimeout(function(){$("#ngForm").submit()},3e3),$("#fname_t0").val(i[Math.floor(global.tools.randomBetween(0,i.length))]),$("#lname_t0").val(i[Math.floor(global.tools.randomBetween(0,i.length))]);var t=$("#fname_t0").val()+" "+$("#lname_t0").val().charAt(0);$("#lname_t0").val().length>0&&(t+="."),$("#nname_t0").val(t),$("#age_p_t0").val(Math.floor(global.tools.randomBetween(18,90))),setTimeout(function(){$(".relationship-button").click()},500),setTimeout(function(){$($(".relationship")[Math.floor(global.tools.randomBetween(0,$(".relationship").length))]).addClass("selected"),$(".relationship-close-button").click()},2e3)},e.openNodeBox=function(){$(".content").addClass("blurry"),$(".newNodeBox").addClass("open"),$("#ngForm input:text").first().focus(),t=!0},e.closeNodeBox=function(){$(".content").removeClass("blurry"),$(".newNodeBox").removeClass("open"),setTimeout(function(){}),t=!1,$("#ngForm").trigger("reset"),$(".reltype_oth_t0").hide(),o=!1,$(".relationship-button").html("Set Relationship Roles"),$(".relationship").removeClass("selected")},e.destroy=function(){global.tools.notify("Destroying namegenerator.",0),$(window.document).off("keydown",l),$(".cancel").off("click",c),$("#fname_t0, #lname_t0").off("keyup",s),$(window.document).off("click",".card",p),$(".add-button").off("click",e.openNodeBox),$(".delete-button").off("click",e.removeFromList),$("select[name='reltype_main_t0']").off("change",u),$("select[name='reltype_sub_t0']").off("change",h),$("#ngForm").off("submit",b),window.removeEventListener("changeStageStart",d,!1),$(".newNodeBox").remove(),$(".relationship-types-container").remove(),$(window.document).off("click",".relationship",r),$(window.document).off("click",".relationship-button",e.toggleRelationshipBox),$(window.document).off("click",".relationship-close-button",e.toggleRelationshipBox)},e.init=function(t){global.tools.extend(e.options,t);var o=$('<h1 class="text-center"></h1>').html(e.options.heading);e.options.targetEl.append(o);var i=$('<p class="lead text-center"></p>').html(e.options.subheading);e.options.targetEl.append(i);var v=$('<span class="hi-icon hi-icon-user add-button">Add</span>');e.options.targetEl.append(v);var m=$('<div class="alter-count-box"></div>');e.options.targetEl.append(m);var g=$('<div class="newNodeBox overlay"><form role="form" id="ngForm" class="form"><div class="col-sm-6 left"><h2 style="margin-top:0">Adding a Person</h2><ul><li>Try to be as accurate as you can, but don\'t worry if you aren\'t sure.</li><li>We are interested in your perceptions, so there are no right or wrong answers!</li><li>You can use the tab key to quickly move between the fields.</li><li>You can use the enter key to submit the form.</li></ul></div><div class="col-sm-6 right"></div></form></div>');$("body").append(g),$.each(e.options.variables,function(e,t){if(t["private"]!==!0){var o;switch(t.type){case"text":o=$('<div class="form-group '+t.variable+'"><label class="sr-only" for="'+t.variable+'">'+t.label+'</label><input type="text" class="form-control '+t.variable+'" id="'+t.variable+'" placeholder="'+t.label+'"></div></div>');break;case"number":o=$('<div class="form-group '+t.variable+'"><label class="sr-only" for="'+t.variable+'">'+t.label+'</label><input type="number" class="form-control '+t.variable+'" id="'+t.variable+'" placeholder="'+t.label+'"></div></div>');break;case"relationship":o=$('<input type="hidden" class="form-control '+t.variable+'" id="'+t.variable+'" placeholder="'+t.label+'">');break;case"subrelationship":o=$('<input type="hidden" class="form-control '+t.variable+'" id="'+t.variable+'" placeholder="'+t.label+'">')}$(".newNodeBox .form .right").append(o),t.required===!0&&("relationship"===t.type?$("select[name='"+t.variable+"']").prop("required",!0):$("#"+t.variable).prop("required",!0))}}),$(".newNodeBox .form .right").append('<div class="form-group"><button type="button" class="btn btn-primary btn-block relationship-button">Set Relationship Roles</div></div>'),$("select[name='reltype_sub_t0']").prop("disabled",!0);var f=$('<div class="row form-group"><div class="col-sm-6"><button type="submit" class="btn btn-success btn-block submit-1"><span class="glyphicon glyphicon-plus-sign"></span> Add</button></div><div class="col-sm-6"><span class="btn btn-warning btn-outline btn-block cancel">Cancel</span></div></div><div class="row form-group"><div class="col-sm-12 text-center"><button type="button" class="btn btn-danger btn-outline btn-block delete-button"><span class="glyphicon glyphicon-trash"></span> Delete this Node</button></div></div>');$(".newNodeBox .form .right").append(f),$(".reltype_oth_t0").hide(),m=$('<div class="relationship-types-container"><button class="btn btn-primary relationship-close-button">Close</button></div>'),$(".newNodeBox").after(m);var y=0;$.each(n,function(e){$(".relationship-types-container").append('<div class="relationship-type rel-'+y+" c"+y+'" data-main-relationship="'+y+'"><h1>'+e+"</h1></div>"),$.each(n[e],function(e,t){$(".rel-"+y).append('<div class="relationship" data-sub-relationship="'+t+'">'+t+"</div>")}),y++});var w=$('<div class="node-container"></div>');e.options.targetEl.append(w);var _=$('<div class="table nameList"></div>');$(".node-container").append(_),window.addEventListener("changeStageStart",d,!1),$(window.document).on("keydown",l),$(".cancel").on("click",c),$(".add-button").on("click",e.openNodeBox),$(".delete-button").on("click",e.removeFromList),$("#fname_t0, #lname_t0").on("keyup",s),$(window.document).on("click",".card",p),$("select[name='reltype_main_t0']").on("change",u),$("select[name='reltype_sub_t0']").on("change",h),$("#ngForm").on("submit",b),$(window.document).on("click",".relationship",r),$(window.document).on("click",".relationship-button",e.toggleRelationshipBox),$(window.document).on("click",".relationship-close-button",e.toggleRelationshipBox),$(".alter-count-box").html(a)},e.toggleRelationshipBox=function(){if($(".relationship-types-container").hasClass("open")){var e=$(".relationship.selected").length,t="roles";1===e&&(t="role"),$(".relationship-button").html(o?e+" "+t+" selected.":e>0?e+" "+t+" selected.":"Set Relationship Roles"),$.each($(".relationship-type"),function(e,t){setTimeout(function(){$(t).transition({opacity:0,top:"-100px"},150),$.each($(t).children(".relationship"),function(e,t){setTimeout(function(){$(t).transition({opacity:0,top:"-200px"},150)},50+20*e)})},50*e)}),setTimeout(function(){$(".relationship-types-container").removeClass("open"),$(".relationship-types-container").removeClass("front"),$(".newNodeBox").removeClass("back"),setTimeout(function(){},1e3)},400)}else{if(o){var a=global.network.getEdges({from:global.network.getNodes({type_t0:"Ego"})[0].id,to:o,type:"Role"});$.each(a,function(e,t){$(".rel-"+t.reltype_main_t0).find('div[data-sub-relationship="'+t.reltype_sub_t0+'"]').addClass("selected").data("selected",!0)})}$(".newNodeBox").addClass("back"),$(".relationship-types-container").addClass("open front"),$(".relationship").css({position:"relative",opacity:0,top:"-200px"}),$(".relationship-type").css({position:"relative",opacity:0,top:"-100px"}),$.each($(".relationship-type"),function(e,t){setTimeout(function(){$(t).transition({opacity:1,top:"0px"},200),$.each($(t).children(".relationship"),function(e,t){setTimeout(function(){$(t).transition({opacity:1,top:0},100)},100+50*e)})},80*e)})}},e.addToList=function(t){var o;o=$('<div class="card" data-index="'+t.to+'"><h4>'+t.nname_t0+"</h4></div>");var a=$("<ul></ul>");$.each(e.options.variables,function(e,o){o["private"]===!1&&void 0!==t[o.variable]&&""!==t[o.variable]&&a.append('<li class="'+t[o.variable]+'"><strong>'+o.label+"</strong>: "+t[o.variable]+"</li>")}),o.append(a),$(".nameList").append(o)},e.removeFromList=function(){$(".delete-button").hide();var t=o;global.network.removeNode(t),$("div[data-index="+o+"]").remove(),o=!1,e.closeNodeBox()},e};module.exports=new Namegenerator;