var OrdinalBin=function e(){var e={},o=!1,t;e.options={targetEl:$(".container"),edgeType:"Dyad",criteria:{from:global.network.getNodes({type_t0:"Ego"})[0].id},variable:{label:"gender_p_t0",values:["Female","Male","Transgender","Don't Know","Won't Answer"]},heading:"Default Heading",subheading:"Default Subheading."};var a,n,i,l=function(){e.destroy()},d=function(){var o=$(this).data("value"),t=i,a={to:t};global.tools.extend(a,e.options.criteria);var n=global.network.getEdges(a)[0],l={};l[e.options.followup.variable]=o,global.tools.extend(n,l),global.network.updateEdge(n.id,n),$(".followup").hide()};return e.destroy=function(){global.tools.notify("Destroying ordinalBin.",0),window.removeEventListener("changeStageStart",l,!1),$(window.document).off("click",".followup-option",d)},e.init=function(s){global.tools.extend(e.options,s),e.options.targetEl.append("<h1>"+e.options.heading+"</h1>"),e.options.targetEl.append('<p class="lead">'+e.options.subheading+"</p>"),e.options.targetEl.append('<div class="node-bucket"></div>'),"undefined"!=typeof e.options.followup&&(e.options.targetEl.append('<div class="followup"><h2>'+e.options.followup.prompt+"</h2></div>"),$.each(e.options.followup.values,function(e,o){$(".followup").append('<span class="btn btn-primary btn-block followup-option" data-value="'+o.value+'">'+o.label+"</span>")}));var r=e.options.variable.values.length;a=$(".container").outerWidth()/r-20,n=$(".container").outerHeight()-270,$.each(e.options.variable.values,function(a,n){var l=$('<div class="ord-node-bin node-bin-static d'+a+'" data-index="'+a+'"><h1>'+n.label+'</h1><p class="lead">(Empty)</p><div class="active-node-list"></div></div>');l.data("index",a),e.options.targetEl.append(l),$(".d"+a).droppable({accept:".draggable",drop:function(n,l){var d=l.draggable,s=$(this);console.log("index is: "+e.options.variable.values[a].value),e.options.variable.values[a].value>0&&($(".followup").show(),i=$(d).data("node-id")),$(d).appendTo(s.children(".active-node-list")),$(d).css({position:"",top:"",left:""});var r={};r[e.options.variable.label]=e.options.variable.values[a].value;var p=global.network.getEdges({from:global.network.getNodes({type_t0:"Ego"})[0].id,to:$(d).data("node-id"),type:e.options.edgeType})[0].id;global.network.updateEdge(p,r),$.each($(".ord-node-bin"),function(e){var o=$(".d"+e).children(".active-node-list").children().length;if(o>0){var t="people";1===o&&(t="person"),$(".d"+e+" p").html(o+" "+t+".")}else $(".d"+e+" p").html("(Empty)")});var g=$(".d"+a);setTimeout(function(){g.transition({background:g.data("oldBg")},200,"ease")},0),$(".draggable").draggable({cursor:"pointer",revert:"invalid",disabled:!1,scroll:"true",refreshPositions:!0,start:function(){if(o===!1){var e={stage:global.session.currentStage(),timestamp:new Date};t=new window.CustomEvent("log",{detail:{eventType:"taskComprehended",eventObject:e}}),window.dispatchEvent(t),o=!0}},stop:function(){}})},over:function(){$(this).data("oldBg",$(this).css("background-color")),$(this).stop().transition({background:"rgba(255, 193, 0, 1.0)"},400,"ease")},out:function(){$(this).stop().transition({background:$(this).data("oldBg")},500,"ease")}})}),$(".ord-node-bin").css({width:a,height:n});var p=global.network.getEdges(e.options.criteria);console.log("edges"),console.log(p),$.each(p,function(o,t){var a;if("Dyad"!==e.options.criteria.type&&(console.log("dyadedge"),a=global.network.getEdges({from:t.from,to:t.to,type:"Dyad"})[0],console.log(a)),void 0!==t[e.options.variable.label]&&""!==t[e.options.variable.label]){o="error",$.each(e.options.variable.values,function(a,n){t[e.options.variable.label]===n.value&&(o=a)}),$(".d"+o).children(".active-node-list").append("Dyad"!==e.options.criteria.type?'<div class="node-item draggable" data-node-id="'+t.to+'">'+a.nname_t0+"</div>":'<div class="node-item draggable" data-node-id="'+t.to+'">'+t.nname_t0+"</div>");var n="people",i=$(".d"+o).children(".active-node-list").children().length;1===i&&(n="person"),$(".d"+o).children("p").html(0===i?"(Empty)":i+" "+n+".")}else $(".node-bucket").append("Dyad"!==e.options.criteria.type?'<div class="node-item draggable" data-node-id="'+t.to+'">'+a.nname_t0+"</div>":'<div class="node-item draggable" data-node-id="'+t.to+'">'+t.nname_t0+"</div>")}),$(".draggable").draggable({cursor:"pointer",revert:"invalid",disabled:!1,scroll:"true",refreshPositions:!0,start:function(){if(o===!1){var e={stage:global.session.currentStage(),timestamp:new Date};t=new window.CustomEvent("log",{detail:{eventType:"taskComprehended",eventObject:e}}),window.dispatchEvent(t),o=!0}},stop:function(){}}),window.addEventListener("changeStageStart",l,!1),$(window.document).on("click",".followup-option",d)},e};module.exports=new OrdinalBin;