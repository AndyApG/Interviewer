var OrdinalBin=function e(){var e={},t=!1,o;e.options={targetEl:$(".container"),edgeType:"Dyad",criteria:{from:global.network.getNodes({type_t0:"Ego"})[0].id},variable:{label:"gender_p_t0",values:["Female","Male","Transgender","Don't Know","Won't Answer"]},heading:"Default Heading",subheading:"Default Subheading."};var a,n,i,d=function(){e.destroy()},l=function(){var t=$(this).data("value"),o=i,a={to:o};global.tools.extend(a,e.options.criteria);var n=global.network.getEdges(a)[0],d={};d[e.options.followup.variable]=t,global.tools.extend(n,d),global.network.updateEdge(n.id,n),$(".followup").hide()};return e.destroy=function(){global.tools.notify("Destroying ordinalBin.",0),window.removeEventListener("changeStageStart",d,!1),$(window.document).off("click",".followup-option",l)},e.init=function(r){global.tools.extend(e.options,r),e.options.targetEl.append("<h1>"+e.options.heading+"</h1>"),e.options.targetEl.append('<p class="lead">'+e.options.subheading+"</p>"),e.options.targetEl.append('<div class="node-bucket"></div>'),"undefined"!=typeof e.options.followup&&(e.options.targetEl.append('<div class="followup"><h2>'+e.options.followup.prompt+"</h2></div>"),$.each(e.options.followup.values,function(e,t){$(".followup").append('<span class="btn btn-primary btn-block followup-option" data-value="'+t.value+'">'+t.label+"</span>")}));var s=e.options.variable.values.length;a=$(".container").outerWidth()/s-20,n=$(".container").outerHeight()-270,$.each(e.options.variable.values,function(a,n){var d=$('<div class="ord-node-bin node-bin-static d'+a+'" data-index="'+a+'"><h1>'+n.label+'</h1><p class="lead">(Empty)</p><div class="active-node-list"></div></div>');d.data("index",a),e.options.targetEl.append(d),$(".d"+a).droppable({accept:".draggable",drop:function(n,d){var l=d.draggable,r=$(this);e.options.variable.values[a].value>0&&($(".followup").show(),i=$(l).data("node-id")),$(l).appendTo(r.children(".active-node-list")),$(l).css({position:"",top:"",left:""});var s={};s[e.options.variable.label]=e.options.variable.values[a].value;var p=global.network.getEdges({from:global.network.getNodes({type_t0:"Ego"})[0].id,to:$(l).data("node-id"),type:e.options.edgeType})[0].id;global.network.updateEdge(p,s),$.each($(".ord-node-bin"),function(e){var t=$(".d"+e).children(".active-node-list").children().length;if(t>0){var o="people";1===t&&(o="person"),$(".d"+e+" p").html(t+" "+o+".")}else $(".d"+e+" p").html("(Empty)")});var g=$(".d"+a);setTimeout(function(){g.transition({background:g.data("oldBg")},200,"ease")},0),$(".draggable").draggable({cursor:"pointer",revert:"invalid",disabled:!1,scroll:"true",refreshPositions:!0,start:function(){if(t===!1){var e={stage:global.session.currentStage(),timestamp:new Date};o=new window.CustomEvent("log",{detail:{eventType:"taskComprehended",eventObject:e}}),window.dispatchEvent(o),t=!0}},stop:function(){}})},over:function(){$(this).data("oldBg",$(this).css("background-color")),$(this).stop().transition({background:"rgba(255, 193, 0, 1.0)"},400,"ease")},out:function(){$(this).stop().transition({background:$(this).data("oldBg")},500,"ease")}})}),$(".ord-node-bin").css({width:a,height:n});var p=global.network.getEdges(e.options.criteria);$.each(p,function(t,o){var a;if("Dyad"!==e.options.criteria.type&&(a=global.network.getEdges({from:o.from,to:o.to,type:"Dyad"})[0]),void 0!==o[e.options.variable.label]&&""!==o[e.options.variable.label]){t="error",$.each(e.options.variable.values,function(a,n){o[e.options.variable.label]===n.value&&(t=a)}),$(".d"+t).children(".active-node-list").append("Dyad"!==e.options.criteria.type?'<div class="node-item draggable" data-node-id="'+o.to+'">'+a.nname_t0+"</div>":'<div class="node-item draggable" data-node-id="'+o.to+'">'+o.nname_t0+"</div>");var n="people",i=$(".d"+t).children(".active-node-list").children().length;1===i&&(n="person"),$(".d"+t).children("p").html(0===i?"(Empty)":i+" "+n+".")}else $(".node-bucket").append("Dyad"!==e.options.criteria.type?'<div class="node-item draggable" data-node-id="'+o.to+'">'+a.nname_t0+"</div>":'<div class="node-item draggable" data-node-id="'+o.to+'">'+o.nname_t0+"</div>")}),$(".draggable").draggable({cursor:"pointer",revert:"invalid",disabled:!1,scroll:"true",refreshPositions:!0,start:function(){if(t===!1){var e={stage:global.session.currentStage(),timestamp:new Date};o=new window.CustomEvent("log",{detail:{eventType:"taskComprehended",eventObject:e}}),window.dispatchEvent(o),t=!0}},stop:function(){}}),window.addEventListener("changeStageStart",d,!1),$(window.document).on("click",".followup-option",l)},e};module.exports=new OrdinalBin;