var Session=function e(t){function n(e){if("undefined"!=typeof network){var t={};t[e]=1;var n=network.getEdges({from:network.getNodes({type_t0:"Ego"})[0].id,type:"Drugs"}),a=network.getNodes(t);return 0===n.length||0===a.length?!0:!1}return!1}function a(e){var t=JSON.stringify(i.userData,void 0,2);fs.writeFile(e,t)}function o(){var e=document.createEvent("MouseEvents");e.initMouseEvent("click"),document.getElementById("save").dispatchEvent(e)}var i={},r=0,s=$("#content"),l={};i.id=0,i.userData={};var d;i.stages=[{label:"Intro",page:"intro.html"},{label:"NG: closest",page:"namegen1.html"},{label:"NG: marijuana or other drugs",page:"namegen5.html"},{label:"NG: drugs, two or more",page:"namegenmod6.html"},{label:"NG: other people sex",page:"namegen7.html"},{label:"NG: sex, two or more",page:"namegenmod8.html"},{label:"NET: layout",page:"canvaslayout.html"},{label:"NET EDGE: social",page:"canvasedge1.html"},{label:"NET NI: who recruited",page:"canvasselect2.html",skip:function(){if("undefined"!=typeof network){var e=network.getNodes({seed_status_t0:"Non-Seed"});return 0===e.length?!0:!1}}},{label:"NET NI: who drunk with",page:"canvasselect3.html"},{label:"NET NI: who drugs with",page:"canvasselect4.html"},{label:"NET NI: who sex with",page:"canvasselect5.html"},{label:"ORD: contact frequency",page:"ordbin1a.html"},{label:"ORD: relationship strength",page:"ordbin1.html"},{label:"NET NI: get advice",page:"canvasselect6.html"},{label:"NET NI: Serious relationship?",page:"canvasselect8.html"},{label:"CAT: gender identity",page:"multibin5.html"},{label:"RACE: Hispanic or Latino",page:"canvasselect14.html"},{label:"RACE: Racial Identity",page:"multibin2.html"},{label:"CAT: sexuality",page:"multibin3.html"},{label:"CAT: location",page:"multibin4.html"},{label:"MAP: location in Chicago",page:"map1.html",skip:function(){if("undefined"!=typeof network){var e=network.getEdges({type:"Dyad",res_cat_p_t0:"Chicago"});return e.length>0?!1:!0}return!1}},{label:"LIST SELECT: which drugs?",page:"listselect1.html"},{label:"ORD: Marijuana freq",page:"ordbin6.html",skip:function(){return n("d1_t0")}},{label:"ORD: Cocaine or Crack freq",page:"ordbin7.html",skip:function(){return n("d2_t0")}},{label:"ORD: Heroin freq",page:"ordbin8.html",skip:function(){return n("d3_t0")}},{label:"ORD: Methamphetamines freq",page:"ordbin9.html",skip:function(){return n("d4_t0")}},{label:"ORD: Painkillers or Opiates freq",page:"ordbin10.html",skip:function(){return n("d5_t0")}},{label:"ORD: Poppers freq",page:"ordbin11.html",skip:function(){return n("d6_t0")}},{label:"ORD: Stimulants or Amphetamines freq",page:"ordbin12.html",skip:function(){return n("d7_t0")}},{label:"ORD: Depressants or Tranquilizers freq",page:"ordbin13.html",skip:function(){return n("d8_t0")}},{label:"ORD: Ecstasy freq",page:"ordbin14.html",skip:function(){return n("d9_t0")}},{label:"ORD: Other Drugs freq",page:"ordbin15.html",skip:function(){return n("d10_t0")}},{label:"NET EDGE: drugs",page:"canvasedge2.html"},{label:"CAT: where met sex partners",page:"multibin6.html",skip:function(){if("undefined"!=typeof network){var e=network.getEdges({type:"Sex",from:network.getNodes({type_t0:"Ego"})[0].id});return e.length>0?!1:!0}return!1}},{label:"DATE: first and last sex",page:"dateinterface1.html",skip:function(){if("undefined"!=typeof network){var e=network.getEdges({type:"Sex",from:network.getNodes({type_t0:"Ego"})[0].id});return e.length>0?!1:!0}return!1}},{label:"CAT: HIV status of sex partners",page:"multibin7.html",skip:function(){if("undefined"!=typeof network){var e=network.getEdges({type:"Sex",from:network.getNodes({type_t0:"Ego"})[0].id});return e.length>0?!1:!0}return!1}},{label:"CAT: Vaginal sex?",page:"multibin9.html",skip:function(){if("undefined"!=typeof network){var e=network.getEdges({type:"Sex",from:network.getNodes({type_t0:"Ego"})[0].id});if(e.length>0){var t=network.getEdges({type:"Dyad",from:network.getNodes({type_t0:"Ego"})[0].id}),n=network.getEdges({type:"Dyad",from:network.getNodes({type_t0:"Ego"})[0].id,gender_p_t0:"Male"}),a=network.getEdges({type:"Dyad",gender_p_t0:"Female"});return"Male"===network.getNodes({type_t0:"Ego"})[0].gender_k&&t.length===n.length||"Female"===network.getNodes({type_t0:"Ego"})[0].gender_k&&t.length===a.length?!0:!1}return!0}return!1}},{label:"CAT: Anal sex?",page:"multibin10.html",skip:function(){if("undefined"!=typeof network){var e=network.getEdges({type:"Sex",from:network.getNodes({type_t0:"Ego"})[0].id});if(e.length>0){var t=network.getEdges({type:"Dyad",from:network.getNodes({type_t0:"Ego"})[0].id}),n=network.getEdges({type:"Dyad",from:network.getNodes({type_t0:"Ego"})[0].id,gender_p_t0:"Female"});return"Female"===network.getNodes({type_t0:"Ego"})[0].gender_k&&t.length===n.length?!0:!1}return!0}return console.log("network undefined."),!1}},{label:"NET EDGE: sex",page:"canvasedge3.html"},{label:"SWITCH: multiple sex partners",page:"multiplepartners.html",skip:function(){if("undefined"!=typeof network){var e=network.getEdges({type:"Sex",from:network.getNodes({type_t0:"Ego"})[0].id});return e.length>0?!1:!0}return!1}},{label:"NET NI: who multiple sex partners",page:"canvasselect7.html",skip:function(){if("undefined"!=typeof network){var e=network.getEdges({type:"Sex",from:network.getNodes({type_t0:"Ego"})[0].id});if(e.length>0){var t=network.getNodes({multiple_sex_t0:"yes"});return 0===t.length?!0:!1}return!1}return!1}},{label:"Thank You",page:"thanks.html"},{label:"Download Data",page:"download.html"},{label:"Finish",page:"finish.html"}];var g;return i.options={fnBeforeStageChange:function(e,t){var n={stage:r,timestamp:new Date},a=new CustomEvent("log",{detail:{eventType:"stageCompleted",eventObject:n}});window.dispatchEvent(a);var o=new CustomEvent("changeStageStart",{detail:{oldStage:e,newStage:t}});window.dispatchEvent(o)},fnAfterStageChange:function(e,t){var n=new CustomEvent("changeStageEnd",{detail:{oldStage:e,newStage:t}});window.dispatchEvent(n)}},i.init=function(){notify("Session initialising.",1),extend(i.options,t),window.addEventListener("changeStageStart",function(){$(".loader").transition({opacity:1})},!1),window.addEventListener("changeStageEnd",function(){$(".loader").transition({opacity:0})},!1),document.getElementById("save").addEventListener("change",function(){a(this.value)}),l=new IOInterface,l.init(function(e){i.id=e,l.load(function(e){i.updateUserData(e),i.goToStage(0)},i.id)}),i.registerData("session"),window.addEventListener("unsavedChanges",function(){i.saveManager()},!1);var e=menu.addMenu("Session","hi-icon-cog");menu.addItem(e,"Load Data by ID","icon-user",function(){return!0}),menu.addItem(e,"Reset Session","icon-globe",i.reset),menu.addItem(e,"Download Data","icon-briefcase",function(){o()}),menu.addItem(e,"Purge Database","icon-cloud",function(){l.reset(i.reset)});var n=menu.addMenu("Stages","hi-icon-list");$.each(i.stages,function(e,t){menu.addItem(n,t.label,"icon-play",function(){setTimeout(function(){i.goToStage(e)},500)})})},i.downloadData=function(){var e=i.returnSessionID()+".json",t=JSON.stringify(i.userData,void 0,2),n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),n.click()},i.reset=function(){notify("Resetting session.",2),localStorage.removeItem("activeSession"),localStorage.removeItem("nodes"),localStorage.removeItem("edges"),localStorage.removeItem("session"),localStorage.removeItem("log"),i.id=0,i.currentStage=0,location.reload()},i.saveManager=function(){clearTimeout(g),g=setTimeout(i.saveData,3e3)},i.updateUserData=function(e){notify("Updating user data.",2),notify("Using the following to update:",1),notify(e,1),notify("session.userData is:",1),notify(i.userData,1),extend(i.userData,e),notify("Combined output is:",0),notify(i.userData,0);var t=new Event("newDataLoaded");window.dispatchEvent(t);var n=new Event("unsavedChanges");window.dispatchEvent(n)},i.returnSessionID=function(){return i.id},i.saveData=function(){l.save(i.userData,i.returnSessionID()),d=new Date},i.goToStage=function(e){if("undefined"==typeof e||"undefined"==typeof i.stages[e])return!1;if(i.stages[e].skip){var t=i.stages[e].skip();if(t===!0)return console.log("Skipping because skip condition was met."),i.goToStage(e>r?e+1:e-1),!1}notify("Session is moving to stage "+e,3);var n={stage:e,timestamp:new Date},a=new CustomEvent("log",{detail:{eventType:"stageVisible",eventObject:n}});window.dispatchEvent(a),i.options.fnBeforeStageChange(r,e);var o=e;s.transition({opacity:"0"},400,"easeInSine").promise().done(function(){s.load("stages/"+i.stages[e].page,function(){s.transition({opacity:"1"},400,"easeInSine")})});var l=r;r=o,i.options.fnAfterStageChange(l,r);var d=new Event("unsavedChanges");window.dispatchEvent(d)},i.nextStage=function(){i.goToStage(r+1)},i.prevStage=function(){i.goToStage(r-1)},i.addStage=function(){},i.registerData=function(e,t){notify('A script requested a data store be registered with the key "'+e+'".',2),void 0===i.userData[e]?(notify('Key named "'+e+'" was not already registered. Creating.',1),i.userData[e]=t?[]:{}):notify("A data store with this key already existed. Returning a pointer.",1);var n=new Event("unsavedChanges");return window.dispatchEvent(n),i.userData[e]},i.addData=function(e,t,n){n||(n=!1),n===!0?i.userData[e].push(t):extend(i.userData[e],t),notify("Adding data to key '"+e+"'.",2),notify(t,1);var a=new Event("unsavedChanges");window.dispatchEvent(a)},i.currentStage=function(){return r},i.returnData=function(e){return e&&"undefined"!=typeof i.userData[e]?i.userData[e]:i.userData},i.init(),i};